<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>Vriskas Clicker</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
:root{
--bg:#fff;--bg2:#f2f2f7;--bg3:#e5e5ea;--card:#fff;
--text:#000;--text2:#8e8e93;--text3:#aeaeb2;
--accent:#007aff;--accent2:#5856d6;
--green:#34c759;--orange:#ff9500;--red:#ff3b30;--pink:#ff2d55;--cyan:#32ade6;--yellow:#ffcc00;
--border:rgba(0,0,0,.08);--shadow:0 2px 16px rgba(0,0,0,.08);
--tab-bg:rgba(242,242,247,.92);--energy-bg:#e5e5ea;--coin-glow:rgba(255,149,0,.3);
}
.dark{
--bg:#000;--bg2:#1c1c1e;--bg3:#2c2c2e;--card:#1c1c1e;
--text:#fff;--text2:#8e8e93;--text3:#636366;
--border:rgba(255,255,255,.08);--shadow:0 2px 16px rgba(0,0,0,.3);
--tab-bg:rgba(28,28,30,.92);--energy-bg:#2c2c2e;--coin-glow:rgba(255,149,0,.2);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none;}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;height:100vh;height:100dvh;transition:background .3s,color .3s;}
.app{display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden;}
.pages-wrapper{flex:1;position:relative;overflow:hidden;}
.page{position:absolute;top:0;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:hidden;padding:0 0 100px;-webkit-overflow-scrolling:touch;opacity:0;pointer-events:none;transform:scale(.96) translateY(8px);transition:opacity .3s ease,transform .3s ease;will-change:opacity,transform;}
.page.active{opacity:1;pointer-events:auto;transform:scale(1) translateY(0);}
.page::-webkit-scrollbar{display:none;}
.tab-bar{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;align-items:flex-start;padding:6px 0 env(safe-area-inset-bottom,14px);background:var(--tab-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:.5px solid var(--border);z-index:100;}
.tab-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 6px;background:none;border:none;color:var(--text2);font-size:10px;font-weight:500;cursor:pointer;transition:color .25s,transform .15s;font-family:inherit;position:relative;}
.tab-item.active{color:var(--accent);}
.tab-item:active{transform:scale(.88);}
.tab-item svg{width:22px;height:22px;transition:transform .25s;}
.tab-item.active svg{transform:scale(1.08);}
.tab-dot{width:4px;height:4px;border-radius:50%;background:var(--accent);opacity:0;transition:opacity .25s;margin-top:1px;}
.tab-item.active .tab-dot{opacity:1;}
.header{text-align:center;padding:14px 20px 6px;}
.header h1{font-size:22px;font-weight:800;letter-spacing:-.5px;}
.score-display{text-align:center;padding:10px 0 4px;}
.score-label{font-size:11px;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.score-value{font-size:42px;font-weight:900;letter-spacing:-2px;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.per-tap{font-size:12px;color:var(--text2);font-weight:500;}
.boost-badges{display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-top:4px;padding:0 20px;}
.boost-badge{display:inline-flex;align-items:center;gap:3px;background:linear-gradient(135deg,var(--accent2),var(--pink));color:white;padding:3px 10px;border-radius:10px;font-size:10px;font-weight:700;}
.combo-bar{text-align:center;margin:2px 0;}
.combo-text{font-size:14px;font-weight:800;color:var(--pink);opacity:0;transition:opacity .2s;display:inline-block;}
.combo-text.show{opacity:1;animation:comboPulse .3s ease;}
@keyframes comboPulse{0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);}}
.clicker-area{display:flex;justify-content:center;align-items:center;padding:8px 0;position:relative;}
.click-btn{width:170px;height:170px;border-radius:50%;background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .08s;position:relative;z-index:2;padding:0;}
.click-btn:active{transform:scale(.9);}
.click-btn svg{width:170px;height:170px;filter:drop-shadow(0 6px 20px var(--coin-glow));}
.float-text{position:absolute;font-size:20px;font-weight:800;color:var(--orange);pointer-events:none;animation:floatUp .8s ease-out forwards;z-index:10;text-shadow:0 1px 4px rgba(0,0,0,.15);}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-100px) scale(1.2);}}
.pulse-ring{position:absolute;width:170px;height:170px;border-radius:50%;border:3px solid var(--orange);opacity:0;pointer-events:none;animation:pulseRing .4s ease-out forwards;}
@keyframes pulseRing{0%{transform:scale(1);opacity:.5;}100%{transform:scale(1.4);opacity:0;}}
.energy-section{padding:0 28px;margin-top:4px;}
.energy-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:3px;}
.energy-label{font-size:11px;font-weight:600;color:var(--text2);}
.energy-value{font-size:11px;font-weight:700;color:var(--accent);}
.energy-bar-bg{height:7px;background:var(--energy-bg);border-radius:4px;overflow:hidden;}
.energy-bar-fill{height:100%;background:linear-gradient(90deg,var(--accent),#5ac8fa);border-radius:4px;transition:width .3s;}
.daily-section{margin:10px 16px;background:linear-gradient(135deg,var(--orange),var(--pink));border-radius:16px;padding:12px 16px;color:white;cursor:pointer;transition:transform .15s;}
.daily-section:active{transform:scale(.97);}
.daily-section.claimed{background:var(--card);border:.5px solid var(--border);color:var(--text2);cursor:default;}
.daily-title{font-size:14px;font-weight:700;display:flex;align-items:center;gap:6px;}
.daily-desc{font-size:11px;font-weight:500;opacity:.85;margin-top:2px;}
.daily-streak{font-size:10px;font-weight:600;margin-top:3px;opacity:.9;}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:10px 14px;}
.stat-card{background:var(--card);border:.5px solid var(--border);border-radius:12px;padding:8px 4px;text-align:center;box-shadow:var(--shadow);}
.stat-card .icon{font-size:16px;margin-bottom:1px;}
.stat-card .val{font-size:14px;font-weight:800;}
.stat-card .lbl{font-size:8px;color:var(--text2);font-weight:600;text-transform:uppercase;}
.balance-bar{display:flex;justify-content:center;gap:16px;padding:6px 20px;}
.balance-chip{display:flex;align-items:center;gap:5px;background:var(--bg2);padding:6px 14px;border-radius:18px;font-weight:700;font-size:13px;}
.shop-tabs{display:flex;margin:8px 16px 0;background:var(--bg2);border-radius:12px;padding:3px;}
.shop-tab{flex:1;padding:7px;border:none;background:none;border-radius:10px;font-size:11px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .25s;font-family:inherit;}
.shop-tab.active{background:var(--card);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.1);}
.shop-section-title{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:1px;padding:10px 20px 4px;}
.shop-list{padding:0 12px;display:flex;flex-direction:column;gap:5px;}
.shop-item{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:10px;box-shadow:var(--shadow);transition:transform .15s;cursor:pointer;}
.shop-item:active{transform:scale(.98);}
.shop-item.special{border:1.5px solid var(--pink);background:linear-gradient(135deg,rgba(255,45,85,.05),rgba(255,149,0,.05));}
.shop-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.shop-info{flex:1;min-width:0;}
.shop-name{font-size:13px;font-weight:700;margin-bottom:1px;}
.shop-desc{font-size:10px;color:var(--text2);font-weight:500;}
.shop-level{font-size:9px;color:var(--accent);font-weight:600;margin-top:1px;}
.shop-btn{padding:5px 12px;border-radius:18px;border:none;font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:transform .15s,opacity .15s;font-family:inherit;}
.shop-btn:active{transform:scale(.94);}
.shop-btn.coins-btn{background:linear-gradient(135deg,var(--orange),#e08600);color:white;}
.shop-btn.stars-btn{background:linear-gradient(135deg,var(--accent2),var(--accent));color:white;}
.shop-btn:disabled{opacity:.35;cursor:default;}
.skins-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:6px 14px;}
.skin-card{background:var(--card);border:.5px solid var(--border);border-radius:16px;padding:10px 4px;text-align:center;box-shadow:var(--shadow);cursor:pointer;transition:transform .15s,border-color .2s;position:relative;}
.skin-card:active{transform:scale(.94);}
.skin-card.active{border:2px solid var(--accent);}
.skin-card.locked{opacity:.45;}
.skin-card svg{width:50px;height:50px;margin-bottom:4px;}
.skin-card-name{font-size:10px;font-weight:700;margin-bottom:1px;}
.skin-card-price{font-size:9px;color:var(--text2);font-weight:600;}
.skin-card-bonus{font-size:8px;color:var(--green);font-weight:700;margin-top:1px;}
.skin-badge{position:absolute;top:5px;right:5px;font-size:8px;padding:2px 4px;border-radius:5px;font-weight:700;color:white;}
.skin-badge.equipped{background:var(--green);}
.skin-badge.lock{background:var(--red);}
.ach-grid{display:flex;flex-direction:column;gap:5px;padding:6px 14px;}
.ach-item{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:12px;padding:10px;box-shadow:var(--shadow);transition:opacity .2s;}
.ach-item.locked{opacity:.4;}
.ach-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;background:var(--bg2);}
.ach-item.unlocked .ach-icon{background:linear-gradient(135deg,var(--yellow),var(--orange));}
.ach-info{flex:1;min-width:0;}
.ach-name{font-size:13px;font-weight:700;}
.ach-desc{font-size:10px;color:var(--text2);font-weight:500;}
.ach-reward{font-size:9px;color:var(--green);font-weight:600;margin-top:1px;}
.ach-progress{width:50px;height:5px;background:var(--energy-bg);border-radius:3px;overflow:hidden;flex-shrink:0;}
.ach-progress-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:3px;transition:width .3s;}
.ach-check{font-size:18px;flex-shrink:0;}
.lb-tabs{display:flex;margin:8px 16px 0;background:var(--bg2);border-radius:12px;padding:3px;}
.lb-tab{flex:1;padding:7px;border:none;background:none;border-radius:10px;font-size:11px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .25s;font-family:inherit;}
.lb-tab.active{background:var(--card);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.1);}
.lb-list{padding:8px 14px;display:flex;flex-direction:column;gap:5px;}
.lb-item{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:10px 12px;box-shadow:var(--shadow);}
.lb-item.top1{border:1.5px solid #ffd700;}
.lb-item.top2{border:1.5px solid #c0c0c0;}
.lb-item.top3{border:1.5px solid #cd7f32;}
.lb-item.me{border:1.5px solid var(--accent);background:color-mix(in srgb,var(--accent) 5%,var(--card));}
.lb-rank{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;background:var(--bg2);flex-shrink:0;}
.lb-item.top1 .lb-rank{background:linear-gradient(135deg,#ffd700,#ffb347);color:#fff;}
.lb-item.top2 .lb-rank{background:linear-gradient(135deg,#c0c0c0,#e0e0e0);color:#fff;}
.lb-item.top3 .lb-rank{background:linear-gradient(135deg,#cd7f32,#e8a665);color:#fff;}
.lb-avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;background:var(--bg3);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:16px;}
img.lb-avatar{display:block;}
.lb-info{flex:1;min-width:0;}
.lb-name{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lb-you{font-size:9px;color:var(--accent);font-weight:600;}
.lb-score{font-size:13px;font-weight:800;color:var(--orange);flex-shrink:0;}
.lb-empty{text-align:center;padding:40px 28px;color:var(--text2);}
.lb-empty-icon{font-size:48px;margin-bottom:10px;}
.lb-empty-title{font-size:16px;font-weight:700;color:var(--text);margin-bottom:6px;}
.lb-empty-desc{font-size:12px;font-weight:500;line-height:1.4;margin-bottom:14px;}
.lb-invite-btn{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;padding:10px 20px;border-radius:20px;border:none;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;transition:transform .15s;}
.lb-invite-btn:active{transform:scale(.94);}
.lb-loading{text-align:center;padding:40px;color:var(--text2);font-size:12px;font-weight:600;}
.profile-hero{display:flex;flex-direction:column;align-items:center;padding:16px 20px 8px;gap:6px;}
.profile-avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;background:var(--bg3);border:3px solid var(--accent);}
.profile-name{font-size:20px;font-weight:800;}
.profile-username{font-size:13px;color:var(--text2);font-weight:500;margin-top:-4px;}
.profile-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;padding:0 14px;}
.profile-stat{background:var(--card);border:.5px solid var(--border);border-radius:12px;padding:10px;text-align:center;box-shadow:var(--shadow);}
.profile-stat .p-icon{font-size:18px;margin-bottom:2px;}
.profile-stat .p-val{font-size:16px;font-weight:800;}
.profile-stat .p-lbl{font-size:8px;color:var(--text2);font-weight:600;text-transform:uppercase;margin-top:1px;}
.profile-actions{padding:12px 14px;display:flex;flex-direction:column;gap:5px;}
.profile-action-btn{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow);cursor:pointer;transition:transform .15s;font-size:14px;font-weight:600;color:var(--text);font-family:inherit;width:100%;text-align:left;border:none;}
.profile-action-btn:active{transform:scale(.97);}
.profile-action-btn .pa-icon{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.profile-action-btn .pa-arrow{margin-left:auto;color:var(--text2);font-size:14px;}
.prestige-section{margin:10px 16px;background:linear-gradient(135deg,#ffd700,#ff9500);border-radius:16px;padding:12px 16px;color:white;cursor:pointer;transition:transform .15s;}
.prestige-section:active{transform:scale(.97);}
.prestige-section.disabled{opacity:.4;cursor:default;}
.prestige-title{font-size:14px;font-weight:700;display:flex;align-items:center;gap:6px;}
.prestige-desc{font-size:11px;font-weight:500;opacity:.85;margin-top:2px;}
.prestige-info{font-size:10px;font-weight:600;margin-top:3px;opacity:.9;}
.toast{position:fixed;top:50px;left:50%;transform:translateX(-50%) translateY(-20px);background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:12px 20px;font-size:12px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.15);z-index:200;opacity:0;pointer-events:none;transition:opacity .3s,transform .3s;text-align:center;max-width:88%;white-space:pre-line;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.db-status{text-align:center;padding:2px;font-size:9px;font-weight:600;color:var(--text2);transition:opacity 1s;}
.db-status.online{color:var(--green);}
.db-status.offline{color:var(--orange);}
.db-status.error{color:var(--red);}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:300;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;}
.modal-overlay.show{opacity:1;pointer-events:auto;}
.modal-box{background:var(--bg);border-radius:20px;padding:24px;width:90%;max-width:340px;transform:scale(.9);transition:transform .35s cubic-bezier(.32,.72,.35,1);text-align:center;}
.modal-overlay.show .modal-box{transform:scale(1);}
.modal-title{font-size:18px;font-weight:800;margin-bottom:8px;}
.modal-desc{font-size:12px;color:var(--text2);margin-bottom:16px;line-height:1.4;}
.modal-btns{display:flex;gap:8px;}
.modal-btn{flex:1;padding:12px;border-radius:14px;border:none;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;transition:transform .15s;}
.modal-btn:active{transform:scale(.95);}
.modal-btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;}
.modal-btn.danger{background:linear-gradient(135deg,var(--red),var(--pink));color:white;}
.modal-btn.cancel{background:var(--bg2);color:var(--text);}
/* WHEEL */
.wheel-container{margin:16px auto;width:240px;height:240px;position:relative;}
.wheel-canvas{width:240px;height:240px;border-radius:50%;border:4px solid var(--orange);box-shadow:0 0 30px rgba(255,149,0,.3);}
.wheel-pointer{position:absolute;top:-10px;left:50%;transform:translateX(-50%);font-size:28px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3));}
.wheel-result{margin-top:12px;font-size:15px;font-weight:800;min-height:24px;}
.billion-btn{margin:10px 16px;background:linear-gradient(135deg,#ff2d55,#ff9500,#ffd700,#34c759,#007aff,#5856d6);border-radius:16px;padding:14px 16px;color:white;cursor:pointer;transition:transform .15s;text-align:center;animation:rainbowShift 3s linear infinite;background-size:300% 300%;}
.billion-btn:active{transform:scale(.97);}
.billion-btn.disabled{opacity:.3;cursor:default;}
@keyframes rainbowShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.billion-title{font-size:14px;font-weight:800;}
.billion-desc{font-size:10px;font-weight:500;opacity:.85;margin-top:2px;}
</style>
</head>
<body>
<div class="app">
<div class="toast" id="toast"></div>
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
<div class="modal-box" id="modal-box"></div>
</div>
<div class="pages-wrapper">

<div class="page active" id="page-clicker">
<div class="header"><h1>‚ö° Vriskas Clicker</h1></div>
<div class="db-status" id="db-status"></div>
<div class="score-display">
<div class="score-label">–ú–æ–Ω–µ—Ç—ã</div>
<div class="score-value" id="score">0</div>
<div class="per-tap">+<span id="per-tap-val">1</span> –∑–∞ —Ç–∞–ø</div>
<div class="boost-badges" id="boost-badges"></div>
</div>
<div class="combo-bar"><span class="combo-text" id="combo-text"></span></div>
<div class="clicker-area" id="clicker-area">
<button class="click-btn" id="click-btn"></button>
</div>
<div class="energy-section">
<div class="energy-header">
<span class="energy-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è</span>
<span class="energy-value"><span id="energy-val">500</span> / <span id="energy-max">500</span></span>
</div>
<div class="energy-bar-bg"><div class="energy-bar-fill" id="energy-bar" style="width:100%"></div></div>
</div>
<div id="daily-container"></div>
<div class="stats-row">
<div class="stat-card"><div class="icon">üëÜ</div><div class="val" id="total-taps">0</div><div class="lbl">–¢–∞–ø–æ–≤</div></div>
<div class="stat-card"><div class="icon">üí∞</div><div class="val" id="total-earned">0</div><div class="lbl">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div></div>
<div class="stat-card"><div class="icon">‚ö°</div><div class="val" id="cps-val">0</div><div class="lbl">–í —Å–µ–∫</div></div>
<div class="stat-card"><div class="icon">üî•</div><div class="val" id="combo-max">0</div><div class="lbl">–ú–∞–∫—Å –∫–æ–º–±–æ</div></div>
</div>
</div>

<div class="page" id="page-shop">
<div class="header"><h1>üè™ –ú–∞–≥–∞–∑–∏–Ω</h1></div>
<div class="balance-bar"><div class="balance-chip">ü™ô <span id="shop-balance">0</span></div></div>
<div class="shop-tabs">
<button class="shop-tab active" onclick="switchShopTab('coins')">ü™ô –ú–æ–Ω–µ—Ç—ã</button>
<button class="shop-tab" onclick="switchShopTab('special')">üé∞ –û—Å–æ–±–æ–µ</button>
<button class="shop-tab" onclick="switchShopTab('stars')">‚≠ê Stars</button>
</div>
<div id="shop-content"></div>
<div style="height:20px"></div>
</div>

<div class="page" id="page-skins">
<div class="header"><h1>üé® –°–∫–∏–Ω—ã</h1></div>
<div class="balance-bar"><div class="balance-chip">ü™ô <span id="skins-balance">0</span></div></div>
<div class="skins-grid" id="skins-grid"></div>
</div>

<div class="page" id="page-ach">
<div class="header"><h1>üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1></div>
<div class="balance-bar"><div class="balance-chip" id="ach-counter">0 / 0</div></div>
<div class="ach-grid" id="ach-grid"></div>
</div>

<div class="page" id="page-leaders">
<div class="header"><h1>üèÜ –õ–∏–¥–µ—Ä—ã</h1></div>
<div class="lb-tabs">
<button class="lb-tab active" onclick="switchLbTab('earned')">üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</button>
<button class="lb-tab" onclick="switchLbTab('taps')">üëÜ –¢–∞–ø–æ–≤</button>
</div>
<div class="lb-list" id="lb-list"><div class="lb-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
</div>

<div class="page" id="page-profile">
<div class="header"><h1>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h1></div>
<div class="profile-hero">
<img class="profile-avatar" id="profile-avatar" src="" alt="">
<div class="profile-name" id="profile-name">–ò–≥—Ä–æ–∫</div>
<div class="profile-username" id="profile-username">@username</div>
</div>
<div class="profile-stats" id="profile-stats-grid"></div>
<div id="prestige-container"></div>
<div id="billion-container"></div>
<div class="profile-actions">
<button class="profile-action-btn" onclick="testPayment()" style="border:1.5px solid var(--accent)"><span class="pa-icon" style="background:rgba(255,204,0,.15)">‚≠ê</span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã (1‚≠ê‚Üí–≤–æ–∑–≤—Ä–∞—Ç)<span class="pa-arrow">‚Ä∫</span></button>
<button class="profile-action-btn" onclick="shareBot()"><span class="pa-icon" style="background:rgba(0,122,255,.12)">üì§</span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º<span class="pa-arrow">‚Ä∫</span></button>
<button class="profile-action-btn" onclick="resetProgress()"><span class="pa-icon" style="background:rgba(255,59,48,.12)">üóë</span>–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å<span class="pa-arrow">‚Ä∫</span></button>
</div>
</div>

</div>
<div class="tab-bar">
<button class="tab-item active" onclick="switchTab(0)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8m-4-4h8"/></svg>
<span>–ö–ª–∏–∫–µ—Ä</span><div class="tab-dot"></div>
</button>
<button class="tab-item" onclick="switchTab(1)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
<span>–ú–∞–≥–∞–∑–∏–Ω</span><div class="tab-dot"></div>
</button>
<button class="tab-item" onclick="switchTab(2)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>
<span>–°–∫–∏–Ω—ã</span><div class="tab-dot"></div>
</button>
<button class="tab-item" onclick="switchTab(3)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15l-2 5l9-11h-5l2-5l-9 11z"/></svg>
<span>–ê—á–∏–≤–∫–∏</span><div class="tab-dot"></div>
</button>
<button class="tab-item" onclick="switchTab(4)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.27 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/></svg>
<span>–õ–∏–¥–µ—Ä—ã</span><div class="tab-dot"></div>
</button>
<button class="tab-item" onclick="switchTab(5)">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
<span>–ü—Ä–æ—Ñ–∏–ª—å</span><div class="tab-dot"></div>
</button>
</div>
</div>

<script>
const tg=window.Telegram&&Telegram.WebApp?Telegram.WebApp:null;
if(tg){tg.ready();tg.expand();if(tg.setHeaderColor)tg.setHeaderColor('bg_color');}
const BOT_TOKEN='8328808800:AAGXn9OCZNgo79kcWZhnZgx4m1DEiUeVhdc';
function applyTheme(){const d=tg?tg.colorScheme==='dark':matchMedia('(prefers-color-scheme:dark)').matches;document.documentElement.className=d?'dark':'';}
applyTheme();if(tg)tg.onEvent('themeChanged',applyTheme);matchMedia('(prefers-color-scheme:dark)').addEventListener('change',applyTheme);
function getUserId(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)return String(tg.initDataUnsafe.user.id);let id=localStorage.getItem('v_uid');if(!id){id='local_'+Math.random().toString(36).substr(2,9);localStorage.setItem('v_uid',id);}return id;}
function getUserName(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user){const u=tg.initDataUnsafe.user;return u.first_name+(u.last_name?' '+u.last_name:'');}return'–ò–≥—Ä–æ–∫';}
function getUserUsername(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)return'@'+(tg.initDataUnsafe.user.username||'user'+tg.initDataUnsafe.user.id);return'@player';}
function getUserPhoto(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user&&tg.initDataUnsafe.user.photo_url)return tg.initDataUnsafe.user.photo_url;return'';}

// ===== FIREBASE =====
const firebaseConfig={apiKey:"AIzaSyCnFnvWy-gklDVNqWMOFdx9B9uJi0Lo-JU",authDomain:"telegrambotvriskas.firebaseapp.com",databaseURL:"https://telegrambotvriskas-default-rtdb.firebaseio.com",projectId:"telegrambotvriskas",storageBucket:"telegrambotvriskas.firebasestorage.app",messagingSenderId:"878769255530",appId:"1:878769255530:web:461ef3885f859f039d8613"};
firebase.initializeApp(firebaseConfig);const db=firebase.database();let fbReady=false;
const dbStatus=document.getElementById('db-status');

async function initFirebase(){
  dbStatus.textContent='‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';dbStatus.className='db-status offline';
  try{
    const t=db.ref('_ping');await t.set(Date.now());await t.remove();
    fbReady=true;dbStatus.textContent='üü¢ –û–Ω–ª–∞–π–Ω';dbStatus.className='db-status online';
    setTimeout(()=>{dbStatus.style.opacity='0';},2000);
    await loadFromCloud();
    db.ref('.info/connected').on('value',s=>{if(s.val()===true){fbReady=true;dbStatus.textContent='üü¢';dbStatus.className='db-status online';dbStatus.style.opacity='1';setTimeout(()=>{dbStatus.style.opacity='0';},1500);}else{dbStatus.textContent='‚ö†Ô∏è –û—Ñ—Ñ–ª–∞–π–Ω';dbStatus.className='db-status offline';dbStatus.style.opacity='1';}});
  }catch(e){
    console.error('FB:',e);fbReady=false;
    dbStatus.textContent='‚ùå –û—à–∏–±–∫–∞ –ë–î';dbStatus.className='db-status error';
    if(e.code==='PERMISSION_DENIED')showToast('‚ö†Ô∏è Firebase Rules!\n\nRealtime Database ‚Üí Rules:\n{\n  "rules": {\n    ".read": true,\n    ".write": true\n  }\n}');
  }
}

function getCloudData(){return{name:getUserName(),username:getUserUsername(),photo:getUserPhoto(),coins:S.coins,totalTaps:S.totalTaps,totalEarned:S.totalEarned,perTap:S.perTap,cps:S.cps,maxEnergy:S.maxEnergy,prestige:S.prestige||0,dailyStreak:S.dailyStreak||0,maxCombo:S.maxCombo||0,skin:S.skin||'classic',stolenStars:S.stolenStars||0,billionClaimed:S.billionClaimed||false,lastSync:Date.now()};}

async function syncToCloud(){if(!fbReady)return;try{await db.ref('vriskas_clicker/'+getUserId()).set(getCloudData());}catch(e){console.error('Sync:',e);}}
async function loadFromCloud(){if(!fbReady)return;try{const s=await db.ref('vriskas_clicker/'+getUserId()).once('value');const d=s.val();if(d&&(d.totalEarned||0)>(S.totalEarned||0)){S.coins=d.coins||0;S.totalTaps=d.totalTaps||0;S.totalEarned=d.totalEarned||0;S.perTap=d.perTap||1;S.cps=d.cps||0;S.maxEnergy=d.maxEnergy||500;S.skin=d.skin||'classic';S.prestige=d.prestige||0;S.dailyStreak=d.dailyStreak||0;S.maxCombo=d.maxCombo||0;S.stolenStars=d.stolenStars||0;S.billionClaimed=d.billionClaimed||false;S.upgrades=d.upgrades||{};S.premiumUpgrades=d.premiumUpgrades||{};S.ownedSkins=d.ownedSkins||['classic'];S.achievements=d.achievements||{};recalcStats();save();updateClickerUI();setClickerSkin(S.skin);showToast('‚òÅÔ∏è –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑ –æ–±–ª–∞–∫–∞');}}catch(e){console.error('Load:',e);}}
let syncC=0;function saveAndSync(){save();syncC++;if(syncC>=15){syncC=0;syncToCloud();}}

// ===== STATE =====
const SAVE_KEY='vriskas_v20';
function defaultState(){return{coins:0,totalTaps:0,totalEarned:0,energy:500,maxEnergy:500,perTap:1,cps:0,energyRegen:1,upgrades:{},premiumUpgrades:{},skin:'classic',ownedSkins:['classic'],lastTime:Date.now(),prestige:0,prestigeMultiplier:1,dailyStreak:0,lastDaily:0,maxCombo:0,achievements:{},stolenStars:0,billionClaimed:false,skinBonuses:{}};}
function loadState(){try{const s=localStorage.getItem(SAVE_KEY);if(s){const p=JSON.parse(s),d=defaultState();for(let k in d)if(!(k in p))p[k]=d[k];return p;}}catch(e){}return defaultState();}
function save(){S.lastTime=Date.now();localStorage.setItem(SAVE_KEY,JSON.stringify(S));}
let S=loadState();

// ===== SKINS WITH BONUSES =====
const SKINS={
classic:{name:'–ö–ª–∞—Å—Å–∏–∫–∞',price:0,bonus:null,bonusDesc:'',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="cg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFD700"/><stop offset="50%" stop-color="#FFA500"/><stop offset="100%" stop-color="#FF8C00"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#cg)" stroke="#B8860B" stroke-width="4"/><circle cx="100" cy="100" r="78" fill="none" stroke="#B8860B" stroke-width="2" opacity=".4"/><ellipse cx="72" cy="62" rx="32" ry="22" fill="rgba(255,255,255,.3)"/><text x="100" y="120" text-anchor="middle" font-size="64" font-weight="900" fill="#B8860B" font-family="sans-serif">V</text></svg>'},
ruby:{name:'–†—É–±–∏–Ω',price:2000,bonus:{perTap:2},bonusDesc:'+2 —Ç–∞–ø',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff1744"/><stop offset="50%" stop-color="#d50000"/><stop offset="100%" stop-color="#b71c1c"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#rg)" stroke="#880e4f" stroke-width="4"/><polygon points="100,30 65,75 55,75 100,155 145,75 135,75" fill="rgba(255,255,255,.25)" stroke="rgba(255,255,255,.35)" stroke-width="1.5"/><polygon points="100,30 80,75 120,75" fill="rgba(255,255,255,.15)"/><text x="100" y="118" text-anchor="middle" font-size="44" font-weight="900" fill="rgba(255,255,255,.9)" font-family="sans-serif">V</text></svg>'},
sapphire:{name:'–°–∞–ø—Ñ–∏—Ä',price:5000,bonus:{cps:3},bonusDesc:'+3/—Å–µ–∫',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="sag" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1565c0"/><stop offset="50%" stop-color="#0d47a1"/><stop offset="100%" stop-color="#0a2472"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#sag)" stroke="#0d47a1" stroke-width="4"/><polygon points="100,28 55,72 42,100 100,172 158,100 145,72" fill="none" stroke="rgba(255,255,255,.4)" stroke-width="2"/><polygon points="100,28 72,72 128,72" fill="rgba(255,255,255,.15)"/><line x1="72" y1="72" x2="100" y2="172" stroke="rgba(255,255,255,.15)" stroke-width="1.5"/><line x1="128" y1="72" x2="100" y2="172" stroke="rgba(255,255,255,.15)" stroke-width="1.5"/><text x="100" y="115" text-anchor="middle" font-size="40" font-weight="900" fill="rgba(255,255,255,.85)" font-family="sans-serif">V</text></svg>'},
emerald:{name:'–ò–∑—É–º—Ä—É–¥',price:8000,bonus:{energyRegen:3},bonusDesc:'+3 —Ä–µ–≥–µ–Ω',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="eg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#00e676"/><stop offset="50%" stop-color="#00c853"/><stop offset="100%" stop-color="#1b5e20"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#eg)" stroke="#2e7d32" stroke-width="4"/><rect x="68" y="48" width="64" height="104" rx="6" fill="rgba(255,255,255,.15)" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/><line x1="68" y1="72" x2="132" y2="72" stroke="rgba(255,255,255,.2)" stroke-width="1"/><line x1="68" y1="128" x2="132" y2="128" stroke="rgba(255,255,255,.2)" stroke-width="1"/><text x="100" y="115" text-anchor="middle" font-size="40" font-weight="900" fill="rgba(255,255,255,.85)" font-family="sans-serif">V</text></svg>'},
diamond:{name:'–ê–ª–º–∞–∑',price:15000,bonus:{perTap:5,cps:2},bonusDesc:'+5 —Ç–∞–ø, +2/—Å',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="dg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#E0F7FA"/><stop offset="30%" stop-color="#4DD0E1"/><stop offset="60%" stop-color="#0097A7"/><stop offset="100%" stop-color="#006064"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#dg)" stroke="#00838F" stroke-width="4"/><polygon points="100,28 142,78 162,78 100,172 38,78 58,78" fill="rgba(255,255,255,.25)" stroke="rgba(255,255,255,.4)" stroke-width="1.5"/><line x1="100" y1="28" x2="58" y2="78" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/><line x1="100" y1="28" x2="142" y2="78" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/><text x="100" y="112" text-anchor="middle" font-size="36" font-weight="900" fill="rgba(255,255,255,.9)" font-family="sans-serif">V</text></svg>'},
fire:{name:'–û–≥–æ–Ω—å',price:20000,bonus:{perTap:3,energyRegen:2},bonusDesc:'+3 —Ç–∞–ø, +2 —Ä–µ–≥',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="fg" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#FF6B00"/><stop offset="50%" stop-color="#FF3D00"/><stop offset="100%" stop-color="#DD2C00"/></linearGradient><radialGradient id="fg2" cx="50%" cy="70%" r="50%"><stop offset="0%" stop-color="#FFAB00" stop-opacity=".8"/><stop offset="100%" stop-color="#FF6D00" stop-opacity="0"/></radialGradient></defs><circle cx="100" cy="100" r="95" fill="url(#fg)" stroke="#BF360C" stroke-width="4"/><circle cx="100" cy="100" r="65" fill="url(#fg2)"/><path d="M100,35 Q120,65 108,85 Q130,55 124,40 Q150,75 140,108 Q146,90 155,85 Q158,125 130,150 Q140,135 134,125 Q120,160 100,164 Q80,160 66,125 Q60,135 70,150 Q42,125 42,85 Q52,90 52,108 Q48,75 76,40 Q70,55 92,85 Q80,65 100,35Z" fill="#FFAB00" opacity=".6"/><text x="100" y="118" text-anchor="middle" font-size="32" font-weight="900" fill="white" font-family="sans-serif" opacity=".9">V</text></svg>'},
ice:{name:'–õ—ë–¥',price:25000,bonus:{maxEnergy:200},bonusDesc:'+200 —ç–Ω–µ—Ä–≥–∏—è',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="ig" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e3f2fd"/><stop offset="30%" stop-color="#90caf9"/><stop offset="70%" stop-color="#42a5f5"/><stop offset="100%" stop-color="#1565c0"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#ig)" stroke="#1565c0" stroke-width="4"/><line x1="100" y1="30" x2="100" y2="170" stroke="rgba(255,255,255,.4)" stroke-width="2"/><line x1="30" y1="100" x2="170" y2="100" stroke="rgba(255,255,255,.4)" stroke-width="2"/><line x1="50" y1="50" x2="150" y2="150" stroke="rgba(255,255,255,.25)" stroke-width="1.5"/><line x1="150" y1="50" x2="50" y2="150" stroke="rgba(255,255,255,.25)" stroke-width="1.5"/><circle cx="100" cy="100" r="18" fill="rgba(255,255,255,.3)" stroke="rgba(255,255,255,.5)" stroke-width="1.5"/><text x="100" y="108" text-anchor="middle" font-size="18" font-weight="900" fill="white" font-family="sans-serif">V</text></svg>'},
galaxy:{name:'–ì–∞–ª–∞–∫—Ç–∏–∫–∞',price:35000,bonus:{cps:5,perTap:3},bonusDesc:'+5/—Å, +3 —Ç–∞–ø',
svg:'<svg viewBox="0 0 200 200"><defs><radialGradient id="gg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#7C4DFF"/><stop offset="40%" stop-color="#536DFE"/><stop offset="100%" stop-color="#1A237E"/></radialGradient></defs><circle cx="100" cy="100" r="95" fill="url(#gg)" stroke="#311B92" stroke-width="4"/><circle cx="58" cy="48" r="2" fill="white" opacity=".9"/><circle cx="142" cy="38" r="1.5" fill="white" opacity=".7"/><circle cx="43" cy="128" r="1" fill="white" opacity=".6"/><circle cx="157" cy="118" r="2" fill="white" opacity=".8"/><circle cx="78" cy="158" r="1.5" fill="white" opacity=".5"/><circle cx="122" cy="153" r="1" fill="white" opacity=".7"/><circle cx="48" cy="78" r="1" fill="white" opacity=".4"/><circle cx="152" cy="68" r="1.5" fill="white" opacity=".6"/><ellipse cx="100" cy="100" rx="65" ry="22" fill="none" stroke="rgba(255,255,255,.12)" stroke-width="6" transform="rotate(-30,100,100)"/><circle cx="100" cy="100" r="12" fill="rgba(255,255,255,.3)"/><text x="100" y="107" text-anchor="middle" font-size="12" font-weight="900" fill="white" font-family="sans-serif">V</text></svg>'},
toxic:{name:'–¢–æ–∫—Å–∏–∫',price:40000,bonus:{perTap:8},bonusDesc:'+8 —Ç–∞–ø',
svg:'<svg viewBox="0 0 200 200"><defs><radialGradient id="tg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#76ff03"/><stop offset="50%" stop-color="#64dd17"/><stop offset="100%" stop-color="#1b5e20"/></radialGradient></defs><circle cx="100" cy="100" r="95" fill="url(#tg)" stroke="#33691e" stroke-width="4"/><circle cx="75" cy="82" r="16" fill="#1b5e20" opacity=".7"/><circle cx="125" cy="82" r="16" fill="#1b5e20" opacity=".7"/><circle cx="75" cy="80" r="6" fill="#76ff03"/><circle cx="125" cy="80" r="6" fill="#76ff03"/><path d="M78,120 Q90,135 100,132 Q110,135 122,120" stroke="#1b5e20" stroke-width="3" fill="none" stroke-linecap="round"/><circle cx="55" cy="140" r="8" fill="rgba(118,255,3,.2)"/><circle cx="145" cy="55" r="6" fill="rgba(118,255,3,.15)"/><circle cx="40" cy="70" r="4" fill="rgba(118,255,3,.1)"/></svg>'},
skull:{name:'–ß–µ—Ä–µ–ø',price:50000,bonus:{perTap:5,cps:5},bonusDesc:'+5 —Ç–∞–ø, +5/—Å',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="sg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#424242"/><stop offset="100%" stop-color="#212121"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#sg)" stroke="#616161" stroke-width="4"/><ellipse cx="100" cy="86" rx="42" ry="44" fill="#E0E0E0"/><ellipse cx="100" cy="80" rx="39" ry="39" fill="#F5F5F5"/><ellipse cx="82" cy="76" rx="10" ry="12" fill="#212121"/><ellipse cx="118" cy="76" rx="10" ry="12" fill="#212121"/><ellipse cx="82" cy="74" rx="4" ry="4" fill="#F44336" opacity=".5"/><ellipse cx="118" cy="74" rx="4" ry="4" fill="#F44336" opacity=".5"/><ellipse cx="100" cy="95" rx="4" ry="5" fill="#424242"/><path d="M82,112 Q86,118 92,115 Q96,120 100,115 Q104,120 108,115 Q112,118 118,112 L118,122 Q110,126 100,126 Q90,126 82,122Z" fill="#E0E0E0" stroke="#BDBDBD" stroke-width="1"/></svg>'},
rainbow:{name:'–†–∞–¥—É–≥–∞',price:60000,bonus:{perTap:4,cps:4,energyRegen:2},bonusDesc:'+4 —Ç–∞–ø, +4/—Å, +2 —Ä–µ–≥',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="rbg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff0000"/><stop offset="17%" stop-color="#ff8800"/><stop offset="33%" stop-color="#ffff00"/><stop offset="50%" stop-color="#00ff00"/><stop offset="67%" stop-color="#0088ff"/><stop offset="83%" stop-color="#8800ff"/><stop offset="100%" stop-color="#ff00ff"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#rbg)" stroke="rgba(255,255,255,.5)" stroke-width="4"/><circle cx="100" cy="100" r="78" fill="none" stroke="rgba(255,255,255,.3)" stroke-width="2"/><circle cx="100" cy="100" r="60" fill="none" stroke="rgba(255,255,255,.2)" stroke-width="1.5"/><ellipse cx="72" cy="62" rx="28" ry="18" fill="rgba(255,255,255,.25)"/><text x="100" y="118" text-anchor="middle" font-size="50" font-weight="900" fill="white" font-family="sans-serif" stroke="rgba(0,0,0,.2)" stroke-width="1">V</text></svg>'},
neon:{name:'–ù–µ–æ–Ω',price:80000,bonus:{cps:10},bonusDesc:'+10/—Å–µ–∫',
svg:'<svg viewBox="0 0 200 200"><defs><radialGradient id="ng" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#1a1a2e"/><stop offset="100%" stop-color="#0a0a15"/></radialGradient><filter id="nG"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><circle cx="100" cy="100" r="95" fill="url(#ng)" stroke="#0ff" stroke-width="3" opacity=".8"/><circle cx="100" cy="100" r="84" fill="none" stroke="#0ff" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><circle cx="100" cy="100" r="65" fill="none" stroke="#f0f" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><circle cx="100" cy="100" r="45" fill="none" stroke="#0f0" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><text x="100" y="116" text-anchor="middle" font-size="50" font-weight="900" fill="#0ff" font-family="sans-serif" filter="url(#nG)">V</text></svg>'},
golden:{name:'–ó–æ–ª–æ—Ç–æ–π',price:100000,bonus:{perTap:10,cps:8,maxEnergy:500},bonusDesc:'+10 —Ç–∞–ø, +8/—Å, +500 üîã',
svg:'<svg viewBox="0 0 200 200"><defs><linearGradient id="gog" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fff176"/><stop offset="30%" stop-color="#ffd700"/><stop offset="60%" stop-color="#ffb300"/><stop offset="100%" stop-color="#ff8f00"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#gog)" stroke="#e65100" stroke-width="5"/><circle cx="100" cy="100" r="82" fill="none" stroke="rgba(255,255,255,.4)" stroke-width="2"/><circle cx="100" cy="100" r="68" fill="none" stroke="rgba(255,255,255,.25)" stroke-width="1.5"/><ellipse cx="72" cy="58" rx="30" ry="20" fill="rgba(255,255,255,.35)"/><text x="100" y="82" text-anchor="middle" font-size="14" font-weight="700" fill="rgba(180,100,0,.7)" font-family="sans-serif">‚òÖ GOLD ‚òÖ</text><text x="100" y="128" text-anchor="middle" font-size="58" font-weight="900" fill="#7b3f00" font-family="sans-serif">V</text></svg>'},
void:{name:'–ë–µ–∑–¥–Ω–∞',price:200000,bonus:{perTap:15,cps:15,energyRegen:5,maxEnergy:1000},bonusDesc:'+15 —Ç–∞–ø, +15/—Å, +5 —Ä–µ–≥, +1000 üîã',
svg:'<svg viewBox="0 0 200 200"><defs><radialGradient id="vg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#4a148c"/><stop offset="40%" stop-color="#1a0033"/><stop offset="100%" stop-color="#000"/></radialGradient><filter id="vG"><feGaussianBlur stdDeviation="2"/></filter></defs><circle cx="100" cy="100" r="95" fill="url(#vg)" stroke="#7c4dff" stroke-width="3"/><circle cx="100" cy="100" r="40" fill="none" stroke="#7c4dff" stroke-width="1" opacity=".4" filter="url(#vG)"/><circle cx="100" cy="100" r="60" fill="none" stroke="#e040fb" stroke-width=".8" opacity=".3" filter="url(#vG)"/><circle cx="100" cy="100" r="80" fill="none" stroke="#ea80fc" stroke-width=".6" opacity=".2" filter="url(#vG)"/><circle cx="100" cy="100" r="15" fill="#7c4dff" opacity=".3" filter="url(#vG)"/><circle cx="68" cy="55" r="1.5" fill="#ea80fc" opacity=".6"/><circle cx="135" cy="65" r="1" fill="#e040fb" opacity=".5"/><circle cx="55" cy="130" r="1" fill="#ea80fc" opacity=".4"/><circle cx="140" cy="140" r="1.5" fill="#7c4dff" opacity=".5"/><text x="100" y="110" text-anchor="middle" font-size="30" font-weight="900" fill="#ea80fc" font-family="sans-serif" filter="url(#vG)">V</text></svg>'}
};

function setClickerSkin(id){const s=SKINS[id];if(s)document.getElementById('click-btn').innerHTML=s.svg;}

// ===== COIN UPGRADES =====
const coinUpgrades=[
{id:'tap1',name:'–ö—Ä–µ–ø–∫–∏–π –ø–∞–ª–µ—Ü',desc:'+1 –∫ —Ç–∞–ø—É',icon:'üëÜ',bg:'linear-gradient(135deg,#ff9500,#ff6723)',base:50,mult:1.8,eff:'perTap',val:1,max:50},
{id:'tap2',name:'–ó–æ–ª–æ—Ç–æ–π –ø–∞–ª–µ—Ü',desc:'+3 –∫ —Ç–∞–ø—É',icon:'üèÜ',bg:'linear-gradient(135deg,#ffd700,#ff9500)',base:500,mult:2,eff:'perTap',val:3,max:30},
{id:'tap3',name:'–ê–ª–º–∞–∑–Ω—ã–π –ø–∞–ª–µ—Ü',desc:'+10 –∫ —Ç–∞–ø—É',icon:'üíé',bg:'linear-gradient(135deg,#4dd0e1,#0097a7)',base:5000,mult:2.2,eff:'perTap',val:10,max:20},
{id:'tap4',name:'–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–∞–ª–µ—Ü',desc:'+25 –∫ —Ç–∞–ø—É',icon:'üöÄ',bg:'linear-gradient(135deg,#7c4dff,#536dfe)',base:25000,mult:2.5,eff:'perTap',val:25,max:15},
{id:'energy1',name:'–ë–∞—Ç–∞—Ä–µ–π–∫–∞',desc:'+100 –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è',icon:'üîã',bg:'linear-gradient(135deg,#34c759,#30d158)',base:200,mult:1.6,eff:'maxEnergy',val:100,max:25},
{id:'energy2',name:'–†–µ–∞–∫—Ç–æ—Ä',desc:'+500 –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è',icon:'‚öõÔ∏è',bg:'linear-gradient(135deg,#5ac8fa,#007aff)',base:3000,mult:1.8,eff:'maxEnergy',val:500,max:15},
{id:'energy3',name:'–¢–µ—Ä–º–æ—è–¥',desc:'+2000 –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è',icon:'‚ò¢Ô∏è',bg:'linear-gradient(135deg,#ff9500,#ff3b30)',base:30000,mult:2,eff:'maxEnergy',val:2000,max:10},
{id:'regen1',name:'–£—Å–∫–æ—Ä–∏—Ç–µ–ª—å',desc:'+1 —Ä–µ–≥–µ–Ω/—Å–µ–∫',icon:'‚ö°',bg:'linear-gradient(135deg,#007aff,#5ac8fa)',base:300,mult:2,eff:'energyRegen',val:1,max:20},
{id:'regen2',name:'–¢—É—Ä–±–æ –∑–∞—Ä—è–¥',desc:'+5 —Ä–µ–≥–µ–Ω/—Å–µ–∫',icon:'üåä',bg:'linear-gradient(135deg,#32ade6,#5856d6)',base:4000,mult:2.2,eff:'energyRegen',val:5,max:10},
{id:'regen3',name:'–ö–≤–∞–Ω—Ç –∑–∞—Ä—è–¥',desc:'+15 —Ä–µ–≥–µ–Ω/—Å–µ–∫',icon:'‚ö°',bg:'linear-gradient(135deg,#ffd700,#ff6b00)',base:40000,mult:2.5,eff:'energyRegen',val:15,max:8},
{id:'auto1',name:'–ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä',desc:'+1 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü§ñ',bg:'linear-gradient(135deg,#5856d6,#af52de)',base:1000,mult:2.2,eff:'cps',val:1,max:25},
{id:'auto2',name:'–ú–µ–≥–∞-–±–æ—Ç',desc:'+5 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü¶ø',bg:'linear-gradient(135deg,#ff2d55,#ff6b81)',base:5000,mult:2.5,eff:'cps',val:5,max:15},
{id:'auto3',name:'–£–ª—å—Ç—Ä–∞-—Ñ–∞–±—Ä–∏–∫–∞',desc:'+25 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üè≠',bg:'linear-gradient(135deg,#ff9500,#ffd700)',base:50000,mult:3,eff:'cps',val:25,max:10},
{id:'auto4',name:'–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ò–ò',desc:'+100 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üß†',bg:'linear-gradient(135deg,#7c4dff,#e040fb)',base:500000,mult:3.5,eff:'cps',val:100,max:8},
{id:'multi1',name:'–ú–Ω–æ–∂–∏—Ç–µ–ª—å',desc:'x1.5 –∫ —Ç–∞–ø—É',icon:'‚úñÔ∏è',bg:'linear-gradient(135deg,#ff2d55,#ff9500)',base:100000,mult:3,eff:'perTapMult',val:1.5,max:5},
{id:'luck1',name:'–£–¥–∞—á–∞',desc:'–®–∞–Ω—Å x2 –º–æ–Ω–µ—Ç',icon:'üçÄ',bg:'linear-gradient(135deg,#34c759,#00c853)',base:20000,mult:2,eff:'luck',val:5,max:10},
{id:'magnet1',name:'–ú–∞–≥–Ω–∏—Ç –º–æ–Ω–µ—Ç',desc:'+10% –æ—Ñ—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥',icon:'üß≤',bg:'linear-gradient(135deg,#ff6b00,#ff3d00)',base:15000,mult:1.8,eff:'offlineBonus',val:10,max:10},
];

const starUpgrades=[
{id:'star_mega',name:'–ú–µ–≥–∞ –¢–∞–ø',desc:'–°–∏–ª–∞ —Ç–∞–ø–∞ x2 –Ω–∞–≤—Å–µ–≥–¥–∞',icon:'üí•',bg:'linear-gradient(135deg,#ff2d55,#ff9500)',stars:50,eff:'perTapMult',val:2,once:true},
{id:'star_energy',name:'–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è',desc:'–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è +5000',icon:'‚ôæÔ∏è',bg:'linear-gradient(135deg,#34c759,#00c7be)',stars:75,eff:'maxEnergy',val:5000,once:true},
{id:'star_auto',name:'–£–ª—å—Ç—Ä–∞-–±–æ—Ç',desc:'+50 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü¶æ',bg:'linear-gradient(135deg,#5856d6,#007aff)',stars:100,eff:'cps',val:50,once:true},
{id:'star_regen',name:'–ú–µ–≥–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è',desc:'+20 —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Å–µ–∫',icon:'üåä',bg:'linear-gradient(135deg,#5ac8fa,#007aff)',stars:60,eff:'energyRegen',val:20,once:true},
{id:'star_tap10',name:'–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Ç–∞–ø',desc:'+50 –∫ —Ç–∞–ø—É',icon:'‚ú®',bg:'linear-gradient(135deg,#ffd700,#ff2d55)',stars:150,eff:'perTap',val:50,once:true},
{id:'star_pack',name:'–°—Ç–∞—Ä—Ç–æ–≤—ã–π –ø–∞–∫',desc:'+10000 –º–æ–Ω–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ',icon:'üí∞',bg:'linear-gradient(135deg,#ff9500,#ffd700)',stars:30,eff:'coins',val:10000,once:false},
{id:'star_prestige',name:'–ü—Ä–µ—Å—Ç–∏–∂ x2',desc:'–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ø—Ä–µ—Å—Ç–∏–∂–∞ x2',icon:'üëë',bg:'linear-gradient(135deg,#ffd700,#ff6b00)',stars:200,eff:'prestigeMult',val:2,once:true},
];

function getUpgradeCost(item){const l=S.upgrades[item.id]||0;return Math.floor(item.base*Math.pow(item.mult,l));}

// ===== ACHIEVEMENTS (40+) =====
const ACHIEVEMENTS=[
{id:'taps10',name:'–ù–æ–≤–∏—á–æ–∫',desc:'10 —Ç–∞–ø–æ–≤',icon:'üë∂',check:()=>S.totalTaps>=10,reward:50},
{id:'taps100',name:'–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏',desc:'100 —Ç–∞–ø–æ–≤',icon:'üë£',check:()=>S.totalTaps>=100,reward:100},
{id:'taps500',name:'–°—Ç–∞—Ä–∞—Ç–µ–ª—å',desc:'500 —Ç–∞–ø–æ–≤',icon:'‚õèÔ∏è',check:()=>S.totalTaps>=500,reward:300},
{id:'taps1k',name:'–ö–ª–∏–∫–µ—Ä',desc:'1,000 —Ç–∞–ø–æ–≤',icon:'üëÜ',check:()=>S.totalTaps>=1000,reward:500},
{id:'taps5k',name:'–¢–∞–ø–æ–º–∞–Ω',desc:'5,000 —Ç–∞–ø–æ–≤',icon:'üñêÔ∏è',check:()=>S.totalTaps>=5000,reward:1500},
{id:'taps10k',name:'–ú–∞–Ω—å—è–∫ –∫–ª–∏–∫–æ–≤',desc:'10,000 —Ç–∞–ø–æ–≤',icon:'ü§Ø',check:()=>S.totalTaps>=10000,reward:2000},
{id:'taps50k',name:'–ë–µ–∑—É–º–µ—Ü',desc:'50,000 —Ç–∞–ø–æ–≤',icon:'üòµ',check:()=>S.totalTaps>=50000,reward:5000},
{id:'taps100k',name:'–õ–µ–≥–µ–Ω–¥–∞ –∫–ª–∏–∫–µ—Ä–∞',desc:'100,000 —Ç–∞–ø–æ–≤',icon:'üèõÔ∏è',check:()=>S.totalTaps>=100000,reward:10000},
{id:'taps500k',name:'–ü–æ–ª—É–±–æ–≥',desc:'500,000 —Ç–∞–ø–æ–≤',icon:'‚ö°',check:()=>S.totalTaps>=500000,reward:25000},
{id:'taps1m',name:'–ë–æ–≥ –∫–ª–∏–∫–µ—Ä–∞',desc:'1,000,000 —Ç–∞–ø–æ–≤',icon:'üåü',check:()=>S.totalTaps>=1000000,reward:50000},
{id:'earn100',name:'–ü–µ—Ä–≤—ã–µ –º–æ–Ω–µ—Ç—ã',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 100',icon:'ü™ô',check:()=>S.totalEarned>=100,reward:50},
{id:'earn1k',name:'–ö–æ–ø–∏–ª–∫–∞',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1K',icon:'üê∑',check:()=>S.totalEarned>=1000,reward:200},
{id:'earn10k',name:'–ë–æ–≥–∞—á',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10K',icon:'üí∞',check:()=>S.totalEarned>=10000,reward:1000},
{id:'earn50k',name:'–¢–æ–ª—Å—Ç–æ—Å—É–º',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 50K',icon:'ü§ë',check:()=>S.totalEarned>=50000,reward:3000},
{id:'earn100k',name:'–ú–∏–ª–ª–∏–æ–Ω–µ—Ä',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 100K',icon:'üí∏',check:()=>S.totalEarned>=100000,reward:5000},
{id:'earn500k',name:'–û–ª–∏–≥–∞—Ä—Ö',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 500K',icon:'üè¶',check:()=>S.totalEarned>=500000,reward:15000},
{id:'earn1m',name:'–ú–∞–≥–Ω–∞—Ç',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1M',icon:'üëë',check:()=>S.totalEarned>=1000000,reward:25000},
{id:'earn10m',name:'–¢—Ä–∏–ª–ª–∏–æ–Ω–µ—Ä',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10M',icon:'üåç',check:()=>S.totalEarned>=10000000,reward:100000},
{id:'combo5',name:'–†–∞–∑–º–∏–Ω–∫–∞',desc:'–ö–æ–º–±–æ x5',icon:'üî•',check:()=>S.maxCombo>=5,reward:100},
{id:'combo10',name:'–ö–æ–º–±–æ –º–∞—Å—Ç–µ—Ä',desc:'–ö–æ–º–±–æ x10',icon:'üî•',check:()=>S.maxCombo>=10,reward:300},
{id:'combo25',name:'–ö–æ–º–±–æ –∞—Å',desc:'–ö–æ–º–±–æ x25',icon:'üí•',check:()=>S.maxCombo>=25,reward:1000},
{id:'combo50',name:'–ö–æ–º–±–æ –±–æ–≥',desc:'–ö–æ–º–±–æ x50',icon:'üåã',check:()=>S.maxCombo>=50,reward:3000},
{id:'combo100',name:'–ö–æ–º–±–æ –¥–µ–º–æ–Ω',desc:'–ö–æ–º–±–æ x100',icon:'üëπ',check:()=>S.maxCombo>=100,reward:10000},
{id:'skin2',name:'–ü–µ—Ä–≤—ã–π —Å–∫–∏–Ω',desc:'–ö—É–ø–∏ 2 —Å–∫–∏–Ω–∞',icon:'üé®',check:()=>S.ownedSkins.length>=2,reward:500},
{id:'skin4',name:'–ú–æ–¥–Ω–∏–∫',desc:'–ö—É–ø–∏ 4 —Å–∫–∏–Ω–∞',icon:'üëî',check:()=>S.ownedSkins.length>=4,reward:2000},
{id:'skin7',name:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä',desc:'–ö—É–ø–∏ 7 —Å–∫–∏–Ω–æ–≤',icon:'üñºÔ∏è',check:()=>S.ownedSkins.length>=7,reward:5000},
{id:'skin10',name:'–§–µ—à–Ω',desc:'–ö—É–ø–∏ 10 —Å–∫–∏–Ω–æ–≤',icon:'üíÖ',check:()=>S.ownedSkins.length>=10,reward:15000},
{id:'skinAll',name:'–í—Å–µ —Å–∫–∏–Ω—ã!',desc:'–°–æ–±–µ—Ä–∏ –≤—Å–µ —Å–∫–∏–Ω—ã',icon:'üëó',check:()=>S.ownedSkins.length>=Object.keys(SKINS).length,reward:50000},
{id:'prestige1',name:'–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ',desc:'–ü–µ—Ä–≤—ã–π –ø—Ä–µ—Å—Ç–∏–∂',icon:'‚ôªÔ∏è',check:()=>S.prestige>=1,reward:0},
{id:'prestige3',name:'–û–ø—ã—Ç–Ω—ã–π',desc:'3 –ø—Ä–µ—Å—Ç–∏–∂–∞',icon:'üîÑ',check:()=>S.prestige>=3,reward:0},
{id:'prestige5',name:'–í–µ—Ç–µ—Ä–∞–Ω',desc:'5 –ø—Ä–µ—Å—Ç–∏–∂–µ–π',icon:'‚≠ê',check:()=>S.prestige>=5,reward:0},
{id:'prestige10',name:'–ú–∞—Å—Ç–µ—Ä',desc:'10 –ø—Ä–µ—Å—Ç–∏–∂–µ–π',icon:'üåü',check:()=>S.prestige>=10,reward:0},
{id:'daily3',name:'3 –¥–Ω—è –ø–æ–¥—Ä—è–¥',desc:'3 –¥–Ω—è –±–æ–Ω—É—Å–∞',icon:'üìÖ',check:()=>S.dailyStreak>=3,reward:500},
{id:'daily7',name:'–ù–µ–¥–µ–ª—è',desc:'7 –¥–Ω–µ–π –±–æ–Ω—É—Å–∞',icon:'üìÖ',check:()=>S.dailyStreak>=7,reward:3000},
{id:'daily14',name:'2 –Ω–µ–¥–µ–ª–∏',desc:'14 –¥–Ω–µ–π –±–æ–Ω—É—Å–∞',icon:'üìÖ',check:()=>S.dailyStreak>=14,reward:7000},
{id:'daily30',name:'–ú–µ—Å—è—Ü!',desc:'30 –¥–Ω–µ–π –±–æ–Ω—É—Å–∞',icon:'üóìÔ∏è',check:()=>S.dailyStreak>=30,reward:15000},
{id:'cps5',name:'–ü–∞—Å—Å–∏–≤–Ω—ã–π',desc:'5 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üìà',check:()=>S.cps>=5,reward:500},
{id:'cps10',name:'–ê–≤—Ç–æ–º–∞—Ç',desc:'10 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üìà',check:()=>S.cps>=10,reward:1000},
{id:'cps50',name:'–§–∞–±—Ä–∏–∫–∞',desc:'50 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üè≠',check:()=>S.cps>=50,reward:5000},
{id:'cps100',name:'–ò–º–ø–µ—Ä–∏—è',desc:'100 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üè∞',check:()=>S.cps>=100,reward:15000},
{id:'pertap10',name:'–°–∏–ª—å–Ω—ã–π',desc:'10 –∑–∞ —Ç–∞–ø',icon:'üí™',check:()=>S.perTap>=10,reward:1000},
{id:'pertap50',name:'–ú–æ—â–Ω—ã–π',desc:'50 –∑–∞ —Ç–∞–ø',icon:'üí™',check:()=>S.perTap>=50,reward:5000},
{id:'pertap100',name:'–ù–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π',desc:'100 –∑–∞ —Ç–∞–ø',icon:'ü¶∏',check:()=>S.perTap>=100,reward:15000},
{id:'pertap500',name:'–í—Å–µ—Å–∏–ª—å–Ω—ã–π',desc:'500 –∑–∞ —Ç–∞–ø',icon:'ü¶∏',check:()=>S.perTap>=500,reward:50000},
{id:'steal1',name:'–í–æ—Ä–∏—à–∫–∞',desc:'–£–∫—Ä–∞–¥–∏ 1 —Ä–∞–∑',icon:'ü¶ù',check:()=>S.stolenStars>=1,reward:5000},
{id:'steal5',name:'–ì—Ä–∞–±–∏—Ç–µ–ª—å',desc:'–£–∫—Ä–∞–¥–∏ 5 —Ä–∞–∑',icon:'ü¶π',check:()=>S.stolenStars>=5,reward:20000},
{id:'billion',name:'–ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä',desc:'–ó–∞—è–≤–∏ 1B –º–æ–Ω–µ—Ç',icon:'üíé',check:()=>S.billionClaimed,reward:0},
];

function checkAchievements(){let n=false;ACHIEVEMENTS.forEach(a=>{if(!S.achievements[a.id]&&a.check()){S.achievements[a.id]=Date.now();if(a.reward>0){S.coins+=a.reward;S.totalEarned+=a.reward;}n=true;showToast('üèÖ '+a.name+(a.reward?'\n+'+formatNum(a.reward)+' –º–æ–Ω–µ—Ç':''));if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');}});if(n){save();updateClickerUI();}}

// ===== DAILY =====
function canClaimDaily(){if(!S.lastDaily)return true;const n=new Date(),l=new Date(S.lastDaily);return n.toDateString()!==l.toDateString();}
function claimDaily(){if(!canClaimDaily())return;const n=new Date(),l=S.lastDaily?new Date(S.lastDaily):null;if(l){const d=(n-l)/(1000*60*60*24);if(d<2)S.dailyStreak++;else S.dailyStreak=1;}else S.dailyStreak=1;const r=100*S.dailyStreak*(S.prestigeMultiplier||1);S.coins+=r;S.totalEarned+=r;S.lastDaily=Date.now();save();syncToCloud();updateClickerUI();renderDaily();checkAchievements();showToast('üéÅ –ë–æ–Ω—É—Å!\n+'+formatNum(r)+' –º–æ–Ω–µ—Ç\nüî• '+S.dailyStreak+' –¥–Ω–µ–π');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');}
function renderDaily(){const c=document.getElementById('daily-container');const can=canClaimDaily();if(can){const r=100*(S.dailyStreak+1)*(S.prestigeMultiplier||1);c.innerHTML='<div class="daily-section" onclick="claimDaily()"><div class="daily-title">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</div><div class="daily-desc">–ó–∞–±–µ—Ä–∏ +'+formatNum(r)+' –º–æ–Ω–µ—Ç!</div><div class="daily-streak">üî• –°–µ—Ä–∏—è: '+S.dailyStreak+' –¥–Ω–µ–π</div></div>';}else{c.innerHTML='<div class="daily-section claimed"><div class="daily-title">‚úÖ –ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω</div><div class="daily-desc">–í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞!</div><div class="daily-streak">üî• –°–µ—Ä–∏—è: '+S.dailyStreak+' –¥–Ω–µ–π</div></div>';}}

// ===== PRESTIGE =====
function getPrestigeBonus(){return Math.floor(S.totalEarned/100000);}
function renderPrestige(){const c=document.getElementById('prestige-container');const b=getPrestigeBonus();c.innerHTML='<div class="prestige-section'+(b>0?'':' disabled')+'" onclick="'+(b>0?'doPrestige()':'')+'"><div class="prestige-title">üíé –ü—Ä–µ—Å—Ç–∏–∂</div><div class="prestige-desc">–°–±—Ä–æ—Å—å –∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å</div><div class="prestige-info">+'+b+'% –±–æ–Ω—É—Å'+(S.prestige>0?' ‚Ä¢ –¢–µ–∫—É—â–∏–π: x'+(S.prestigeMultiplier||1).toFixed(1):'')+'</div></div>';}
function doPrestige(){const b=getPrestigeBonus();if(b<=0)return;showModal('üíé –ü—Ä–µ—Å—Ç–∏–∂','–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ +'+b+'% –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≤—Å–µ–≥–¥–∞?','–ü—Ä–µ—Å—Ç–∏–∂!',()=>{S.prestige=(S.prestige||0)+1;S.prestigeMultiplier=(S.prestigeMultiplier||1)+b/100;S.coins=0;S.totalTaps=0;S.totalEarned=0;S.energy=500;S.maxEnergy=500;S.perTap=1;S.cps=0;S.energyRegen=1;S.upgrades={};S.skin='classic';S.ownedSkins=['classic'];S.maxCombo=0;recalcStats();save();syncToCloud();setClickerSkin('classic');updateClickerUI();renderPrestige();checkAchievements();showToast('üíé –ü—Ä–µ—Å—Ç–∏–∂ #'+S.prestige+'!\nx'+(S.prestigeMultiplier).toFixed(1));if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');closeModal();},'danger');}

// ===== BILLION BUTTON =====
function renderBillion(){const c=document.getElementById('billion-container');if(S.billionClaimed){c.innerHTML='<div class="billion-btn disabled"><div class="billion-title">‚úÖ –ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä ‚Äî –ø–æ–ª—É—á–µ–Ω–æ!</div></div>';return;}const can=S.coins>=1000000000;c.innerHTML='<div class="billion-btn'+(can?'':' disabled')+'" onclick="'+(can?'claimBillion()':'')+'"><div class="billion-title">üí∞ –°—Ç–∞—Ç—å –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä–æ–º</div><div class="billion-desc">–ü–æ—Ç—Ä–∞—Ç—å 1,000,000,000 –º–æ–Ω–µ—Ç ‚Üí –ø–æ–ª—É—á–∏ –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ + —Ç–∏—Ç—É–ª!</div></div>';}
function claimBillion(){if(S.coins<1000000000||S.billionClaimed)return;showModal('üí∞ –ú–ò–õ–õ–ò–ê–†–î–ï–†','–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å 1,000,000,000 –º–æ–Ω–µ—Ç?\n–û–Ω–∏ –≤–µ—Ä–Ω—É—Ç—Å—è + —Ç—ã –ø–æ–ª—É—á–∏—à—å —Ç–∏—Ç—É–ª!','–î–∞!',()=>{S.coins-=1000000000;S.coins+=1000000000;S.billionClaimed=true;save();syncToCloud();updateClickerUI();renderBillion();checkAchievements();showToast('üéâ –¢–´ –ú–ò–õ–õ–ò–ê–†–î–ï–†!\nüí∞ 1,000,000,000 –≤–µ—Ä–Ω—É–ª–∏—Å—å!');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');closeModal();},'primary');}

// ===== STEAL WHEEL =====
async function openStealWheel(){
  if(S.coins<1000000){showToast('ü™ô –ù—É–∂–Ω–æ 1,000,000 –º–æ–Ω–µ—Ç');return;}
  showModal('üé∞ –ö–æ–ª–µ—Å–æ –ö—Ä–∞–∂–∏','–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å 1,000,000 –º–æ–Ω–µ—Ç —á—Ç–æ–±—ã\n—É–∫—Ä–∞—Å—Ç—å –∑–≤—ë–∑–¥—ã —É —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞?','–ö—Ä—É—Ç–∏—Ç—å!',async()=>{
    S.coins-=1000000;save();updateClickerUI();closeModal();
    let players=[];
    if(fbReady){try{const s=await db.ref('vriskas_clicker').orderByChild('totalEarned').limitToLast(50).once('value');s.forEach(c=>{const d=c.val();if(d&&d.name&&c.key!==getUserId())players.push({uid:c.key,...d});});}catch(e){}}
    if(players.length<2){players=[{name:'–ü—Ä–∏–∑—Ä–∞–∫',totalEarned:1000},{name:'–¢–µ–Ω—å',totalEarned:2000},{name:'–§–∞–Ω—Ç–æ–º',totalEarned:5000},{name:'–ú–æ—Ä–æ–∫',totalEarned:3000},{name:'–ú–∏—Ä–∞–∂',totalEarned:4000}];}
    startWheel(players);
  },'danger');
}

function startWheel(players){
  const mb=document.getElementById('modal-box');
  const winner=players[Math.floor(Math.random()*players.length)];
  const stars=Math.floor(Math.random()*3)+1;
  let html='<div class="modal-title">üé∞ –ö—Ä—É—Ç–∏–º...</div><div class="wheel-container"><canvas class="wheel-canvas" id="wheelCanvas" width="240" height="240"></canvas><div class="wheel-pointer">üîª</div></div><div class="wheel-result" id="wheelResult"></div>';
  mb.innerHTML=html;document.getElementById('modal').classList.add('show');
  const canvas=document.getElementById('wheelCanvas');const ctx=canvas.getContext('2d');
  const colors=['#ff3b30','#ff9500','#ffcc00','#34c759','#007aff','#5856d6','#af52de','#ff2d55'];
  const segments=players.length;const arc=2*Math.PI/segments;
  const winIdx=players.indexOf(winner);
  const targetAngle=2*Math.PI*8+(2*Math.PI-winIdx*arc-arc/2);
  let currentAngle=0;const duration=4000;const startTime=Date.now();
  function draw(){
    const elapsed=Date.now()-startTime;const progress=Math.min(elapsed/duration,1);
    const eased=1-Math.pow(1-progress,4);
    currentAngle=targetAngle*eased;
    ctx.clearRect(0,0,240,240);ctx.save();ctx.translate(120,120);
    for(let i=0;i<segments;i++){
      ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,116,i*arc-Math.PI/2+currentAngle,(i+1)*arc-Math.PI/2+currentAngle);
      ctx.fillStyle=colors[i%colors.length];ctx.fill();ctx.strokeStyle='rgba(255,255,255,.3)';ctx.lineWidth=2;ctx.stroke();
      ctx.save();ctx.rotate(i*arc+arc/2+currentAngle-Math.PI/2);ctx.fillStyle='white';ctx.font='bold 11px Inter';ctx.textAlign='center';
      const name=players[i].name.length>8?players[i].name.substr(0,7)+'‚Ä¶':players[i].name;
      ctx.fillText(name,0,-85);ctx.restore();
    }
    ctx.restore();
    if(progress<1){requestAnimationFrame(draw);}
    else{
      document.getElementById('wheelResult').innerHTML='<div style="color:var(--green);font-size:16px;font-weight:800">üéâ –£–∫—Ä–∞–¥–µ–Ω–æ —É '+winner.name+'!</div><div style="color:var(--orange);font-size:20px;font-weight:900;margin-top:4px">‚≠ê +'+stars+' –∑–≤—ë–∑–¥</div><button class="modal-btn primary" style="margin-top:12px" onclick="closeModal()">–ó–∞–±—Ä–∞—Ç—å!</button>';
      S.stolenStars=(S.stolenStars||0)+1;save();syncToCloud();checkAchievements();
      if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
    }
  }
  draw();
}

// ===== COMBO =====
let comboCount=0,comboTimer=null;
function doCombo(){comboCount++;if(comboCount>S.maxCombo){S.maxCombo=comboCount;document.getElementById('combo-max').textContent=S.maxCombo;}clearTimeout(comboTimer);comboTimer=setTimeout(()=>{comboCount=0;document.getElementById('combo-text').classList.remove('show');},1200);if(comboCount>=3){const el=document.getElementById('combo-text');el.textContent='üî• COMBO x'+comboCount;el.classList.remove('show');void el.offsetWidth;el.classList.add('show');}}
function getComboMultiplier(){if(comboCount<5)return 1;if(comboCount<15)return 1.5;if(comboCount<30)return 2;if(comboCount<50)return 3;return 5;}

// ===== OFFLINE =====
function applyOffline(){const now=Date.now(),diff=Math.min((now-S.lastTime)/1000,14400);const offlineBonus=1+(S.upgrades.magnet1||0)*0.1;if(diff>5&&S.cps>0){const e=Math.floor(S.cps*diff*(S.prestigeMultiplier||1)*offlineBonus);S.coins+=e;S.totalEarned+=e;showToast('üí∞ –û—Ñ—Ñ–ª–∞–π–Ω:\n+'+formatNum(e)+' –º–æ–Ω–µ—Ç!');}S.energy=Math.min(S.energy+Math.floor(S.energyRegen*diff),S.maxEnergy);S.lastTime=now;save();}

// ===== HELPERS =====
function formatNum(n){if(n>=1e12)return(n/1e12).toFixed(1)+'T';if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e4)return(n/1e3).toFixed(1)+'K';return n.toLocaleString('ru');}
function showToast(t){const el=document.getElementById('toast');el.textContent=t;el.classList.add('show');clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),2500);}

// ===== MODAL =====
function showModal(title,desc,btnText,onConfirm,btnClass='primary'){
  const mb=document.getElementById('modal-box');
  mb.innerHTML='<div class="modal-title">'+title+'</div><div class="modal-desc">'+desc+'</div><div class="modal-btns"><button class="modal-btn cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button><button class="modal-btn '+btnClass+'" id="modal-confirm">'+btnText+'</button></div>';
  document.getElementById('modal-confirm').onclick=onConfirm;
  document.getElementById('modal').classList.add('show');
}
function closeModal(){document.getElementById('modal').classList.remove('show');}

// ===== TABS =====
let curTab=0;const pages=['page-clicker','page-shop','page-skins','page-ach','page-leaders','page-profile'];
function switchTab(idx){if(curTab===idx)return;curTab=idx;pages.forEach((id,i)=>{document.getElementById(id).classList.toggle('active',i===idx);});document.querySelectorAll('.tab-item').forEach((t,i)=>t.classList.toggle('active',i===idx));if(idx===1)renderShop();if(idx===2)renderSkins();if(idx===3)renderAchievements();if(idx===4)renderLeaderboard();if(idx===5)renderProfile();if(tg&&tg.HapticFeedback)tg.HapticFeedback.selectionChanged();}

// ===== CLICKER =====
const clickBtn=document.getElementById('click-btn');const clickerArea=document.getElementById('clicker-area');
clickBtn.addEventListener('pointerdown',e=>{e.preventDefault();doClick(e);});

function doClick(e){
  if(S.energy<=0){showToast('‚ö° –ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('error');return;}
  doCombo();
  let mult=getComboMultiplier()*(S.prestigeMultiplier||1);
  const luckLvl=S.upgrades.luck1||0;if(luckLvl>0&&Math.random()*100<luckLvl*5)mult*=2;
  const earned=Math.floor(S.perTap*mult);
  S.coins+=earned;S.totalTaps++;S.totalEarned+=earned;S.energy=Math.max(0,S.energy-1);
  const rect=clickerArea.getBoundingClientRect();const cx=e.clientX||rect.left+rect.width/2;const cy=e.clientY||rect.top+80;
  const ft=document.createElement('div');ft.className='float-text';ft.textContent='+'+formatNum(earned)+(mult>1?' üî•':'');ft.style.left=(cx-rect.left-20)+'px';ft.style.top=(cy-rect.top-20)+'px';clickerArea.appendChild(ft);setTimeout(()=>ft.remove(),800);
  const ring=document.createElement('div');ring.className='pulse-ring';const br=clickBtn.getBoundingClientRect();ring.style.left=(br.left-rect.left)+'px';ring.style.top=(br.top-rect.top)+'px';clickerArea.appendChild(ring);setTimeout(()=>ring.remove(),400);
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.impactOccurred('light');
  updateClickerUI();saveAndSync();if(S.totalTaps%50===0)checkAchievements();
}

function updateClickerUI(){
  document.getElementById('score').textContent=formatNum(S.coins);
  document.getElementById('per-tap-val').textContent=formatNum(S.perTap);
  document.getElementById('energy-val').textContent=S.energy;
  document.getElementById('energy-max').textContent=S.maxEnergy;
  document.getElementById('energy-bar').style.width=(S.energy/S.maxEnergy*100)+'%';
  document.getElementById('total-taps').textContent=formatNum(S.totalTaps);
  document.getElementById('total-earned').textContent=formatNum(S.totalEarned);
  document.getElementById('cps-val').textContent=formatNum(S.cps);
  document.getElementById('combo-max').textContent=S.maxCombo;
  const bb=document.getElementById('boost-badges');const bs=[];
  if(S.premiumUpgrades&&S.premiumUpgrades.star_mega)bs.push('x2 –¢–∞–ø');
  if(S.cps>0)bs.push(formatNum(S.cps)+'/—Å');
  if((S.prestigeMultiplier||1)>1)bs.push('x'+(S.prestigeMultiplier).toFixed(1));
  if(S.billionClaimed)bs.push('üí∞ –ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä');
  bb.innerHTML=bs.map(b=>'<span class="boost-badge">'+b+'</span>').join('');
}

setInterval(()=>{if(S.energy<S.maxEnergy)S.energy=Math.min(S.energy+S.energyRegen,S.maxEnergy);if(S.cps>0){const e=Math.floor(S.cps*(S.prestigeMultiplier||1));S.coins+=e;S.totalEarned+=e;}updateClickerUI();save();},1000);

// ===== SHOP =====
let shopTab='coins';
function switchShopTab(t){shopTab=t;document.querySelectorAll('.shop-tab').forEach((el,i)=>el.classList.toggle('active',t==='coins'?i===0:t==='special'?i===1:i===2));renderShop();}

function renderShop(){
  document.getElementById('shop-balance').textContent=formatNum(S.coins);
  const c=document.getElementById('shop-content');
  if(shopTab==='coins'){
    let h='<div class="shop-section-title">üí™ –ü—Ä–æ–∫–∞—á–∫–∞</div><div class="shop-list">';
    coinUpgrades.forEach(item=>{const l=S.upgrades[item.id]||0;const cost=getUpgradeCost(item);const can=S.coins>=cost&&l<item.max;const maxed=l>=item.max;
    h+='<div class="shop-item" '+(can?'onclick="buyCoin(\''+item.id+'\')"':'')+
    '><div class="shop-icon" style="background:'+item.bg+'">'+item.icon+'</div><div class="shop-info"><div class="shop-name">'+item.name+'</div><div class="shop-desc">'+item.desc+'</div><div class="shop-level">–£—Ä. '+l+'/'+item.max+'</div></div><button class="shop-btn coins-btn" '+(!can?'disabled':'')+'>'+
    (maxed?'MAX':'ü™ô '+formatNum(cost))+'</button></div>';});
    h+='</div>';c.innerHTML=h;
  } else if(shopTab==='special'){
    let h='<div class="shop-section-title">üé∞ –û—Å–æ–±—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</div><div class="shop-list">';
    h+='<div class="shop-item special" onclick="openStealWheel()"><div class="shop-icon" style="background:linear-gradient(135deg,#ff2d55,#ff9500)">üé∞</div><div class="shop-info"><div class="shop-name">–ö–æ–ª–µ—Å–æ –ö—Ä–∞–∂–∏</div><div class="shop-desc">–£–∫—Ä–∞–¥–∏ –∑–≤—ë–∑–¥—ã —É —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞!</div><div class="shop-level">–£–∫—Ä–∞–¥–µ–Ω–æ: '+(S.stolenStars||0)+' —Ä–∞–∑</div></div><button class="shop-btn coins-btn"'+(S.coins<1000000?' disabled':'')+'>ü™ô 1M</button></div>';
    h+='<div class="shop-item special" onclick="buyFullEnergy()"><div class="shop-icon" style="background:linear-gradient(135deg,#34c759,#00c7be)">‚ö°</div><div class="shop-info"><div class="shop-name">–ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è</div><div class="shop-desc">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é</div></div><button class="shop-btn coins-btn"'+(S.coins<5000?' disabled':'')+'>ü™ô 5K</button></div>';
    h+='<div class="shop-item special" onclick="buyDoubleCoins()"><div class="shop-icon" style="background:linear-gradient(135deg,#ffd700,#ff9500)">x2</div><div class="shop-info"><div class="shop-name">x2 –º–æ–Ω–µ—Ç—ã (60 —Å–µ–∫)</div><div class="shop-desc">–î–≤–æ–π–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –Ω–∞ –º–∏–Ω—É—Ç—É!</div></div><button class="shop-btn coins-btn"'+(S.coins<25000?' disabled':'')+'>ü™ô 25K</button></div>';
    h+='<div class="shop-item special" onclick="buyMegaCombo()"><div class="shop-icon" style="background:linear-gradient(135deg,#ff2d55,#ff6b81)">üî•</div><div class="shop-info"><div class="shop-name">–ú–µ–≥–∞ –∫–æ–º–±–æ</div><div class="shop-desc">–ö–æ–º–±–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ = x50!</div></div><button class="shop-btn coins-btn"'+(S.coins<50000?' disabled':'')+'>ü™ô 50K</button></div>';
    h+='<div class="shop-item special" onclick="buyRandomSkin()"><div class="shop-icon" style="background:linear-gradient(135deg,#5856d6,#af52de)">üéÅ</div><div class="shop-info"><div class="shop-name">–†–∞–Ω–¥–æ–º —Å–∫–∏–Ω</div><div class="shop-desc">–°–ª—É—á–∞–π–Ω—ã–π —Å–∫–∏–Ω —Å–æ —Å–∫–∏–¥–∫–æ–π!</div></div><button class="shop-btn coins-btn"'+(S.coins<10000?' disabled':'')+'>ü™ô 10K</button></div>';
    h+='</div>';c.innerHTML=h;
  } else {
    let h='<div class="shop-section-title">‚≠ê –ü—Ä–µ–º–∏—É–º –∑–∞ Stars</div><div class="shop-list">';
    starUpgrades.forEach(item=>{const bought=S.premiumUpgrades&&S.premiumUpgrades[item.id];const can=item.once?!bought:true;
    h+='<div class="shop-item" '+(can?'onclick="buyStar(\''+item.id+'\')"':'')+
    '><div class="shop-icon" style="background:'+item.bg+'">'+item.icon+'</div><div class="shop-info"><div class="shop-name">'+item.name+'</div><div class="shop-desc">'+item.desc+'</div>'+
    (bought&&item.once?'<div class="shop-level" style="color:var(--green)">‚úÖ –ö—É–ø–ª–µ–Ω–æ</div>':'')+
    '</div><button class="shop-btn stars-btn" '+(!can?'disabled':'')+'>'+
    (bought&&item.once?'‚úÖ':'‚≠ê '+item.stars)+'</button></div>';});
    h+='</div>';c.innerHTML=h;
  }
}

let doubleActive=false;
function buyFullEnergy(){if(S.coins<5000)return;S.coins-=5000;S.energy=S.maxEnergy;save();updateClickerUI();renderShop();showToast('‚ö° –≠–Ω–µ—Ä–≥–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!');}
function buyDoubleCoins(){if(S.coins<25000)return;S.coins-=25000;doubleActive=true;save();updateClickerUI();renderShop();showToast('x2 –º–æ–Ω–µ—Ç—ã –Ω–∞ 60 —Å–µ–∫—É–Ω–¥!');setTimeout(()=>{doubleActive=false;showToast('x2 –∑–∞–∫–æ–Ω—á–∏–ª—Å—è');},60000);}
function buyMegaCombo(){if(S.coins<50000)return;S.coins-=50000;comboCount=50;if(comboCount>S.maxCombo)S.maxCombo=comboCount;save();updateClickerUI();renderShop();checkAchievements();showToast('üî• MEGA COMBO x50!');}
function buyRandomSkin(){if(S.coins<10000)return;const locked=Object.keys(SKINS).filter(k=>!S.ownedSkins.includes(k));if(locked.length===0){showToast('–£ —Ç–µ–±—è –≤—Å–µ —Å–∫–∏–Ω—ã!');return;}S.coins-=10000;const pick=locked[Math.floor(Math.random()*locked.length)];S.ownedSkins.push(pick);S.skin=pick;setClickerSkin(pick);save();syncToCloud();updateClickerUI();renderShop();checkAchievements();showToast('üéÅ –ü–æ–ª—É—á–µ–Ω: '+SKINS[pick].name+'!');}

function buyCoin(id){const item=coinUpgrades.find(x=>x.id===id);if(!item)return;const l=S.upgrades[item.id]||0;const cost=getUpgradeCost(item);if(S.coins<cost||l>=item.max)return;S.coins-=cost;S.upgrades[item.id]=l+1;if(item.eff!=='luck'&&item.eff!=='offlineBonus')applyEffect(item.eff,item.val);recalcStats();save();syncToCloud();renderShop();updateClickerUI();checkAchievements();showToast('‚úÖ '+item.name+' ‚Üí –£—Ä.'+(l+1));if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');}

async function buyStar(id){
  const item=starUpgrades.find(x=>x.id===id);if(!item)return;
  if(item.once&&S.premiumUpgrades&&S.premiumUpgrades[item.id])return;
  if(!tg){showToast('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram');return;}
  showToast('‚è≥ –°–æ–∑–¥–∞—é –ø–ª–∞—Ç—ë–∂...');
  try{
    const payload=JSON.stringify({item_id:item.id,user_id:getUserId(),ts:Date.now()});
    const res=await fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/createInvoiceLink',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:item.name,description:item.desc,payload:payload,provider_token:'',currency:'XTR',prices:[{label:item.name,amount:item.stars}]})});
    const data=await res.json();
    if(!data.ok||!data.result){showToast('‚ùå '+((data.description)||'–û—à–∏–±–∫–∞'));return;}
    tg.openInvoice(data.result,function(status){
      if(status==='paid'){
        if(!S.premiumUpgrades)S.premiumUpgrades={};if(item.once)S.premiumUpgrades[item.id]=true;
        applyEffect(item.eff,item.val);recalcStats();save();syncToCloud();renderShop();updateClickerUI();checkAchievements();
        showToast('üåü '+item.name+' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
      }else if(status==='cancelled'){showToast('‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ');}else if(status==='failed'){showToast('‚ùå –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã');}
    });
  }catch(e){console.error(e);showToast('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');}
}

function applyEffect(eff,val){
  if(eff==='perTap')S.perTap+=val;if(eff==='perTapMult')S.perTap=Math.floor(S.perTap*val);if(eff==='maxEnergy'){S.maxEnergy+=val;S.energy=Math.min(S.energy+val,S.maxEnergy);}if(eff==='energyRegen')S.energyRegen+=val;if(eff==='cps')S.cps+=val;if(eff==='coins'){S.coins+=val;S.totalEarned+=val;}if(eff==='prestigeMult')S.prestigeMultiplier=(S.prestigeMultiplier||1)*val;
}

// ===== TEST PAYMENT =====
async function testPayment(){
  if(!tg){showToast('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram');return;}
  showToast('‚è≥ –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂...');
  try{
    const payload=JSON.stringify({type:'test',user_id:getUserId(),ts:Date.now()});
    const res=await fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/createInvoiceLink',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:'–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã',description:'1 –∑–≤–µ–∑–¥–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è',payload:payload,provider_token:'',currency:'XTR',prices:[{label:'–¢–µ—Å—Ç',amount:1}]})});
    const data=await res.json();
    if(!data.ok){showToast('‚ùå '+(data.description||'–û—à–∏–±–∫–∞'));return;}
    tg.openInvoice(data.result,async function(status){
      if(status==='paid'){
        showToast('‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!\n‚è≥ –í–æ–∑–≤—Ä–∞—Ç...');
        try{
          const upd=await fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/getUpdates?offset=-1&limit=1');
          const updData=await upd.json();
          if(updData.ok&&updData.result.length>0){
            const last=updData.result[0];const msg=last.message;
            if(msg&&msg.successful_payment){
              const chargeId=msg.successful_payment.telegram_payment_charge_id;
              const ref=await fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/refundStarPayment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:parseInt(getUserId()),telegram_payment_charge_id:chargeId})});
              const refData=await ref.json();
              if(refData.ok)showToast('üéâ –ó–≤–µ–∑–¥–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞!\n‚úÖ –û–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
              else showToast('‚ö†Ô∏è –û–ø–ª–∞—á–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—Ç: '+(refData.description||''));
            }else showToast('‚úÖ –û–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
          }
        }catch(e){showToast('‚úÖ –û–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');}
      }else if(status==='cancelled')showToast('‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ');
      else if(status==='failed')showToast('‚ùå –û—à–∏–±–∫–∞');
    });
  }catch(e){showToast('‚ùå '+e.message);}
}

// ===== SKINS =====
function renderSkins(){
  document.getElementById('skins-balance').textContent=formatNum(S.coins);
  const g=document.getElementById('skins-grid');g.innerHTML='';
  Object.entries(SKINS).forEach(([id,skin])=>{
    const owned=S.ownedSkins.includes(id);const eq=S.skin===id;
    const d=document.createElement('div');d.className='skin-card'+(eq?' active':'')+(!owned?' locked':'');
    d.innerHTML=skin.svg+'<div class="skin-card-name">'+skin.name+'</div>'+
    '<div class="skin-card-price">'+(owned?(eq?'–ù–∞–¥–µ—Ç–æ':'–ù–∞–¥–µ—Ç—å'):'ü™ô '+formatNum(skin.price))+'</div>'+
    (skin.bonusDesc?'<div class="skin-card-bonus">'+skin.bonusDesc+'</div>':'')+
    (eq?'<div class="skin-badge equipped">‚úì</div>':'')+
    (!owned?'<div class="skin-badge lock">üîí</div>':'');
    d.onclick=()=>{if(eq)return;if(owned){S.skin=id;setClickerSkin(id);recalcStats();save();syncToCloud();renderSkins();updateClickerUI();showToast('üé® '+skin.name);}else if(S.coins>=skin.price){S.coins-=skin.price;S.ownedSkins.push(id);S.skin=id;setClickerSkin(id);recalcStats();save();syncToCloud();renderSkins();updateClickerUI();checkAchievements();showToast('üéâ '+skin.name);}else{showToast('ü™ô –ù—É–∂–Ω–æ '+formatNum(skin.price));}};
    g.appendChild(d);
  });
}

// ===== ACHIEVEMENTS UI =====
function renderAchievements(){
  const g=document.getElementById('ach-grid');g.innerHTML='';let unlocked=0;
  ACHIEVEMENTS.forEach(a=>{const done=!!S.achievements[a.id];if(done)unlocked++;const progress=getAchProgress(a);
  const d=document.createElement('div');d.className='ach-item '+(done?'unlocked':'locked');
  d.innerHTML='<div class="ach-icon">'+a.icon+'</div><div class="ach-info"><div class="ach-name">'+a.name+'</div><div class="ach-desc">'+a.desc+'</div>'+(a.reward>0?'<div class="ach-reward">ü™ô +'+formatNum(a.reward)+'</div>':'')+'</div>'+(done?'<div class="ach-check">‚úÖ</div>':'<div class="ach-progress"><div class="ach-progress-fill" style="width:'+Math.min(progress*100,100)+'%"></div></div>');
  g.appendChild(d);});
  document.getElementById('ach-counter').textContent=unlocked+' / '+ACHIEVEMENTS.length+' üèÖ';
}

function getAchProgress(a){
  const id=a.id;
  if(id.startsWith('taps')){const t=parseInt(id.replace('taps',''));return S.totalTaps/(t||100);}
  if(id.startsWith('earn')){const m={'earn100':100,'earn1k':1e3,'earn10k':1e4,'earn50k':5e4,'earn100k':1e5,'earn500k':5e5,'earn1m':1e6,'earn10m':1e7};return S.totalEarned/(m[id]||1e3);}
  if(id.startsWith('combo')){const t=parseInt(id.replace('combo',''));return S.maxCombo/(t||10);}
  if(id.startsWith('skin')){const m={'skin2':2,'skin4':4,'skin7':7,'skin10':10,'skinAll':Object.keys(SKINS).length};return S.ownedSkins.length/(m[id]||2);}
  if(id.startsWith('prestige')){const t=parseInt(id.replace('prestige',''));return S.prestige/(t||1);}
  if(id.startsWith('daily')){const t=parseInt(id.replace('daily',''));return S.dailyStreak/(t||3);}
  if(id.startsWith('cps')){const t=parseInt(id.replace('cps',''));return S.cps/(t||5);}
  if(id.startsWith('pertap')){const t=parseInt(id.replace('pertap',''));return S.perTap/(t||10);}
  if(id==='steal1')return(S.stolenStars||0)/1;if(id==='steal5')return(S.stolenStars||0)/5;
  if(id==='billion')return S.billionClaimed?1:0;
  return 0;
}

// ===== LEADERBOARD =====
let lbSort='totalEarned';
function switchLbTab(t){lbSort=t==='taps'?'totalTaps':'totalEarned';document.querySelectorAll('.lb-tab').forEach((el,i)=>el.classList.toggle('active',t==='taps'?i===1:i===0));renderLeaderboard();}

async function renderLeaderboard(){
  const list=document.getElementById('lb-list');list.innerHTML='<div class="lb-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  await syncToCloud();
  if(!fbReady){list.innerHTML='<div class="lb-loading">‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>';return;}
  try{
    const snap=await db.ref('vriskas_clicker').orderByChild(lbSort).limitToLast(50).once('value');
    const players=[];snap.forEach(ch=>{const d=ch.val();if(d&&d.name)players.push({uid:ch.key,...d});});
    players.sort((a,b)=>(b[lbSort]||0)-(a[lbSort]||0));
    if(players.length===0){list.innerHTML='<div class="lb-empty"><div class="lb-empty-icon">üèÜ</div><div class="lb-empty-title">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div><div class="lb-empty-desc">–ù–∞—á–Ω–∏ –∏–≥—Ä–∞—Ç—å –∏ –ø—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π!</div><button class="lb-invite-btn" onclick="shareBot()">üì§ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button></div>';return;}
    const myUid=getUserId();list.innerHTML='';
    players.forEach((p,i)=>{
      const rank=i+1;const isMe=String(p.uid)===String(myUid);
      const topC=rank===1?'top1':rank===2?'top2':rank===3?'top3':'';
      const medals=['','ü•á','ü•à','ü•â'];const val=p[lbSort]||0;
      const name=p.name||'–ò–≥—Ä–æ–∫';const initial=name.charAt(0).toUpperCase();
      const avatar=p.photo?'<img class="lb-avatar" src="'+p.photo+'" onerror="this.outerHTML=\'<div class=lb-avatar>'+initial+'</div>\'">':'<div class="lb-avatar">'+initial+'</div>';
      const item=document.createElement('div');item.className='lb-item '+topC+(isMe?' me':'');
      item.innerHTML='<div class="lb-rank">'+(rank<=3?medals[rank]:rank)+'</div>'+avatar+'<div class="lb-info"><div class="lb-name">'+name+'</div>'+(isMe?'<div class="lb-you">–≠—Ç–æ —Ç—ã!</div>':'')+'</div><div class="lb-score">'+(lbSort==='totalTaps'?'üëÜ ':'ü™ô ')+formatNum(val)+'</div>';
      list.appendChild(item);
    });
  }catch(e){console.error('LB:',e);list.innerHTML='<div class="lb-loading">‚ùå '+e.message+'</div>';}
}

// ===== PROFILE =====
function renderProfile(){
  const name=getUserName();const uname=getUserUsername();
  const photo=getUserPhoto()||'https://ui-avatars.com/api/?name='+encodeURIComponent(name)+'&background=007aff&color=fff&size=200&bold=true';
  document.getElementById('profile-avatar').src=photo;
  document.getElementById('profile-name').textContent=name;
  document.getElementById('profile-username').textContent=uname;
  const stats=[
    {icon:'ü™ô',val:formatNum(S.coins),lbl:'–ú–æ–Ω–µ—Ç—ã'},
    {icon:'üëÜ',val:formatNum(S.totalTaps),lbl:'–¢–∞–ø–æ–≤'},
    {icon:'üí∞',val:formatNum(S.totalEarned),lbl:'–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ'},
    {icon:'‚ö°',val:formatNum(S.perTap),lbl:'–ó–∞ —Ç–∞–ø'},
    {icon:'üîã',val:formatNum(S.maxEnergy),lbl:'–≠–Ω–µ—Ä–≥–∏—è'},
    {icon:'üìà',val:formatNum(S.cps),lbl:'–í —Å–µ–∫'},
    {icon:'üíé',val:S.prestige||0,lbl:'–ü—Ä–µ—Å—Ç–∏–∂'},
    {icon:'üî•',val:S.dailyStreak||0,lbl:'–î–Ω–µ–π'},
    {icon:'üé∞',val:S.stolenStars||0,lbl:'–ö—Ä–∞–∂'},
  ];
  document.getElementById('profile-stats-grid').innerHTML=stats.map(s=>'<div class="profile-stat"><div class="p-icon">'+s.icon+'</div><div class="p-val">'+s.val+'</div><div class="p-lbl">'+s.lbl+'</div></div>').join('');
  renderPrestige();renderBillion();
}

function shareBot(){const text='üéÆ –ò–≥—Ä–∞—é –≤ Vriskas Clicker!\nü™ô –£–∂–µ '+formatNum(S.totalEarned)+' –º–æ–Ω–µ—Ç!';if(tg)tg.openTelegramLink('https://t.me/share/url?url=https://t.me/VriskasRobot&text='+encodeURIComponent(text));else showToast('üìã t.me/VriskasRobot');}

async function resetProgress(){
  showModal('üóë –°–±—Ä–æ—Å','–£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!','–£–¥–∞–ª–∏—Ç—å',async()=>{
    if(fbReady){try{await db.ref('vriskas_clicker/'+getUserId()).remove();}catch(e){}}
    localStorage.removeItem(SAVE_KEY);S=defaultState();save();setClickerSkin('classic');updateClickerUI();renderProfile();renderDaily();closeModal();
    showToast('üóë –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
  },'danger');
}

// ===== RECALC =====
function recalcStats(){
  let pt=1,me=500,cps=0,rg=1;
  coinUpgrades.forEach(item=>{const l=S.upgrades[item.id]||0;
    if(item.eff==='perTap')pt+=item.val*l;if(item.eff==='maxEnergy')me+=item.val*l;
    if(item.eff==='cps')cps+=item.val*l;if(item.eff==='energyRegen')rg+=item.val*l;
    if(item.eff==='perTapMult')for(let i=0;i<l;i++)pt=Math.floor(pt*item.val);
  });
  starUpgrades.forEach(item=>{if(S.premiumUpgrades&&S.premiumUpgrades[item.id]){
    if(item.eff==='perTapMult')pt=Math.floor(pt*item.val);if(item.eff==='perTap')pt+=item.val;
    if(item.eff==='maxEnergy')me+=item.val;if(item.eff==='cps')cps+=item.val;if(item.eff==='energyRegen')rg+=item.val;
  }});
  // Skin bonuses
  const skin=SKINS[S.skin];
  if(skin&&skin.bonus){
    if(skin.bonus.perTap)pt+=skin.bonus.perTap;if(skin.bonus.cps)cps+=skin.bonus.cps;
    if(skin.bonus.maxEnergy)me+=skin.bonus.maxEnergy;if(skin.bonus.energyRegen)rg+=skin.bonus.energyRegen;
  }
  S.perTap=pt;S.maxEnergy=me;S.cps=cps;S.energyRegen=rg;
  if(S.energy>S.maxEnergy)S.energy=S.maxEnergy;
}

// ===== INIT =====
recalcStats();applyOffline();setClickerSkin(S.skin||'classic');updateClickerUI();renderDaily();initFirebase();
setInterval(()=>syncToCloud(),30000);setInterval(save,5000);setInterval(()=>checkAchievements(),10000);
document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='hidden')syncToCloud();});
</script>
</body>
</html>
