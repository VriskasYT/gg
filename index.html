<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>Vriskas Clicker</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
:root{
  --bg:#fff;--bg2:#f2f2f7;--bg3:#e5e5ea;--card:#fff;
  --text:#000;--text2:#8e8e93;--text3:#aeaeb2;
  --accent:#007aff;--accent2:#5856d6;
  --green:#34c759;--orange:#ff9500;--red:#ff3b30;--pink:#ff2d55;--cyan:#32ade6;--yellow:#ffcc00;
  --border:rgba(0,0,0,.08);--shadow:0 2px 16px rgba(0,0,0,.08);
  --tab-bg:rgba(242,242,247,.92);--energy-bg:#e5e5ea;--coin-glow:rgba(255,149,0,.3);
}
.dark{
  --bg:#000;--bg2:#1c1c1e;--bg3:#2c2c2e;--card:#1c1c1e;
  --text:#fff;--text2:#8e8e93;--text3:#636366;
  --border:rgba(255,255,255,.08);--shadow:0 2px 16px rgba(0,0,0,.3);
  --tab-bg:rgba(28,28,30,.92);--energy-bg:#2c2c2e;--coin-glow:rgba(255,149,0,.2);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none;}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;height:100vh;height:100dvh;transition:background .3s,color .3s;}
.app{display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden;}
.pages-wrapper{flex:1;position:relative;overflow:hidden;}
.pages-slider{display:flex;width:600%;height:100%;transition:transform .4s cubic-bezier(.32,.72,.35,1);}
.page{width:calc(100%/6);height:100%;overflow-y:auto;overflow-x:hidden;padding:0 0 100px;-webkit-overflow-scrolling:touch;flex-shrink:0;}
.page::-webkit-scrollbar{display:none;}

/* TAB BAR */
.tab-bar{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;align-items:flex-start;padding:6px 0 env(safe-area-inset-bottom,14px);background:var(--tab-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:.5px solid var(--border);z-index:100;}
.tab-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 6px;background:none;border:none;color:var(--text2);font-size:10px;font-weight:500;cursor:pointer;transition:color .25s,transform .15s;font-family:inherit;position:relative;}
.tab-item.active{color:var(--accent);}
.tab-item:active{transform:scale(.88);}
.tab-item svg{width:22px;height:22px;transition:transform .25s;}
.tab-item.active svg{transform:scale(1.08);}
.tab-dot{width:4px;height:4px;border-radius:50%;background:var(--accent);opacity:0;transition:opacity .25s;margin-top:1px;}
.tab-item.active .tab-dot{opacity:1;}

/* HEADER */
.header{text-align:center;padding:14px 20px 6px;}
.header h1{font-size:24px;font-weight:800;letter-spacing:-.5px;}

/* SCORE */
.score-display{text-align:center;padding:12px 0 4px;}
.score-label{font-size:12px;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.score-value{font-size:44px;font-weight:900;letter-spacing:-2px;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.per-tap{font-size:13px;color:var(--text2);font-weight:500;}
.boost-badges{display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-top:4px;padding:0 20px;}
.boost-badge{display:inline-flex;align-items:center;gap:3px;background:linear-gradient(135deg,var(--accent2),var(--pink));color:white;padding:3px 10px;border-radius:10px;font-size:11px;font-weight:700;}

/* COMBO */
.combo-bar{text-align:center;margin:4px 0;}
.combo-text{font-size:14px;font-weight:800;color:var(--pink);opacity:0;transition:opacity .2s;display:inline-block;}
.combo-text.show{opacity:1;animation:comboPulse .3s ease;}
@keyframes comboPulse{0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);}}

/* CLICKER */
.clicker-area{display:flex;justify-content:center;align-items:center;padding:10px 0;position:relative;}
.click-btn{width:180px;height:180px;border-radius:50%;background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .08s;position:relative;z-index:2;padding:0;}
.click-btn:active{transform:scale(.9);}
.click-btn svg{width:180px;height:180px;filter:drop-shadow(0 6px 20px var(--coin-glow));}
.float-text{position:absolute;font-size:22px;font-weight:800;color:var(--orange);pointer-events:none;animation:floatUp .8s ease-out forwards;z-index:10;text-shadow:0 1px 4px rgba(0,0,0,.15);}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-100px) scale(1.2);}}
.pulse-ring{position:absolute;width:180px;height:180px;border-radius:50%;border:3px solid var(--orange);opacity:0;pointer-events:none;animation:pulseRing .4s ease-out forwards;}
@keyframes pulseRing{0%{transform:scale(1);opacity:.5;}100%{transform:scale(1.4);opacity:0;}}

/* ENERGY */
.energy-section{padding:0 28px;margin-top:6px;}
.energy-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}
.energy-label{font-size:12px;font-weight:600;color:var(--text2);}
.energy-value{font-size:12px;font-weight:700;color:var(--accent);}
.energy-bar-bg{height:8px;background:var(--energy-bg);border-radius:4px;overflow:hidden;}
.energy-bar-fill{height:100%;background:linear-gradient(90deg,var(--accent),#5ac8fa);border-radius:4px;transition:width .3s;}

/* DAILY */
.daily-section{margin:12px 16px;background:linear-gradient(135deg,var(--orange),var(--pink));border-radius:16px;padding:14px 18px;color:white;cursor:pointer;transition:transform .15s;}
.daily-section:active{transform:scale(.97);}
.daily-section.claimed{background:var(--card);border:.5px solid var(--border);color:var(--text2);cursor:default;}
.daily-title{font-size:15px;font-weight:700;display:flex;align-items:center;gap:6px;}
.daily-desc{font-size:12px;font-weight:500;opacity:.85;margin-top:2px;}
.daily-streak{font-size:11px;font-weight:600;margin-top:4px;opacity:.9;}

/* STATS MINI */
.stats-row{display:flex;gap:8px;padding:12px 16px;}
.stat-card{flex:1;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:10px 8px;text-align:center;box-shadow:var(--shadow);}
.stat-card .icon{font-size:18px;margin-bottom:2px;}
.stat-card .val{font-size:16px;font-weight:800;}
.stat-card .lbl{font-size:9px;color:var(--text2);font-weight:600;text-transform:uppercase;}

/* SHOP */
.balance-bar{display:flex;justify-content:center;gap:16px;padding:6px 20px;}
.balance-chip{display:flex;align-items:center;gap:5px;background:var(--bg2);padding:6px 14px;border-radius:18px;font-weight:700;font-size:14px;}
.shop-tabs{display:flex;margin:8px 16px 0;background:var(--bg2);border-radius:12px;padding:3px;}
.shop-tab{flex:1;padding:7px;border:none;background:none;border-radius:10px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .25s;font-family:inherit;}
.shop-tab.active{background:var(--card);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.1);}
.shop-section-title{font-size:12px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:1px;padding:12px 20px 6px;}
.shop-list{padding:0 12px;display:flex;flex-direction:column;gap:6px;}
.shop-item{display:flex;align-items:center;gap:12px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow);transition:transform .15s;cursor:pointer;}
.shop-item:active{transform:scale(.98);}
.shop-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.shop-info{flex:1;min-width:0;}
.shop-name{font-size:14px;font-weight:700;margin-bottom:1px;}
.shop-desc{font-size:11px;color:var(--text2);font-weight:500;}
.shop-level{font-size:10px;color:var(--accent);font-weight:600;margin-top:1px;}
.shop-btn{padding:6px 14px;border-radius:18px;border:none;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:transform .15s,opacity .15s;font-family:inherit;}
.shop-btn:active{transform:scale(.94);}
.shop-btn.coins-btn{background:linear-gradient(135deg,var(--orange),#e08600);color:white;}
.shop-btn.stars-btn{background:linear-gradient(135deg,var(--accent2),var(--accent));color:white;}
.shop-btn:disabled{opacity:.35;cursor:default;}

/* SKINS */
.skins-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:6px 14px;}
.skin-card{background:var(--card);border:.5px solid var(--border);border-radius:18px;padding:14px 6px;text-align:center;box-shadow:var(--shadow);cursor:pointer;transition:transform .15s,border-color .2s;position:relative;}
.skin-card:active{transform:scale(.94);}
.skin-card.active{border:2px solid var(--accent);}
.skin-card.locked{opacity:.45;}
.skin-card svg{width:56px;height:56px;margin-bottom:6px;}
.skin-card-name{font-size:11px;font-weight:700;margin-bottom:2px;}
.skin-card-price{font-size:10px;color:var(--text2);font-weight:600;}
.skin-badge{position:absolute;top:6px;right:6px;font-size:9px;padding:2px 5px;border-radius:6px;font-weight:700;color:white;}
.skin-badge.equipped{background:var(--green);}
.skin-badge.lock{background:var(--red);}

/* ACHIEVEMENTS */
.ach-grid{display:flex;flex-direction:column;gap:6px;padding:6px 14px;}
.ach-item{display:flex;align-items:center;gap:12px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow);transition:opacity .2s;}
.ach-item.locked{opacity:.4;}
.ach-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;background:var(--bg2);}
.ach-item.unlocked .ach-icon{background:linear-gradient(135deg,var(--yellow),var(--orange));}
.ach-info{flex:1;min-width:0;}
.ach-name{font-size:14px;font-weight:700;}
.ach-desc{font-size:11px;color:var(--text2);font-weight:500;}
.ach-reward{font-size:10px;color:var(--green);font-weight:600;margin-top:1px;}
.ach-progress{width:60px;height:6px;background:var(--energy-bg);border-radius:3px;overflow:hidden;flex-shrink:0;}
.ach-progress-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:3px;transition:width .3s;}
.ach-check{font-size:20px;flex-shrink:0;}

/* LEADERBOARD */
.lb-tabs{display:flex;margin:8px 16px 0;background:var(--bg2);border-radius:12px;padding:3px;}
.lb-tab{flex:1;padding:7px;border:none;background:none;border-radius:10px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .25s;font-family:inherit;}
.lb-tab.active{background:var(--card);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.1);}
.lb-list{padding:8px 14px;display:flex;flex-direction:column;gap:5px;}
.lb-item{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:10px 12px;box-shadow:var(--shadow);}
.lb-item.top1{border:1.5px solid #ffd700;}
.lb-item.top2{border:1.5px solid #c0c0c0;}
.lb-item.top3{border:1.5px solid #cd7f32;}
.lb-item.me{border:1.5px solid var(--accent);background:color-mix(in srgb,var(--accent) 5%,var(--card));}
.lb-rank{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;background:var(--bg2);flex-shrink:0;}
.lb-item.top1 .lb-rank{background:linear-gradient(135deg,#ffd700,#ffb347);color:#fff;}
.lb-item.top2 .lb-rank{background:linear-gradient(135deg,#c0c0c0,#e0e0e0);color:#fff;}
.lb-item.top3 .lb-rank{background:linear-gradient(135deg,#cd7f32,#e8a665);color:#fff;}
.lb-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;background:var(--bg3);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:18px;}
img.lb-avatar{display:block;}
.lb-info{flex:1;min-width:0;}
.lb-name{font-size:14px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lb-you{font-size:10px;color:var(--accent);font-weight:600;}
.lb-score{font-size:14px;font-weight:800;color:var(--orange);flex-shrink:0;}
.lb-empty{text-align:center;padding:40px 28px;color:var(--text2);}
.lb-empty-icon{font-size:56px;margin-bottom:12px;}
.lb-empty-title{font-size:17px;font-weight:700;color:var(--text);margin-bottom:6px;}
.lb-empty-desc{font-size:13px;font-weight:500;line-height:1.4;margin-bottom:16px;}
.lb-invite-btn{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;padding:10px 20px;border-radius:20px;border:none;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;transition:transform .15s;}
.lb-invite-btn:active{transform:scale(.94);}
.lb-loading{text-align:center;padding:40px;color:var(--text2);font-size:13px;font-weight:600;}

/* PROFILE */
.profile-hero{display:flex;flex-direction:column;align-items:center;padding:20px 20px 10px;gap:8px;}
.profile-avatar{width:88px;height:88px;border-radius:50%;object-fit:cover;background:var(--bg3);border:3px solid var(--accent);}
.profile-name{font-size:22px;font-weight:800;}
.profile-username{font-size:14px;color:var(--text2);font-weight:500;margin-top:-6px;}
.profile-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 14px;}
.profile-stat{background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:14px;text-align:center;box-shadow:var(--shadow);}
.profile-stat .p-icon{font-size:22px;margin-bottom:4px;}
.profile-stat .p-val{font-size:20px;font-weight:800;}
.profile-stat .p-lbl{font-size:10px;color:var(--text2);font-weight:600;text-transform:uppercase;margin-top:1px;}
.profile-actions{padding:16px 14px;display:flex;flex-direction:column;gap:6px;}
.profile-action-btn{display:flex;align-items:center;gap:10px;background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:14px;box-shadow:var(--shadow);cursor:pointer;transition:transform .15s;font-size:15px;font-weight:600;color:var(--text);font-family:inherit;width:100%;text-align:left;}
.profile-action-btn:active{transform:scale(.97);}
.profile-action-btn .pa-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.profile-action-btn .pa-arrow{margin-left:auto;color:var(--text2);font-size:16px;}
.reset-btn .pa-icon{background:rgba(255,59,48,.12);}
.share-btn .pa-icon{background:rgba(0,122,255,.12);}
.prestige-btn .pa-icon{background:rgba(255,204,0,.12);}

/* PRESTIGE */
.prestige-section{margin:12px 16px;background:linear-gradient(135deg,#ffd700,#ff9500);border-radius:16px;padding:14px 18px;color:white;cursor:pointer;transition:transform .15s;}
.prestige-section:active{transform:scale(.97);}
.prestige-section.disabled{opacity:.4;cursor:default;}
.prestige-title{font-size:15px;font-weight:700;display:flex;align-items:center;gap:6px;}
.prestige-desc{font-size:12px;font-weight:500;opacity:.85;margin-top:2px;}
.prestige-info{font-size:11px;font-weight:600;margin-top:4px;opacity:.9;}

/* TOAST */
.toast{position:fixed;top:50px;left:50%;transform:translateX(-50%) translateY(-20px);background:var(--card);border:.5px solid var(--border);border-radius:14px;padding:12px 20px;font-size:13px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.15);z-index:200;opacity:0;pointer-events:none;transition:opacity .3s,transform .3s;text-align:center;max-width:88%;white-space:pre-line;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.db-status{text-align:center;padding:2px;font-size:10px;font-weight:600;color:var(--text2);transition:opacity 1s;}
.db-status.online{color:var(--green);}
.db-status.offline{color:var(--orange);}
</style>
</head>
<body>
<div class="app">
<div class="toast" id="toast"></div>
<div class="pages-wrapper">
<div class="pages-slider" id="pages-slider">

<!-- PAGE: CLICKER -->
<div class="page" id="page-clicker">
  <div class="header"><h1>‚ö° Vriskas Clicker</h1></div>
  <div class="db-status" id="db-status"></div>
  <div class="score-display">
    <div class="score-label">–ú–æ–Ω–µ—Ç—ã</div>
    <div class="score-value" id="score">0</div>
    <div class="per-tap">+<span id="per-tap-val">1</span> –∑–∞ —Ç–∞–ø</div>
    <div class="boost-badges" id="boost-badges"></div>
  </div>
  <div class="combo-bar"><span class="combo-text" id="combo-text"></span></div>
  <div class="clicker-area" id="clicker-area">
    <button class="click-btn" id="click-btn"></button>
  </div>
  <div class="energy-section">
    <div class="energy-header">
      <span class="energy-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è</span>
      <span class="energy-value"><span id="energy-val">500</span> / <span id="energy-max">500</span></span>
    </div>
    <div class="energy-bar-bg"><div class="energy-bar-fill" id="energy-bar" style="width:100%"></div></div>
  </div>
  <div id="daily-container"></div>
  <div class="stats-row">
    <div class="stat-card"><div class="icon">üëÜ</div><div class="val" id="total-taps">0</div><div class="lbl">–¢–∞–ø–æ–≤</div></div>
    <div class="stat-card"><div class="icon">üí∞</div><div class="val" id="total-earned">0</div><div class="lbl">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div></div>
    <div class="stat-card"><div class="icon">‚ö°</div><div class="val" id="cps-val">0</div><div class="lbl">–í —Å–µ–∫</div></div>
    <div class="stat-card"><div class="icon">üî•</div><div class="val" id="combo-max">0</div><div class="lbl">–ú–∞–∫—Å –∫–æ–º–±–æ</div></div>
  </div>
</div>

<!-- PAGE: SHOP -->
<div class="page" id="page-shop">
  <div class="header"><h1>üè™ –ú–∞–≥–∞–∑–∏–Ω</h1></div>
  <div class="balance-bar"><div class="balance-chip">ü™ô <span id="shop-balance">0</span></div></div>
  <div class="shop-tabs">
    <button class="shop-tab active" onclick="switchShopTab('coins')">ü™ô –ú–æ–Ω–µ—Ç—ã</button>
    <button class="shop-tab" onclick="switchShopTab('stars')">‚≠ê Stars</button>
  </div>
  <div id="shop-content"></div>
  <div style="height:20px"></div>
</div>

<!-- PAGE: SKINS -->
<div class="page" id="page-skins">
  <div class="header"><h1>üé® –°–∫–∏–Ω—ã</h1></div>
  <div class="balance-bar"><div class="balance-chip">ü™ô <span id="skins-balance">0</span></div></div>
  <div class="skins-grid" id="skins-grid"></div>
</div>

<!-- PAGE: ACHIEVEMENTS -->
<div class="page" id="page-ach">
  <div class="header"><h1>üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1></div>
  <div class="balance-bar"><div class="balance-chip" id="ach-counter">0 / 0</div></div>
  <div class="ach-grid" id="ach-grid"></div>
</div>

<!-- PAGE: LEADERBOARD -->
<div class="page" id="page-leaders">
  <div class="header"><h1>üèÜ –õ–∏–¥–µ—Ä—ã</h1></div>
  <div class="lb-tabs">
    <button class="lb-tab active" onclick="switchLbTab('earned')">üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</button>
    <button class="lb-tab" onclick="switchLbTab('taps')">üëÜ –¢–∞–ø–æ–≤</button>
  </div>
  <div class="lb-list" id="lb-list"><div class="lb-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
</div>

<!-- PAGE: PROFILE -->
<div class="page" id="page-profile">
  <div class="header"><h1>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h1></div>
  <div class="profile-hero">
    <img class="profile-avatar" id="profile-avatar" src="" alt="">
    <div class="profile-name" id="profile-name">–ò–≥—Ä–æ–∫</div>
    <div class="profile-username" id="profile-username">@username</div>
  </div>
  <div class="profile-stats">
    <div class="profile-stat"><div class="p-icon">ü™ô</div><div class="p-val" id="p-coins">0</div><div class="p-lbl">–ú–æ–Ω–µ—Ç—ã</div></div>
    <div class="profile-stat"><div class="p-icon">üëÜ</div><div class="p-val" id="p-taps">0</div><div class="p-lbl">–¢–∞–ø–æ–≤</div></div>
    <div class="profile-stat"><div class="p-icon">‚ö°</div><div class="p-val" id="p-pertap">1</div><div class="p-lbl">–ó–∞ —Ç–∞–ø</div></div>
    <div class="profile-stat"><div class="p-icon">üîã</div><div class="p-val" id="p-maxe">500</div><div class="p-lbl">–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è</div></div>
    <div class="profile-stat"><div class="p-icon">üíé</div><div class="p-val" id="p-prestige">0</div><div class="p-lbl">–ü—Ä–µ—Å—Ç–∏–∂</div></div>
    <div class="profile-stat"><div class="p-icon">üî•</div><div class="p-val" id="p-streak">0</div><div class="p-lbl">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div></div>
  </div>
  <div id="prestige-container"></div>
  <div class="profile-actions">
    <button class="profile-action-btn share-btn" onclick="shareBot()"><span class="pa-icon">üì§</span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º<span class="pa-arrow">‚Ä∫</span></button>
    <button class="profile-action-btn reset-btn" onclick="resetProgress()"><span class="pa-icon">üóë</span>–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å<span class="pa-arrow">‚Ä∫</span></button>
  </div>
</div>

</div>
</div>

<div class="tab-bar">
  <button class="tab-item active" onclick="switchTab(0)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8m-4-4h8"/></svg>
    <span>–ö–ª–∏–∫–µ—Ä</span><div class="tab-dot"></div>
  </button>
  <button class="tab-item" onclick="switchTab(1)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    <span>–ú–∞–≥–∞–∑–∏–Ω</span><div class="tab-dot"></div>
  </button>
  <button class="tab-item" onclick="switchTab(2)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>
    <span>–°–∫–∏–Ω—ã</span><div class="tab-dot"></div>
  </button>
  <button class="tab-item" onclick="switchTab(3)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15l-2 5l9-11h-5l2-5l-9 11z"/></svg>
    <span>–ê—á–∏–≤–∫–∏</span><div class="tab-dot"></div>
  </button>
  <button class="tab-item" onclick="switchTab(4)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.27 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/></svg>
    <span>–õ–∏–¥–µ—Ä—ã</span><div class="tab-dot"></div>
  </button>
  <button class="tab-item" onclick="switchTab(5)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <span>–ü—Ä–æ—Ñ–∏–ª—å</span><div class="tab-dot"></div>
  </button>
</div>
</div>

<script>
// ===================== TELEGRAM =====================
const tg=window.Telegram&&Telegram.WebApp?Telegram.WebApp:null;
if(tg){tg.ready();tg.expand();tg.setHeaderColor&&tg.setHeaderColor('bg_color');}
function applyTheme(){const d=tg?tg.colorScheme==='dark':matchMedia('(prefers-color-scheme:dark)').matches;document.documentElement.className=d?'dark':'';}
applyTheme();
if(tg)tg.onEvent('themeChanged',applyTheme);
matchMedia('(prefers-color-scheme:dark)').addEventListener('change',applyTheme);

const BOT_TOKEN='8328808800:AAGXn9OCZNgo79kcWZhnZgx4m1DEiUeVhdc';

function getUserId(){
  if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)return String(tg.initDataUnsafe.user.id);
  let id=localStorage.getItem('v_uid');if(!id){id='local_'+Math.random().toString(36).substr(2,9);localStorage.setItem('v_uid',id);}return id;
}
function getUserName(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user){const u=tg.initDataUnsafe.user;return u.first_name+(u.last_name?' '+u.last_name:'');}return'–ò–≥—Ä–æ–∫';}
function getUserUsername(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)return'@'+(tg.initDataUnsafe.user.username||'user'+tg.initDataUnsafe.user.id);return'@player';}
function getUserPhoto(){if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user&&tg.initDataUnsafe.user.photo_url)return tg.initDataUnsafe.user.photo_url;return'';}

// ===================== FIREBASE =====================
firebase.initializeApp({
  apiKey:"AIzaSyCnFnvWy-gklDVNqWMOFdx9B9uJi0Lo-JU",
  authDomain:"telegrambotvriskas.firebaseapp.com",
  databaseURL:"https://telegrambotvriskas-default-rtdb.firebaseio.com",
  projectId:"telegrambotvriskas",
  storageBucket:"telegrambotvriskas.firebasestorage.app",
  messagingSenderId:"878769255530",
  appId:"1:878769255530:web:461ef3885f859f039d8613"
});
const db=firebase.database();
let fbReady=false;

async function initFirebase(){
  const st=document.getElementById('db-status');
  st.textContent='‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';st.className='db-status offline';
  try{
    await db.ref('.info/connected').once('value');
    fbReady=true;
    st.textContent='üü¢ –û–Ω–ª–∞–π–Ω';st.className='db-status online';
    setTimeout(()=>st.style.opacity='0',2000);
    await loadFromCloud();
    db.ref('.info/connected').on('value',s=>{
      if(s.val()===true){st.textContent='üü¢';st.className='db-status online';st.style.opacity='1';setTimeout(()=>st.style.opacity='0',1500);}
      else{st.textContent='‚ö†Ô∏è –û—Ñ—Ñ–ª–∞–π–Ω';st.className='db-status offline';st.style.opacity='1';}
    });
  }catch(e){
    console.error('Firebase init error:',e);
    st.textContent='‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º';st.className='db-status offline';
  }
}

function getCloudData(){
  return{
    name:getUserName(),username:getUserUsername(),photo:getUserPhoto(),
    coins:S.coins,totalTaps:S.totalTaps,totalEarned:S.totalEarned,
    perTap:S.perTap,cps:S.cps,maxEnergy:S.maxEnergy,energyRegen:S.energyRegen,
    upgrades:S.upgrades||{},premiumUpgrades:S.premiumUpgrades||{},
    ownedSkins:S.ownedSkins||['classic'],skin:S.skin||'classic',
    prestige:S.prestige||0,dailyStreak:S.dailyStreak||0,
    maxCombo:S.maxCombo||0,achievements:S.achievements||{},
    lastSync:Date.now()
  };
}

async function syncToCloud(){
  if(!fbReady)return;
  try{await db.ref('players/'+getUserId()).set(getCloudData());}catch(e){console.error('Sync err:',e);}
}

async function loadFromCloud(){
  if(!fbReady)return;
  try{
    const snap=await db.ref('players/'+getUserId()).once('value');
    const d=snap.val();
    if(d&&d.totalEarned>(S.totalEarned||0)){
      S.coins=d.coins||0;S.totalTaps=d.totalTaps||0;S.totalEarned=d.totalEarned||0;
      S.perTap=d.perTap||1;S.cps=d.cps||0;S.maxEnergy=d.maxEnergy||500;
      S.energyRegen=d.energyRegen||1;S.skin=d.skin||'classic';
      S.upgrades=d.upgrades||{};S.premiumUpgrades=d.premiumUpgrades||{};
      S.ownedSkins=d.ownedSkins||['classic'];S.prestige=d.prestige||0;
      S.dailyStreak=d.dailyStreak||0;S.maxCombo=d.maxCombo||0;
      S.achievements=d.achievements||{};
      recalcStats();save();updateClickerUI();setClickerSkin(S.skin);
    }
  }catch(e){console.error('Load err:',e);}
}

let syncCounter=0;
function saveAndSync(){save();syncCounter++;if(syncCounter>=15){syncCounter=0;syncToCloud();}}

// ===================== STATE =====================
const SAVE_KEY='vriska_v10';
function defaultState(){return{coins:0,totalTaps:0,totalEarned:0,energy:500,maxEnergy:500,perTap:1,cps:0,energyRegen:1,upgrades:{},premiumUpgrades:{},skin:'classic',ownedSkins:['classic'],lastTime:Date.now(),prestige:0,prestigeMultiplier:1,dailyStreak:0,lastDaily:0,maxCombo:0,achievements:{}};}
function loadState(){try{const s=localStorage.getItem(SAVE_KEY);if(s){const p=JSON.parse(s),d=defaultState();for(let k in d)if(!(k in p))p[k]=d[k];return p;}}catch(e){}return defaultState();}
function save(){S.lastTime=Date.now();localStorage.setItem(SAVE_KEY,JSON.stringify(S));}
let S=loadState();

// ===================== SVG SKINS =====================
const SKINS={
  classic:{name:'–ö–ª–∞—Å—Å–∏–∫–∞',price:0,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="cg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFD700"/><stop offset="50%" stop-color="#FFA500"/><stop offset="100%" stop-color="#FF8C00"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#cg)" stroke="#B8860B" stroke-width="4"/><circle cx="100" cy="100" r="78" fill="none" stroke="#B8860B" stroke-width="2" opacity=".4"/><ellipse cx="72" cy="62" rx="32" ry="22" fill="rgba(255,255,255,.3)"/><text x="100" y="120" text-anchor="middle" font-size="64" font-weight="900" fill="#B8860B" font-family="Inter,sans-serif">V</text></svg>`},
  ruby:{name:'–†—É–±–∏–Ω',price:3000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff1744"/><stop offset="50%" stop-color="#d50000"/><stop offset="100%" stop-color="#b71c1c"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#rg)" stroke="#880e4f" stroke-width="4"/><polygon points="100,25 135,65 155,65 100,160 45,65 65,65" fill="rgba(255,255,255,.25)" stroke="rgba(255,255,255,.4)" stroke-width="1.5"/><polygon points="100,25 80,65 120,65" fill="rgba(255,255,255,.15)"/><text x="100" y="118" text-anchor="middle" font-size="44" font-weight="900" fill="rgba(255,255,255,.9)" font-family="Inter,sans-serif">V</text></svg>`},
  diamond:{name:'–ê–ª–º–∞–∑',price:8000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="dg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#E0F7FA"/><stop offset="30%" stop-color="#4DD0E1"/><stop offset="60%" stop-color="#0097A7"/><stop offset="100%" stop-color="#006064"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#dg)" stroke="#00838F" stroke-width="4"/><polygon points="100,28 142,78 162,78 100,172 38,78 58,78" fill="rgba(255,255,255,.25)" stroke="rgba(255,255,255,.4)" stroke-width="1.5"/><line x1="100" y1="28" x2="58" y2="78" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/><line x1="100" y1="28" x2="142" y2="78" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/><line x1="78" y1="78" x2="100" y2="172" stroke="rgba(255,255,255,.2)" stroke-width="1.5"/><line x1="122" y1="78" x2="100" y2="172" stroke="rgba(255,255,255,.2)" stroke-width="1.5"/><text x="100" y="112" text-anchor="middle" font-size="38" font-weight="900" fill="rgba(255,255,255,.9)" font-family="Inter,sans-serif">V</text></svg>`},
  fire:{name:'–û–≥–æ–Ω—å',price:15000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="fg" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#FF6B00"/><stop offset="50%" stop-color="#FF3D00"/><stop offset="100%" stop-color="#DD2C00"/></linearGradient><radialGradient id="fg2" cx="50%" cy="70%" r="50%"><stop offset="0%" stop-color="#FFAB00" stop-opacity=".8"/><stop offset="100%" stop-color="#FF6D00" stop-opacity="0"/></radialGradient></defs><circle cx="100" cy="100" r="95" fill="url(#fg)" stroke="#BF360C" stroke-width="4"/><circle cx="100" cy="100" r="68" fill="url(#fg2)"/><path d="M100,32 Q122,68 110,88 Q132,58 126,42 Q152,78 142,112 Q148,92 158,88 Q162,128 132,154 Q142,138 136,128 Q122,164 100,168 Q78,164 64,128 Q58,138 68,154 Q38,128 38,88 Q52,92 52,112 Q48,78 74,42 Q68,58 90,88 Q78,68 100,32Z" fill="#FFAB00" opacity=".65"/><path d="M100,62 Q116,82 108,98 Q122,78 132,92 Q136,122 116,144 Q126,128 100,154 Q74,128 84,144 Q64,122 68,92 Q78,78 92,98 Q84,82 100,62Z" fill="#FFD600" opacity=".55"/><text x="100" y="120" text-anchor="middle" font-size="34" font-weight="900" fill="white" font-family="Inter,sans-serif" opacity=".9">V</text></svg>`},
  galaxy:{name:'–ì–∞–ª–∞–∫—Ç–∏–∫–∞',price:30000,svg:`<svg viewBox="0 0 200 200"><defs><radialGradient id="gg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#7C4DFF"/><stop offset="40%" stop-color="#536DFE"/><stop offset="100%" stop-color="#1A237E"/></radialGradient></defs><circle cx="100" cy="100" r="95" fill="url(#gg)" stroke="#311B92" stroke-width="4"/><circle cx="58" cy="48" r="2" fill="white" opacity=".9"/><circle cx="142" cy="38" r="1.5" fill="white" opacity=".7"/><circle cx="43" cy="128" r="1" fill="white" opacity=".6"/><circle cx="157" cy="118" r="2" fill="white" opacity=".8"/><circle cx="78" cy="158" r="1.5" fill="white" opacity=".5"/><circle cx="122" cy="153" r="1" fill="white" opacity=".7"/><circle cx="48" cy="78" r="1" fill="white" opacity=".4"/><circle cx="152" cy="68" r="1.5" fill="white" opacity=".6"/><circle cx="33" cy="98" r="1" fill="white" opacity=".3"/><circle cx="167" cy="93" r="1.5" fill="white" opacity=".5"/><circle cx="90" cy="42" r="1" fill="#ff9" opacity=".6"/><circle cx="165" cy="145" r="1" fill="#f9f" opacity=".5"/><ellipse cx="100" cy="100" rx="68" ry="24" fill="none" stroke="rgba(255,255,255,.12)" stroke-width="7" transform="rotate(-30,100,100)"/><ellipse cx="100" cy="100" rx="53" ry="17" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="4" transform="rotate(-30,100,100)"/><circle cx="100" cy="100" r="14" fill="rgba(255,255,255,.2)"/><circle cx="100" cy="100" r="7" fill="rgba(255,255,255,.4)"/><text x="100" y="107" text-anchor="middle" font-size="12" font-weight="900" fill="white" font-family="Inter,sans-serif">V</text></svg>`},
  emerald:{name:'–ò–∑—É–º—Ä—É–¥',price:20000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="eg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#00e676"/><stop offset="50%" stop-color="#00c853"/><stop offset="100%" stop-color="#1b5e20"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#eg)" stroke="#2e7d32" stroke-width="4"/><rect x="65" y="45" width="70" height="110" rx="8" fill="rgba(255,255,255,.15)" stroke="rgba(255,255,255,.3)" stroke-width="1.5" transform="rotate(0,100,100)"/><line x1="65" y1="70" x2="135" y2="70" stroke="rgba(255,255,255,.25)" stroke-width="1"/><line x1="65" y1="130" x2="135" y2="130" stroke="rgba(255,255,255,.25)" stroke-width="1"/><line x1="100" y1="45" x2="100" y2="155" stroke="rgba(255,255,255,.15)" stroke-width="1"/><text x="100" y="115" text-anchor="middle" font-size="42" font-weight="900" fill="rgba(255,255,255,.85)" font-family="Inter,sans-serif">V</text></svg>`},
  skull:{name:'–ß–µ—Ä–µ–ø',price:50000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="sg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#424242"/><stop offset="100%" stop-color="#212121"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#sg)" stroke="#616161" stroke-width="4"/><ellipse cx="100" cy="86" rx="44" ry="46" fill="#E0E0E0"/><ellipse cx="100" cy="80" rx="41" ry="41" fill="#F5F5F5"/><ellipse cx="81" cy="76" rx="11" ry="13" fill="#212121"/><ellipse cx="119" cy="76" rx="11" ry="13" fill="#212121"/><ellipse cx="81" cy="74" rx="4.5" ry="4.5" fill="#F44336" opacity=".5"/><ellipse cx="119" cy="74" rx="4.5" ry="4.5" fill="#F44336" opacity=".5"/><ellipse cx="100" cy="96" rx="4.5" ry="5.5" fill="#424242"/><path d="M81,113 Q84,118 89,116 Q94,120 100,116 Q106,120 111,116 Q114,118 119,113 L119,123 Q111,128 100,128 Q89,128 81,123Z" fill="#E0E0E0" stroke="#BDBDBD" stroke-width="1"/><line x1="89" y1="113" x2="89" y2="126" stroke="#BDBDBD" stroke-width="1"/><line x1="100" y1="113" x2="100" y2="128" stroke="#BDBDBD" stroke-width="1"/><line x1="111" y1="113" x2="111" y2="126" stroke="#BDBDBD" stroke-width="1"/></svg>`},
  neon:{name:'–ù–µ–æ–Ω',price:100000,svg:`<svg viewBox="0 0 200 200"><defs><radialGradient id="ng" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#1a1a2e"/><stop offset="100%" stop-color="#0a0a15"/></radialGradient><filter id="nG"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><circle cx="100" cy="100" r="95" fill="url(#ng)" stroke="#0ff" stroke-width="3" opacity=".8"/><circle cx="100" cy="100" r="86" fill="none" stroke="#0ff" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><circle cx="100" cy="100" r="68" fill="none" stroke="#f0f" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><circle cx="100" cy="100" r="48" fill="none" stroke="#0f0" stroke-width="1.5" opacity=".25" filter="url(#nG)"/><text x="100" y="118" text-anchor="middle" font-size="54" font-weight="900" fill="#0ff" font-family="Inter,sans-serif" filter="url(#nG)">V</text><line x1="28" y1="100" x2="48" y2="100" stroke="#f0f" stroke-width="2" opacity=".5" filter="url(#nG)"/><line x1="152" y1="100" x2="172" y2="100" stroke="#f0f" stroke-width="2" opacity=".5" filter="url(#nG)"/><line x1="100" y1="28" x2="100" y2="48" stroke="#0f0" stroke-width="2" opacity=".5" filter="url(#nG)"/><line x1="100" y1="152" x2="100" y2="172" stroke="#0f0" stroke-width="2" opacity=".5" filter="url(#nG)"/></svg>`},
  rainbow:{name:'–†–∞–¥—É–≥–∞',price:75000,svg:`<svg viewBox="0 0 200 200"><defs><linearGradient id="rbg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff0000"/><stop offset="17%" stop-color="#ff8800"/><stop offset="33%" stop-color="#ffff00"/><stop offset="50%" stop-color="#00ff00"/><stop offset="67%" stop-color="#0088ff"/><stop offset="83%" stop-color="#8800ff"/><stop offset="100%" stop-color="#ff00ff"/></linearGradient></defs><circle cx="100" cy="100" r="95" fill="url(#rbg)" stroke="rgba(255,255,255,.5)" stroke-width="4"/><circle cx="100" cy="100" r="78" fill="none" stroke="rgba(255,255,255,.3)" stroke-width="2"/><circle cx="100" cy="100" r="60" fill="none" stroke="rgba(255,255,255,.2)" stroke-width="1.5"/><ellipse cx="72" cy="62" rx="30" ry="20" fill="rgba(255,255,255,.25)"/><text x="100" y="118" text-anchor="middle" font-size="52" font-weight="900" fill="white" font-family="Inter,sans-serif" stroke="rgba(0,0,0,.2)" stroke-width="1">V</text></svg>`}
};
function setClickerSkin(id){const s=SKINS[id];if(s)document.getElementById('click-btn').innerHTML=s.svg;}

// ===================== COIN UPGRADES =====================
const coinUpgrades=[
  {id:'tap1',name:'–ö—Ä–µ–ø–∫–∏–π –ø–∞–ª–µ—Ü',desc:'+1 –∫ —Å–∏–ª–µ —Ç–∞–ø–∞',icon:'üëÜ',bg:'linear-gradient(135deg,#ff9500,#ff6723)',base:50,mult:1.8,eff:'perTap',val:1,max:50},
  {id:'tap2',name:'–ó–æ–ª–æ—Ç–æ–π –ø–∞–ª–µ—Ü',desc:'+3 –∫ —Å–∏–ª–µ —Ç–∞–ø–∞',icon:'üèÜ',bg:'linear-gradient(135deg,#ffd700,#ff9500)',base:500,mult:2,eff:'perTap',val:3,max:30},
  {id:'tap3',name:'–ê–ª–º–∞–∑–Ω—ã–π –ø–∞–ª–µ—Ü',desc:'+10 –∫ —Å–∏–ª–µ —Ç–∞–ø–∞',icon:'üíé',bg:'linear-gradient(135deg,#4dd0e1,#0097a7)',base:5000,mult:2.2,eff:'perTap',val:10,max:20},
  {id:'energy1',name:'–ë–∞—Ç–∞—Ä–µ–π–∫–∞',desc:'+100 –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è',icon:'üîã',bg:'linear-gradient(135deg,#34c759,#30d158)',base:200,mult:1.6,eff:'maxEnergy',val:100,max:25},
  {id:'energy2',name:'–†–µ–∞–∫—Ç–æ—Ä',desc:'+500 –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è',icon:'‚öõÔ∏è',bg:'linear-gradient(135deg,#5ac8fa,#007aff)',base:3000,mult:1.8,eff:'maxEnergy',val:500,max:15},
  {id:'regen1',name:'–£—Å–∫–æ—Ä–∏—Ç–µ–ª—å',desc:'+1 —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Å–µ–∫',icon:'‚ö°',bg:'linear-gradient(135deg,#007aff,#5ac8fa)',base:300,mult:2,eff:'energyRegen',val:1,max:20},
  {id:'regen2',name:'–¢—É—Ä–±–æ –∑–∞—Ä—è–¥',desc:'+5 —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Å–µ–∫',icon:'üåä',bg:'linear-gradient(135deg,#32ade6,#5856d6)',base:4000,mult:2.2,eff:'energyRegen',val:5,max:10},
  {id:'auto1',name:'–ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä',desc:'+1 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü§ñ',bg:'linear-gradient(135deg,#5856d6,#af52de)',base:1000,mult:2.2,eff:'cps',val:1,max:25},
  {id:'auto2',name:'–ú–µ–≥–∞-–±–æ—Ç',desc:'+5 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üöÄ',bg:'linear-gradient(135deg,#ff2d55,#ff6b81)',base:5000,mult:2.5,eff:'cps',val:5,max:15},
  {id:'auto3',name:'–£–ª—å—Ç—Ä–∞-—Ñ–∞–±—Ä–∏–∫–∞',desc:'+25 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üè≠',bg:'linear-gradient(135deg,#ff9500,#ffd700)',base:50000,mult:3,eff:'cps',val:25,max:10},
];

const starUpgrades=[
  {id:'star_mega',name:'–ú–µ–≥–∞ –¢–∞–ø',desc:'–°–∏–ª–∞ —Ç–∞–ø–∞ x2 –Ω–∞–≤—Å–µ–≥–¥–∞',icon:'üí•',bg:'linear-gradient(135deg,#ff2d55,#ff9500)',stars:50,eff:'perTapMult',val:2,once:true},
  {id:'star_energy',name:'–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è',desc:'–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è +5000',icon:'‚ôæÔ∏è',bg:'linear-gradient(135deg,#34c759,#00c7be)',stars:75,eff:'maxEnergy',val:5000,once:true},
  {id:'star_auto',name:'–£–ª—å—Ç—Ä–∞-–±–æ—Ç',desc:'+50 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü¶æ',bg:'linear-gradient(135deg,#5856d6,#007aff)',stars:100,eff:'cps',val:50,once:true},
  {id:'star_regen',name:'–ú–µ–≥–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è',desc:'+20 —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Å–µ–∫',icon:'üåä',bg:'linear-gradient(135deg,#5ac8fa,#007aff)',stars:60,eff:'energyRegen',val:20,once:true},
  {id:'star_tap10',name:'–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Ç–∞–ø',desc:'+50 –∫ —Å–∏–ª–µ —Ç–∞–ø–∞',icon:'‚ú®',bg:'linear-gradient(135deg,#ffd700,#ff2d55)',stars:150,eff:'perTap',val:50,once:true},
  {id:'star_pack',name:'–°—Ç–∞—Ä—Ç–æ–≤—ã–π –ø–∞–∫',desc:'+10000 –º–æ–Ω–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ',icon:'üí∞',bg:'linear-gradient(135deg,#ff9500,#ffd700)',stars:30,eff:'coins',val:10000,once:false},
  {id:'star_prestige',name:'–ü—Ä–µ—Å—Ç–∏–∂ x2',desc:'–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ø—Ä–µ—Å—Ç–∏–∂–∞ x2',icon:'üëë',bg:'linear-gradient(135deg,#ffd700,#ff6b00)',stars:200,eff:'prestigeMult',val:2,once:true},
];

function getUpgradeCost(item){const lvl=S.upgrades[item.id]||0;return Math.floor(item.base*Math.pow(item.mult,lvl));}

// ===================== ACHIEVEMENTS =====================
const ACHIEVEMENTS=[
  {id:'taps100',name:'–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏',desc:'–°–¥–µ–ª–∞–π 100 —Ç–∞–ø–æ–≤',icon:'üë£',check:()=>S.totalTaps>=100,reward:100},
  {id:'taps1k',name:'–ö–ª–∏–∫–µ—Ä',desc:'–°–¥–µ–ª–∞–π 1,000 —Ç–∞–ø–æ–≤',icon:'üëÜ',check:()=>S.totalTaps>=1000,reward:500},
  {id:'taps10k',name:'–ú–∞–Ω—å—è–∫ –∫–ª–∏–∫–æ–≤',desc:'–°–¥–µ–ª–∞–π 10,000 —Ç–∞–ø–æ–≤',icon:'ü§Ø',check:()=>S.totalTaps>=10000,reward:2000},
  {id:'taps100k',name:'–õ–µ–≥–µ–Ω–¥–∞ –∫–ª–∏–∫–µ—Ä–∞',desc:'–°–¥–µ–ª–∞–π 100,000 —Ç–∞–ø–æ–≤',icon:'üèõÔ∏è',check:()=>S.totalTaps>=100000,reward:10000},
  {id:'earn1k',name:'–ö–æ–ø–∏–ª–∫–∞',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1,000 –º–æ–Ω–µ—Ç',icon:'üê∑',check:()=>S.totalEarned>=1000,reward:200},
  {id:'earn10k',name:'–ë–æ–≥–∞—á',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10,000 –º–æ–Ω–µ—Ç',icon:'üí∞',check:()=>S.totalEarned>=10000,reward:1000},
  {id:'earn100k',name:'–ú–∏–ª–ª–∏–æ–Ω–µ—Ä',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 100,000 –º–æ–Ω–µ—Ç',icon:'ü§ë',check:()=>S.totalEarned>=100000,reward:5000},
  {id:'earn1m',name:'–ú–∞–≥–Ω–∞—Ç',desc:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1,000,000 –º–æ–Ω–µ—Ç',icon:'üëë',check:()=>S.totalEarned>=1000000,reward:25000},
  {id:'combo10',name:'–ö–æ–º–±–æ –º–∞—Å—Ç–µ—Ä',desc:'–ù–∞–±–µ—Ä–∏ –∫–æ–º–±–æ x10',icon:'üî•',check:()=>S.maxCombo>=10,reward:300},
  {id:'combo25',name:'–ö–æ–º–±–æ –∞—Å',desc:'–ù–∞–±–µ—Ä–∏ –∫–æ–º–±–æ x25',icon:'üí•',check:()=>S.maxCombo>=25,reward:1000},
  {id:'combo50',name:'–ö–æ–º–±–æ –±–æ–≥',desc:'–ù–∞–±–µ—Ä–∏ –∫–æ–º–±–æ x50',icon:'üåã',check:()=>S.maxCombo>=50,reward:3000},
  {id:'skin3',name:'–ú–æ–¥–Ω–∏–∫',desc:'–ö—É–ø–∏ 3 —Å–∫–∏–Ω–∞',icon:'üé®',check:()=>S.ownedSkins.length>=3,reward:1500},
  {id:'skin6',name:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä',desc:'–ö—É–ø–∏ 6 —Å–∫–∏–Ω–æ–≤',icon:'üñºÔ∏è',check:()=>S.ownedSkins.length>=6,reward:5000},
  {id:'prestige1',name:'–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ',desc:'–°–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π –ø—Ä–µ—Å—Ç–∏–∂',icon:'‚ôªÔ∏è',check:()=>S.prestige>=1,reward:0},
  {id:'prestige5',name:'–í–µ—Ç–µ—Ä–∞–Ω',desc:'–°–¥–µ–ª–∞–π 5 –ø—Ä–µ—Å—Ç–∏–∂–µ–π',icon:'‚≠ê',check:()=>S.prestige>=5,reward:0},
  {id:'daily7',name:'–ù–µ–¥–µ–ª—è –ø–æ–¥—Ä—è–¥',desc:'7 –¥–Ω–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞',icon:'üìÖ',check:()=>S.dailyStreak>=7,reward:3000},
  {id:'daily30',name:'–ú–µ—Å—è—Ü –ø–æ–¥—Ä—è–¥',desc:'30 –¥–Ω–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞',icon:'üóìÔ∏è',check:()=>S.dailyStreak>=30,reward:15000},
  {id:'cps10',name:'–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥',desc:'10 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üìà',check:()=>S.cps>=10,reward:1000},
  {id:'cps50',name:'–§–∞–±—Ä–∏–∫–∞ –º–æ–Ω–µ—Ç',desc:'50 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'üè≠',check:()=>S.cps>=50,reward:5000},
  {id:'pertap20',name:'–ú–æ—â–Ω—ã–π —Ç–∞–ø',desc:'20 –∑–∞ —Ç–∞–ø',icon:'üí™',check:()=>S.perTap>=20,reward:2000},
];

function checkAchievements(){
  let newUnlock=false;
  ACHIEVEMENTS.forEach(a=>{
    if(!S.achievements[a.id]&&a.check()){
      S.achievements[a.id]=Date.now();
      if(a.reward>0){S.coins+=a.reward;S.totalEarned+=a.reward;}
      newUnlock=true;
      showToast('üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: '+a.name+(a.reward?'\n+'+formatNum(a.reward)+' –º–æ–Ω–µ—Ç':''));
      if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
    }
  });
  if(newUnlock){save();updateClickerUI();}
}

// ===================== DAILY BONUS =====================
function canClaimDaily(){
  if(!S.lastDaily)return true;
  const now=new Date(),last=new Date(S.lastDaily);
  return now.toDateString()!==last.toDateString();
}
function claimDaily(){
  if(!canClaimDaily())return;
  const now=new Date(),last=S.lastDaily?new Date(S.lastDaily):null;
  if(last){
    const diff=(now-last)/(1000*60*60*24);
    if(diff<2)S.dailyStreak++;else S.dailyStreak=1;
  }else S.dailyStreak=1;
  const reward=100*S.dailyStreak*(S.prestigeMultiplier||1);
  S.coins+=reward;S.totalEarned+=reward;S.lastDaily=Date.now();
  save();syncToCloud();updateClickerUI();renderDaily();checkAchievements();
  showToast('üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å!\n+'+formatNum(reward)+' –º–æ–Ω–µ—Ç\nüî• '+S.dailyStreak+' –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥!');
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
}
function renderDaily(){
  const c=document.getElementById('daily-container');
  const can=canClaimDaily();
  if(can){
    const nextReward=100*(S.dailyStreak+1)*(S.prestigeMultiplier||1);
    c.innerHTML='<div class="daily-section" onclick="claimDaily()"><div class="daily-title">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</div><div class="daily-desc">–ó–∞–±–µ—Ä–∏ +'+formatNum(nextReward)+' –º–æ–Ω–µ—Ç!</div><div class="daily-streak">üî• –°–µ—Ä–∏—è: '+S.dailyStreak+' –¥–Ω–µ–π</div></div>';
  }else{
    c.innerHTML='<div class="daily-section claimed"><div class="daily-title">‚úÖ –ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω</div><div class="daily-desc">–í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞!</div><div class="daily-streak">üî• –°–µ—Ä–∏—è: '+S.dailyStreak+' –¥–Ω–µ–π</div></div>';
  }
}

// ===================== PRESTIGE =====================
function getPrestigeBonus(){return Math.floor(S.totalEarned/100000);}
function renderPrestige(){
  const c=document.getElementById('prestige-container');
  const bonus=getPrestigeBonus();
  const canP=bonus>0;
  c.innerHTML='<div class="prestige-section'+(canP?'':' disabled')+'" onclick="'+(canP?'doPrestige()':'')+'"><div class="prestige-title">üíé –ü—Ä–µ—Å—Ç–∏–∂</div><div class="prestige-desc">–°–±—Ä–æ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å</div><div class="prestige-info">–î–æ—Å—Ç—É–ø–Ω–æ: +'+(bonus>0?bonus:0)+'% –±–æ–Ω—É—Å –Ω–∞–≤—Å–µ–≥–¥–∞'+(S.prestige>0?' ‚Ä¢ –¢–µ–∫—É—â–∏–π: x'+((S.prestigeMultiplier||1)).toFixed(1):'')+'</div></div>';
}
function doPrestige(){
  const bonus=getPrestigeBonus();if(bonus<=0)return;
  if(!confirm('–ü—Ä–µ—Å—Ç–∏–∂: —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ +'+bonus+'% –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≤—Å–µ–≥–¥–∞?'))return;
  S.prestige=(S.prestige||0)+1;
  S.prestigeMultiplier=((S.prestigeMultiplier||1)+bonus/100);
  S.coins=0;S.totalTaps=0;S.totalEarned=0;S.energy=500;S.maxEnergy=500;
  S.perTap=1;S.cps=0;S.energyRegen=1;S.upgrades={};S.skin='classic';
  S.ownedSkins=['classic'];S.maxCombo=0;
  recalcStats();save();syncToCloud();
  setClickerSkin('classic');updateClickerUI();renderPrestige();
  showToast('üíé –ü—Ä–µ—Å—Ç–∏–∂ #'+S.prestige+'!\n–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x'+S.prestigeMultiplier.toFixed(1));
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
}

// ===================== COMBO =====================
let comboCount=0,comboTimer=null;
function doCombo(){
  comboCount++;
  if(comboCount>S.maxCombo){S.maxCombo=comboCount;document.getElementById('combo-max').textContent=S.maxCombo;}
  clearTimeout(comboTimer);
  comboTimer=setTimeout(()=>{comboCount=0;document.getElementById('combo-text').classList.remove('show');},1200);
  if(comboCount>=3){
    const el=document.getElementById('combo-text');
    el.textContent='üî• COMBO x'+comboCount;el.classList.remove('show');void el.offsetWidth;el.classList.add('show');
  }
}
function getComboMultiplier(){if(comboCount<5)return 1;if(comboCount<15)return 1.5;if(comboCount<30)return 2;if(comboCount<50)return 3;return 5;}

// ===================== OFFLINE =====================
function applyOffline(){
  const now=Date.now(),diff=Math.min((now-S.lastTime)/1000,14400);
  if(diff>5&&S.cps>0){const e=Math.floor(S.cps*diff*(S.prestigeMultiplier||1));S.coins+=e;S.totalEarned+=e;showToast('üí∞ –ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ:\n+'+formatNum(e)+' –º–æ–Ω–µ—Ç!');}
  S.energy=Math.min(S.energy+Math.floor(S.energyRegen*diff),S.maxEnergy);
  S.lastTime=now;save();
}

// ===================== HELPERS =====================
function formatNum(n){if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e4)return(n/1e3).toFixed(1)+'K';return n.toLocaleString('ru');}
function showToast(t){const el=document.getElementById('toast');el.textContent=t;el.classList.add('show');clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),2500);}

// ===================== TABS =====================
let curTab=0;
const slider=document.getElementById('pages-slider');
function switchTab(idx){
  curTab=idx;
  slider.style.transform='translateX(-'+((idx*100)/6)+'%)';
  document.querySelectorAll('.tab-item').forEach((t,i)=>t.classList.toggle('active',i===idx));
  if(idx===1)renderShop();if(idx===2)renderSkins();if(idx===3)renderAchievements();if(idx===4)renderLeaderboard();if(idx===5)renderProfile();
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.selectionChanged();
}

// ===================== CLICKER =====================
const clickBtn=document.getElementById('click-btn');
const clickerArea=document.getElementById('clicker-area');
clickBtn.addEventListener('pointerdown',e=>{e.preventDefault();doClick(e);});

function doClick(e){
  if(S.energy<=0){showToast('‚ö° –ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('error');return;}
  doCombo();
  const mult=getComboMultiplier()*(S.prestigeMultiplier||1);
  const earned=Math.floor(S.perTap*mult);
  S.coins+=earned;S.totalTaps++;S.totalEarned+=earned;
  S.energy=Math.max(0,S.energy-1);

  const rect=clickerArea.getBoundingClientRect();
  const cx=e.clientX||rect.left+rect.width/2,cy=e.clientY||rect.top+80;
  const ft=document.createElement('div');ft.className='float-text';
  ft.textContent='+'+formatNum(earned)+(mult>1?' üî•':'');
  ft.style.left=(cx-rect.left-20)+'px';ft.style.top=(cy-rect.top-20)+'px';
  clickerArea.appendChild(ft);setTimeout(()=>ft.remove(),800);

  const ring=document.createElement('div');ring.className='pulse-ring';
  const br=clickBtn.getBoundingClientRect();
  ring.style.left=(br.left-rect.left)+'px';ring.style.top=(br.top-rect.top)+'px';
  clickerArea.appendChild(ring);setTimeout(()=>ring.remove(),400);

  if(tg&&tg.HapticFeedback)tg.HapticFeedback.impactOccurred('light');
  updateClickerUI();saveAndSync();
  if(S.totalTaps%50===0)checkAchievements();
}

function updateClickerUI(){
  document.getElementById('score').textContent=formatNum(S.coins);
  document.getElementById('per-tap-val').textContent=formatNum(S.perTap);
  document.getElementById('energy-val').textContent=S.energy;
  document.getElementById('energy-max').textContent=S.maxEnergy;
  document.getElementById('energy-bar').style.width=(S.energy/S.maxEnergy*100)+'%';
  document.getElementById('total-taps').textContent=formatNum(S.totalTaps);
  document.getElementById('total-earned').textContent=formatNum(S.totalEarned);
  document.getElementById('cps-val').textContent=formatNum(S.cps);
  document.getElementById('combo-max').textContent=S.maxCombo;
  const bb=document.getElementById('boost-badges');
  const bs=[];
  if(S.premiumUpgrades&&S.premiumUpgrades.star_mega)bs.push('x2 –¢–∞–ø');
  if(S.cps>0)bs.push(formatNum(S.cps)+'/—Å–µ–∫');
  if((S.prestigeMultiplier||1)>1)bs.push('–ü—Ä–µ—Å—Ç–∏–∂ x'+(S.prestigeMultiplier).toFixed(1));
  bb.innerHTML=bs.map(b=>'<span class="boost-badge">üî• '+b+'</span>').join('');
}

setInterval(()=>{
  if(S.energy<S.maxEnergy)S.energy=Math.min(S.energy+S.energyRegen,S.maxEnergy);
  if(S.cps>0){const e=Math.floor(S.cps*(S.prestigeMultiplier||1));S.coins+=e;S.totalEarned+=e;}
  updateClickerUI();save();
},1000);

// ===================== SHOP =====================
let shopTab='coins';
function switchShopTab(t){shopTab=t;document.querySelectorAll('.shop-tab').forEach((el,i)=>el.classList.toggle('active',(t==='coins'?i===0:i===1)));renderShop();}

function renderShop(){
  document.getElementById('shop-balance').textContent=formatNum(S.coins);
  const c=document.getElementById('shop-content');
  if(shopTab==='coins'){
    let h='<div class="shop-section-title">üí™ –ü—Ä–æ–∫–∞—á–∫–∞ –∑–∞ –º–æ–Ω–µ—Ç—ã</div><div class="shop-list">';
    coinUpgrades.forEach(item=>{
      const lvl=S.upgrades[item.id]||0,cost=getUpgradeCost(item),can=S.coins>=cost&&lvl<item.max,maxed=lvl>=item.max;
      h+='<div class="shop-item" '+(can?'onclick="buyCoin(\''+item.id+'\')"':'')+'><div class="shop-icon" style="background:'+item.bg+'">'+item.icon+'</div><div class="shop-info"><div class="shop-name">'+item.name+'</div><div class="shop-desc">'+item.desc+'</div><div class="shop-level">–£—Ä. '+lvl+' / '+item.max+'</div></div><button class="shop-btn coins-btn" '+(!can?'disabled':'')+'>'+(maxed?'MAX':'ü™ô '+formatNum(cost))+'</button></div>';
    });
    h+='</div>';c.innerHTML=h;
  }else{
    let h='<div class="shop-section-title">‚≠ê –ü—Ä–µ–º–∏—É–º –∑–∞ Telegram Stars</div><div class="shop-list">';
    starUpgrades.forEach(item=>{
      const bought=S.premiumUpgrades&&S.premiumUpgrades[item.id],can=item.once?!bought:true;
      h+='<div class="shop-item" '+(can?'onclick="buyStar(\''+item.id+'\')"':'')+'><div class="shop-icon" style="background:'+item.bg+'">'+item.icon+'</div><div class="shop-info"><div class="shop-name">'+item.name+'</div><div class="shop-desc">'+item.desc+'</div>'+(bought&&item.once?'<div class="shop-level" style="color:var(--green)">‚úÖ –ö—É–ø–ª–µ–Ω–æ</div>':'')+'</div><button class="shop-btn stars-btn" '+(!can?'disabled':'')+'>'+(bought&&item.once?'‚úÖ':'‚≠ê '+item.stars)+'</button></div>';
    });
    h+='</div>';c.innerHTML=h;
  }
}

function buyCoin(id){
  const item=coinUpgrades.find(x=>x.id===id);if(!item)return;
  const lvl=S.upgrades[item.id]||0,cost=getUpgradeCost(item);
  if(S.coins<cost||lvl>=item.max)return;
  S.coins-=cost;S.upgrades[item.id]=lvl+1;
  applyEffect(item.eff,item.val);recalcStats();save();syncToCloud();renderShop();updateClickerUI();checkAchievements();
  showToast('‚úÖ '+item.name+' ‚Üí –£—Ä. '+S.upgrades[item.id]);
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
}

async function buyStar(id){
  const item=starUpgrades.find(x=>x.id===id);if(!item)return;
  if(item.once&&S.premiumUpgrades&&S.premiumUpgrades[item.id])return;
  if(!tg){showToast('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram');return;}
  showToast('‚è≥ –°–æ–∑–¥–∞—é –ø–ª–∞—Ç—ë–∂...');
  try{
    const payload=JSON.stringify({item_id:item.id,user_id:getUserId(),ts:Date.now()});
    const res=await fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/createInvoiceLink',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({title:item.name,description:item.desc,payload:payload,provider_token:'',currency:'XTR',prices:[{label:item.name,amount:item.stars}]})
    });
    const data=await res.json();
    if(!data.ok||!data.result){showToast('‚ùå –û—à–∏–±–∫–∞: '+(data.description||'–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));return;}
    tg.openInvoice(data.result,function(status){
      if(status==='paid'){
        if(!S.premiumUpgrades)S.premiumUpgrades={};
        if(item.once)S.premiumUpgrades[item.id]=true;
        applyEffect(item.eff,item.val);recalcStats();save();syncToCloud();renderShop();updateClickerUI();checkAchievements();
        showToast('üåü '+item.name+' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
        if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');
      }else if(status==='cancelled'){showToast('‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ');}
      else if(status==='failed'){showToast('‚ùå –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã');}
      else if(status==='pending'){showToast('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ...');}
    });
  }catch(e){console.error(e);showToast('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');}
}

function applyEffect(eff,val){
  if(eff==='perTap')S.perTap+=val;if(eff==='perTapMult')S.perTap*=val;
  if(eff==='maxEnergy'){S.maxEnergy+=val;S.energy=Math.min(S.energy+val,S.maxEnergy);}
  if(eff==='energyRegen')S.energyRegen+=val;if(eff==='cps')S.cps+=val;
  if(eff==='coins'){S.coins+=val;S.totalEarned+=val;}
  if(eff==='prestigeMult')S.prestigeMultiplier=(S.prestigeMultiplier||1)*val;
}

// ===================== SKINS =====================
function renderSkins(){
  document.getElementById('skins-balance').textContent=formatNum(S.coins);
  const g=document.getElementById('skins-grid');g.innerHTML='';
  Object.entries(SKINS).forEach(([id,skin])=>{
    const owned=S.ownedSkins.includes(id),eq=S.skin===id,can=!owned&&S.coins>=skin.price;
    const d=document.createElement('div');d.className='skin-card'+(eq?' active':'')+(!owned?' locked':'');
    d.innerHTML=skin.svg+'<div class="skin-card-name">'+skin.name+'</div><div class="skin-card-price">'+(owned?(eq?'–ù–∞–¥–µ—Ç–æ':'–ù–∞–¥–µ—Ç—å'):'ü™ô '+formatNum(skin.price))+'</div>'+(eq?'<div class="skin-badge equipped">‚úì</div>':'')+(!owned?'<div class="skin-badge lock">üîí</div>':'');
    d.onclick=()=>{
      if(eq)return;
      if(owned){S.skin=id;setClickerSkin(id);save();syncToCloud();renderSkins();showToast('üé® '+skin.name);if(tg&&tg.HapticFeedback)tg.HapticFeedback.impactOccurred('medium');}
      else if(can){S.coins-=skin.price;S.ownedSkins.push(id);S.skin=id;setClickerSkin(id);save();syncToCloud();renderSkins();updateClickerUI();checkAchievements();showToast('üéâ '+skin.name+' –∫—É–ø–ª–µ–Ω!');if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('success');}
      else{showToast('ü™ô –ù—É–∂–Ω–æ '+formatNum(skin.price));if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('error');}
    };
    g.appendChild(d);
  });
}

// ===================== ACHIEVEMENTS UI =====================
function renderAchievements(){
  const g=document.getElementById('ach-grid');g.innerHTML='';
  let unlocked=0;
  ACHIEVEMENTS.forEach(a=>{
    const done=!!S.achievements[a.id];if(done)unlocked++;
    const progress=getAchProgress(a);
    const d=document.createElement('div');d.className='ach-item '+(done?'unlocked':'locked');
    d.innerHTML='<div class="ach-icon">'+a.icon+'</div><div class="ach-info"><div class="ach-name">'+a.name+'</div><div class="ach-desc">'+a.desc+'</div>'+(a.reward>0?'<div class="ach-reward">ü™ô +'+formatNum(a.reward)+'</div>':'')+'</div>'+(done?'<div class="ach-check">‚úÖ</div>':'<div class="ach-progress"><div class="ach-progress-fill" style="width:'+Math.min(progress*100,100)+'%"></div></div>');
    g.appendChild(d);
  });
  document.getElementById('ach-counter').textContent=unlocked+' / '+ACHIEVEMENTS.length+' üèÖ';
}
function getAchProgress(a){
  if(a.id.startsWith('taps')){const t=parseInt(a.id.replace('taps',''))||100;return S.totalTaps/t;}
  if(a.id.startsWith('earn')){const m={'earn1k':1000,'earn10k':10000,'earn100k':100000,'earn1m':1000000};return S.totalEarned/(m[a.id]||1000);}
  if(a.id.startsWith('combo')){const t=parseInt(a.id.replace('combo',''))||10;return S.maxCombo/t;}
  if(a.id==='skin3')return S.ownedSkins.length/3;
  if(a.id==='skin6')return S.ownedSkins.length/6;
  if(a.id==='prestige1')return S.prestige/1;
  if(a.id==='prestige5')return S.prestige/5;
  if(a.id==='daily7')return S.dailyStreak/7;
  if(a.id==='daily30')return S.dailyStreak/30;
  if(a.id==='cps10')return S.cps/10;
  if(a.id==='cps50')return S.cps/50;
  if(a.id==='pertap20')return S.perTap/20;
  return 0;
}

// ===================== LEADERBOARD (FIREBASE) =====================
let lbSort='totalEarned';
function switchLbTab(t){lbSort=t==='taps'?'totalTaps':'totalEarned';document.querySelectorAll('.lb-tab').forEach((el,i)=>el.classList.toggle('active',t==='taps'?i===1:i===0));renderLeaderboard();}

async function renderLeaderboard(){
  const list=document.getElementById('lb-list');
  list.innerHTML='<div class="lb-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  await syncToCloud();
  try{
    const snap=await db.ref('players').orderByChild(lbSort).limitToLast(50).once('value');
    const players=[];
    snap.forEach(ch=>{const d=ch.val();if(d&&d.name)players.push({uid:ch.key,...d});});
    players.sort((a,b)=>(b[lbSort]||0)-(a[lbSort]||0));
    if(players.length===0){
      list.innerHTML='<div class="lb-empty"><div class="lb-empty-icon">üèÜ</div><div class="lb-empty-title">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div><div class="lb-empty-desc">–ù–∞—á–Ω–∏ –∏–≥—Ä–∞—Ç—å –∏ –ø—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π!</div><button class="lb-invite-btn" onclick="shareBot()">üì§ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button></div>';
      return;
    }
    const myUid=getUserId();list.innerHTML='';
    players.forEach((p,i)=>{
      const rank=i+1,isMe=String(p.uid)===String(myUid);
      const topC=rank===1?'top1':rank===2?'top2':rank===3?'top3':'';
      const medals=['','ü•á','ü•à','ü•â'];
      const val=p[lbSort]||0;
      const name=p.name||'–ò–≥—Ä–æ–∫';
      const initial=name.charAt(0).toUpperCase();
      const avatar=p.photo?'<img class="lb-avatar" src="'+p.photo+'" alt="" onerror="this.outerHTML=\'<div class=lb-avatar>'+initial+'</div>\'">':'<div class="lb-avatar">'+initial+'</div>';
      const item=document.createElement('div');
      item.className='lb-item '+topC+(isMe?' me':'');
      item.innerHTML='<div class="lb-rank">'+(rank<=3?medals[rank]:rank)+'</div>'+avatar+'<div class="lb-info"><div class="lb-name">'+name+'</div>'+(isMe?'<div class="lb-you">–≠—Ç–æ —Ç—ã!</div>':'')+'</div><div class="lb-score">ü™ô '+formatNum(val)+'</div>';
      list.appendChild(item);
    });
  }catch(e){
    console.error('LB error:',e);
    list.innerHTML='<div class="lb-loading">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
  }
}

// ===================== PROFILE =====================
function renderProfile(){
  const name=getUserName(),uname=getUserUsername();
  const photo=getUserPhoto()||'https://ui-avatars.com/api/?name='+encodeURIComponent(name)+'&background=007aff&color=fff&size=200&bold=true';
  document.getElementById('profile-avatar').src=photo;
  document.getElementById('profile-name').textContent=name;
  document.getElementById('profile-username').textContent=uname;
  document.getElementById('p-coins').textContent=formatNum(S.coins);
  document.getElementById('p-taps').textContent=formatNum(S.totalTaps);
  document.getElementById('p-pertap').textContent=formatNum(S.perTap);
  document.getElementById('p-maxe').textContent=formatNum(S.maxEnergy);
  document.getElementById('p-prestige').textContent=S.prestige||0;
  document.getElementById('p-streak').textContent=S.dailyStreak||0;
  renderPrestige();
}
function shareBot(){
  const text='üéÆ –ò–≥—Ä–∞—é –≤ Vriska\'s Clicker!\nü™ô –£–∂–µ '+formatNum(S.totalEarned)+' –º–æ–Ω–µ—Ç!\n–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è!';
  if(tg)tg.openTelegramLink('https://t.me/share/url?url=https://t.me/VriskasRobot&text='+encodeURIComponent(text));
  else showToast('üìã t.me/VriskasRobot');
}
async function resetProgress(){
  if(!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!'))return;
  if(fbReady)try{await db.ref('players/'+getUserId()).remove();}catch(e){}
  localStorage.removeItem(SAVE_KEY);S=defaultState();save();
  setClickerSkin('classic');updateClickerUI();renderProfile();renderDaily();
  showToast('üóë –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
  if(tg&&tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('warning');
}

// ===================== RECALC =====================
function recalcStats(){
  let pt=1,me=500,cps=0,rg=1;
  coinUpgrades.forEach(item=>{const l=S.upgrades[item.id]||0;if(item.eff==='perTap')pt+=item.val*l;if(item.eff==='maxEnergy')me+=item.val*l;if(item.eff==='cps')cps+=item.val*l;if(item.eff==='energyRegen')rg+=item.val*l;});
  starUpgrades.forEach(item=>{if(S.premiumUpgrades&&S.premiumUpgrades[item.id]){if(item.eff==='perTapMult')pt*=item.val;if(item.eff==='perTap')pt+=item.val;if(item.eff==='maxEnergy')me+=item.val;if(item.eff==='cps')cps+=item.val;if(item.eff==='energyRegen')rg+=item.val;}});
  S.perTap=pt;S.maxEnergy=me;S.cps=cps;S.energyRegen=rg;
  if(S.energy>S.maxEnergy)S.energy=S.maxEnergy;
}

// ===================== INIT =====================
recalcStats();applyOffline();setClickerSkin(S.skin||'classic');updateClickerUI();renderDaily();
slider.style.transform='translateX(0%)';
initFirebase();
setInterval(()=>syncToCloud(),30000);
setInterval(save,5000);
setInterval(()=>checkAchievements(),10000);
document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='hidden')syncToCloud();});
</script>
</body>
</html>
