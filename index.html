<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Vriskas Clicker</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{--bg:#0a0a0f;--bg2:#12121a;--card:#1a1a2e;--card2:#16213e;--text:#e8e8f0;--text2:#8888aa;--accent:#6c5ce7;--accent2:#a29bfe;--gold:#ffd700;--green:#00b894;--red:#ff6b6b;--blue:#74b9ff;--pink:#fd79a8;--orange:#fdcb6e;--cyan:#81ecec;--radius:16px;--shadow:0 4px 20px rgba(0,0,0,0.4)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;user-select:none}
body.light{--bg:#f0f2f5;--bg2:#fff;--card:#fff;--card2:#f5f5fa;--text:#1a1a2e;--text2:#666;--shadow:0 2px 12px rgba(0,0,0,0.1)}
body.material{--radius:28px}
body.material .card{border:1px solid rgba(108,92,231,0.2)}
body.material .tab-btn{border-radius:20px}

.app{height:100vh;display:flex;flex-direction:column}
.top-bar{padding:8px 16px;display:flex;align-items:center;justify-content:space-between;background:var(--bg2);border-bottom:1px solid rgba(255,255,255,0.05);z-index:100;min-height:48px}
.top-bar .res{display:flex;align-items:center;gap:6px;font-size:13px;font-weight:700}
.top-bar .res svg{width:18px;height:18px}
.top-bar .lvl{font-size:11px;background:var(--accent);padding:2px 8px;border-radius:10px;color:#fff}

.pages{flex:1;overflow:hidden;position:relative}
.page{position:absolute;inset:0;overflow-y:auto;padding:12px;padding-bottom:80px;opacity:0;pointer-events:none;transform:scale(0.95);transition:all 0.3s ease}
.page.active{opacity:1;pointer-events:all;transform:scale(1)}
.page::-webkit-scrollbar{display:none}

.card{background:var(--card);border-radius:var(--radius);padding:14px;margin-bottom:10px;box-shadow:var(--shadow)}
.card-title{font-size:14px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.card-title svg{width:20px;height:20px}

.nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:var(--bg2);border-top:1px solid rgba(255,255,255,0.05);padding:6px 4px;padding-bottom:env(safe-area-inset-bottom,6px);z-index:100}
.tab-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 0;border:none;background:none;color:var(--text2);font-size:10px;cursor:pointer;transition:all 0.2s;border-radius:12px;position:relative}
.tab-btn.active{color:var(--accent)}
.tab-btn.active::after{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:20px;height:3px;background:var(--accent);border-radius:2px}
.tab-btn svg{width:22px;height:22px;transition:transform 0.2s}
.tab-btn.active svg{transform:scale(1.15)}

.clicker-area{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;position:relative}
.clicker-bg{position:absolute;inset:0;overflow:hidden;pointer-events:none}
.clicker-bg .particle{position:absolute;border-radius:50%;opacity:0.15;animation:floatP 8s infinite ease-in-out}
@keyframes floatP{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-40px) scale(1.3)}}

.coin-wrap{position:relative;cursor:pointer;-webkit-tap-highlight-color:transparent}
.coin-btn{width:160px;height:160px;border-radius:50%;border:none;cursor:pointer;position:relative;transition:transform 0.1s;background:none;padding:0}
.coin-btn:active{transform:scale(0.9)}
.coin-btn svg{width:100%;height:100%}
.coin-ring{position:absolute;inset:-12px;border-radius:50%;border:2px solid var(--accent);opacity:0.3;animation:pulse-ring 2s infinite}
@keyframes pulse-ring{0%,100%{transform:scale(1);opacity:0.3}50%{transform:scale(1.08);opacity:0.1}}
.coin-glow{position:absolute;inset:-30px;border-radius:50%;background:radial-gradient(circle,rgba(108,92,231,0.2),transparent 70%);pointer-events:none;animation:glow-pulse 3s infinite}
@keyframes glow-pulse{0%,100%{opacity:0.5;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}}

.float-text{position:fixed;pointer-events:none;font-weight:900;font-size:22px;color:var(--gold);text-shadow:0 0 10px rgba(255,215,0,0.5);animation:floatUp 1s forwards;z-index:999}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(0.5)}}

.energy-bar{width:200px;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;margin-top:16px;overflow:hidden}
.energy-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--cyan));border-radius:4px;transition:width 0.3s}
.energy-text{font-size:12px;color:var(--text2);margin-top:4px}

.combo-badge{position:absolute;top:-20px;right:-20px;background:var(--red);color:#fff;font-size:12px;font-weight:900;padding:4px 10px;border-radius:12px;animation:comboPop 0.3s}
@keyframes comboPop{0%{transform:scale(0)}50%{transform:scale(1.3)}100%{transform:scale(1)}}

.score-display{font-size:36px;font-weight:900;margin-bottom:4px;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.per-tap{font-size:13px;color:var(--text2);margin-bottom:8px}
.lvl-bar{width:200px;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;margin-top:8px;overflow:hidden}
.lvl-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:3px;transition:width 0.5s}
.lvl-text{font-size:11px;color:var(--text2);margin-top:3px}

.upgrade-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:var(--bg);margin-bottom:6px;cursor:pointer;transition:all 0.2s;border:1px solid transparent}
.upgrade-item:hover{border-color:var(--accent)}
.upgrade-item.locked{opacity:0.4;pointer-events:none}
.upgrade-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.upgrade-info{flex:1;min-width:0}
.upgrade-info h4{font-size:13px;font-weight:700;margin-bottom:2px}
.upgrade-info p{font-size:11px;color:var(--text2)}
.upgrade-price{font-size:12px;font-weight:700;color:var(--gold);white-space:nowrap;display:flex;align-items:center;gap:4px}
.upgrade-price svg{width:14px;height:14px}

.skin-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.skin-card{background:var(--bg);border-radius:14px;padding:10px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.skin-card.active{border-color:var(--accent);box-shadow:0 0 20px rgba(108,92,231,0.3)}
.skin-card.locked{opacity:0.5}
.skin-card svg{width:56px;height:56px;margin:4px auto}
.skin-card .name{font-size:10px;font-weight:700;margin-top:4px}
.skin-card .bonus{font-size:9px;color:var(--green)}
.skin-card .price{font-size:9px;color:var(--gold);margin-top:2px}

.ach-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:var(--bg);margin-bottom:4px}
.ach-item.done{background:rgba(0,184,148,0.1);border:1px solid rgba(0,184,148,0.2)}
.ach-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.ach-info{flex:1}
.ach-info h4{font-size:12px;font-weight:700}
.ach-info p{font-size:10px;color:var(--text2)}
.ach-prog{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin-top:3px;overflow:hidden}
.ach-prog-fill{height:100%;background:var(--green);border-radius:2px;transition:width 0.3s}
.ach-reward{font-size:10px;color:var(--gold);white-space:nowrap}

.lb-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:var(--bg);margin-bottom:4px}
.lb-pos{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:900;flex-shrink:0}
.lb-info{flex:1}
.lb-info h4{font-size:13px;font-weight:700}
.lb-info p{font-size:10px;color:var(--text2)}
.lb-score{font-size:12px;font-weight:700;color:var(--gold)}
.lb-me{border:1px solid var(--accent)}

.btn{padding:10px 20px;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:6px;width:100%}
.btn:active{transform:scale(0.95)}
.btn-primary{background:var(--accent);color:#fff}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--orange));color:#000}
.btn-red{background:var(--red);color:#fff}
.btn-green{background:var(--green);color:#fff}
.btn-outline{background:none;border:1px solid var(--accent);color:var(--accent)}

.tabs-row{display:flex;gap:4px;margin-bottom:10px;background:var(--bg);border-radius:10px;padding:3px}
.tabs-row button{flex:1;padding:6px;border:none;background:none;color:var(--text2);font-size:11px;font-weight:700;border-radius:8px;cursor:pointer;transition:all 0.2s}
.tabs-row button.active{background:var(--accent);color:#fff}

.modal{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(10px);opacity:0;pointer-events:none;transition:opacity 0.3s}
.modal.show{opacity:1;pointer-events:all}
.modal-box{background:var(--card);border-radius:20px;padding:20px;width:90%;max-width:360px;max-height:80vh;overflow-y:auto;transform:scale(0.8);transition:transform 0.3s}
.modal.show .modal-box{transform:scale(1)}

.boss-overlay{position:fixed;inset:0;z-index:900;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;opacity:0;pointer-events:none;transition:opacity 0.3s}
.boss-overlay.show{opacity:1;pointer-events:all}
.boss-hp{width:80%;height:14px;background:rgba(255,255,255,0.1);border-radius:7px;overflow:hidden}
.boss-hp-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--orange));border-radius:7px;transition:width 0.2s}
.boss-btn{width:120px;height:120px;border-radius:50%;border:3px solid var(--red);background:rgba(255,0,0,0.1);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform 0.1s}
.boss-btn:active{transform:scale(0.85)}
.boss-btn svg{width:80px;height:80px}
.boss-shake{animation:bshake 0.15s}
@keyframes bshake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}

.duel-overlay{position:fixed;inset:0;z-index:900;background:rgba(0,0,0,0.9);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;opacity:0;pointer-events:none;transition:opacity 0.3s}
.duel-overlay.show{opacity:1;pointer-events:all}
.duel-vs{display:flex;align-items:center;gap:20px;margin-bottom:10px}
.duel-player{text-align:center}
.duel-player .name{font-size:12px;margin-top:4px}
.duel-player .score{font-size:28px;font-weight:900;color:var(--gold)}
.duel-tap-btn{width:140px;height:140px;border-radius:50%;border:3px solid var(--accent);background:rgba(108,92,231,0.15);cursor:pointer;font-size:48px;display:flex;align-items:center;justify-content:center;transition:transform 0.1s}
.duel-tap-btn:active{transform:scale(0.85)}

.roulette-canvas{width:100%;max-width:280px;height:280px;margin:0 auto;display:block}

.golden-coin{position:fixed;width:44px;height:44px;z-index:800;cursor:pointer;animation:goldenFloat 1s infinite alternate;filter:drop-shadow(0 0 12px rgba(255,215,0,0.6))}
@keyframes goldenFloat{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.15) rotate(15deg)}}

.toast{position:fixed;top:60px;left:50%;transform:translateX(-50%) translateY(-100px);background:var(--card);color:var(--text);padding:10px 20px;border-radius:14px;font-size:13px;font-weight:600;z-index:2000;transition:transform 0.4s;box-shadow:var(--shadow);max-width:90%;text-align:center}
.toast.show{transform:translateX(-50%) translateY(0)}

.event-banner{position:fixed;top:50px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--accent),var(--pink));color:#fff;padding:8px 18px;border-radius:20px;font-size:12px;font-weight:700;z-index:800;animation:bannerPulse 1s infinite alternate;white-space:nowrap}
@keyframes bannerPulse{0%{box-shadow:0 0 10px rgba(108,92,231,0.3)}100%{box-shadow:0 0 25px rgba(108,92,231,0.6)}}

.banned-screen{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.banned-screen svg{width:80px;height:80px}
.banned-screen h2{color:var(--red);font-size:24px}
.banned-screen p{color:var(--text2);font-size:14px;text-align:center;max-width:280px}

.quest-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:var(--bg);margin-bottom:4px}
.quest-item.done{opacity:0.5}
.quest-prog{flex:1}
.quest-prog h4{font-size:12px;font-weight:700}
.quest-prog p{font-size:10px;color:var(--text2)}
.quest-bar{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin-top:3px;overflow:hidden}
.quest-bar-fill{height:100%;background:var(--green);border-radius:2px}

.pet-card{background:var(--bg);border-radius:14px;padding:12px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.pet-card.active{border-color:var(--green)}
.pet-card.locked{opacity:0.5}
.pet-card svg{width:48px;height:48px;margin:4px auto}
.pet-card .name{font-size:11px;font-weight:700;margin-top:4px}
.pet-card .desc{font-size:9px;color:var(--text2)}

.artifact-card{background:var(--bg);border-radius:14px;padding:10px;text-align:center;border:2px solid transparent;transition:all 0.2s}
.artifact-card.owned{border-color:var(--gold);box-shadow:0 0 15px rgba(255,215,0,0.15)}
.artifact-card svg{width:40px;height:40px;margin:4px auto}

.settings-item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:var(--bg);margin-bottom:6px}
.settings-item label{font-size:13px;font-weight:600}
.toggle{width:44px;height:24px;background:rgba(255,255,255,0.15);border-radius:12px;position:relative;cursor:pointer;transition:background 0.3s}
.toggle.on{background:var(--green)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform 0.3s}
.toggle.on::after{transform:translateX(20px)}

.ripple{position:absolute;border-radius:50%;background:rgba(108,92,231,0.3);transform:scale(0);animation:rippleAnim 0.6s}
@keyframes rippleAnim{to{transform:scale(4);opacity:0}}

.admin-player{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:var(--bg);margin-bottom:4px}
.admin-player .info{flex:1}
.admin-player .info h4{font-size:12px}
.admin-player .info p{font-size:10px;color:var(--text2)}
.admin-player .actions{display:flex;gap:4px}
.admin-player .actions button{padding:4px 8px;border:none;border-radius:6px;font-size:10px;font-weight:700;cursor:pointer}

.streak-display{display:flex;gap:6px;margin:8px 0}
.streak-day{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;background:var(--bg);border:1px solid rgba(255,255,255,0.1)}
.streak-day.claimed{background:var(--green);color:#fff;border-color:var(--green)}
.streak-day.current{border-color:var(--gold);color:var(--gold)}

.world-card{background:var(--bg);border-radius:14px;padding:12px;margin-bottom:8px;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.world-card.active{border-color:var(--accent)}
.world-card.locked{opacity:0.4;pointer-events:none}
.world-card h4{font-size:13px;font-weight:700}
.world-card p{font-size:11px;color:var(--text2);margin-top:2px}

input[type="number"],input[type="text"]{background:var(--bg);border:1px solid rgba(255,255,255,0.1);color:var(--text);padding:8px 12px;border-radius:10px;font-size:14px;width:100%}

.secret-input{display:flex;gap:6px;margin-top:8px}
.secret-input input{flex:1}
.secret-input button{padding:8px 16px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="app">
<div class="top-bar">
<div style="display:flex;align-items:center;gap:8px">
<span class="lvl" id="top-lvl">–£—Ä.1</span>
<span id="top-name" style="font-size:13px;font-weight:600">–ò–≥—Ä–æ–∫</span>
</div>
<div style="display:flex;gap:12px">
<div class="res"><svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/><text x="12" y="16" text-anchor="middle" font-size="12" font-weight="900" fill="#8B6914">$</text></svg><span id="top-coins">0</span></div>
<div class="res"><svg viewBox="0 0 24 24" fill="none"><polygon points="12,2 15,9 22,9 16.5,14 18.5,21 12,17 5.5,21 7.5,14 2,9 9,9" fill="#a29bfe" stroke="#6c5ce7" stroke-width="1.5"/></svg><span id="top-stars">0</span></div>
</div>
</div>

<div class="pages">
<!-- –ö–õ–ò–ö–ï–† -->
<div class="page active" id="page-clicker">
<div class="clicker-area">
<div class="clicker-bg" id="clicker-bg"></div>
<div class="score-display" id="score-display">0</div>
<div class="per-tap" id="per-tap-text">+1 –∑–∞ —Ç–∞–ø ‚Ä¢ 0/—Å–µ–∫</div>
<div class="lvl-bar"><div class="lvl-fill" id="lvl-fill" style="width:0"></div></div>
<div class="lvl-text" id="lvl-text">–£—Ä.1 –ù–æ–≤–∏—á–æ–∫ ‚Ä¢ 0/100 XP</div>
<div class="coin-wrap" style="margin-top:16px">
<div class="coin-glow"></div>
<div class="coin-ring"></div>
<button class="coin-btn" id="coin-btn" ontouchstart="doClick(event)" onmousedown="doClick(event)">
<svg id="coin-svg" viewBox="0 0 160 160"><defs><radialGradient id="cg1" cx="40%" cy="35%"><stop offset="0%" stop-color="#FFE66D"/><stop offset="100%" stop-color="#F7A800"/></radialGradient></defs><circle cx="80" cy="80" r="72" fill="url(#cg1)" stroke="#D4900A" stroke-width="4"/><circle cx="80" cy="80" r="58" fill="none" stroke="#FFF5CC" stroke-width="2" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="42" font-weight="900" fill="#8B6914">V</text></svg>
</button>
<div class="combo-badge" id="combo-badge" style="display:none">x1</div>
</div>
<div class="energy-bar"><div class="energy-fill" id="energy-fill" style="width:100%"></div></div>
<div class="energy-text" id="energy-text">‚ö° 1000/1000</div>
</div>
</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div class="page" id="page-shop">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="14" rx="2" fill="none" stroke="var(--accent)" stroke-width="2"/><path d="M3 10h18" stroke="var(--accent)" stroke-width="2"/><circle cx="7" cy="14" r="1.5" fill="var(--accent)"/></svg>–ú–∞–≥–∞–∑–∏–Ω</div>
<div class="tabs-row" id="shop-tabs">
<button class="active" onclick="showShopTab(0)">üí∞ –ú–æ–Ω–µ—Ç—ã</button>
<button onclick="showShopTab(1)">üéÅ –û—Å–æ–±–æ–µ</button>
<button onclick="showShopTab(2)">‚≠ê Stars</button>
<button onclick="showShopTab(3)">üêæ –ü–∏—Ç–æ–º—Ü—ã</button>
<button onclick="showShopTab(4)">üèõ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</button>
</div>
<div id="shop-content"></div>
</div>
</div>

<!-- –°–ö–ò–ù–´ -->
<div class="page" id="page-skins">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" fill="none" stroke="var(--pink)" stroke-width="2"/><circle cx="12" cy="12" r="5" fill="var(--pink)" opacity="0.3"/><circle cx="12" cy="12" r="2" fill="var(--pink)"/></svg>–°–∫–∏–Ω—ã</div>
<div class="skin-grid" id="skin-grid"></div>
</div>
</div>

<!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø -->
<div class="page" id="page-ach">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="6" fill="none" stroke="var(--gold)" stroke-width="2"/><polygon points="12,2 13.5,6.5 18,6.5 14.5,9.5 15.5,14 12,11 8.5,14 9.5,9.5 6,6.5 10.5,6.5" fill="var(--gold)"/><path d="M8 16h8v2a2 2 0 01-2 2h-4a2 2 0 01-2-2v-2z" fill="var(--gold)" opacity="0.5"/></svg>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è <span id="ach-count" style="font-size:11px;color:var(--text2)"></span></div>
<div id="ach-list"></div>
</div>
</div>

<!-- –ö–í–ï–°–¢–´ -->
<div class="page" id="page-quests">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><rect x="4" y="3" width="16" height="18" rx="2" fill="none" stroke="var(--cyan)" stroke-width="2"/><path d="M8 8h8M8 12h6M8 16h4" stroke="var(--cyan)" stroke-width="2" stroke-linecap="round"/></svg>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã</div>
<div id="quest-list"></div>
</div>
<div class="card">
<div class="card-title">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</div>
<div class="streak-display" id="streak-display"></div>
<button class="btn btn-gold" id="daily-btn" onclick="claimDaily()">–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å</button>
</div>
<div class="card">
<div class="card-title">üåç –ú–∏—Ä—ã</div>
<div id="worlds-list"></div>
</div>
<div class="card">
<div class="card-title">üîë –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥</div>
<div class="secret-input">
<input type="text" id="code-input" placeholder="–í–≤–µ–¥–∏ –∫–æ–¥...">
<button onclick="useCode()">OK</button>
</div>
</div>
</div>

<!-- –ë–û–ô -->
<div class="page" id="page-battle">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><path d="M6 2l2 8-4 2 8 10 2-8 4-2L10 2" fill="none" stroke="var(--red)" stroke-width="2" stroke-linejoin="round"/></svg>–ë–æ–µ–≤–∞—è –∞—Ä–µ–Ω–∞</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
<button class="btn btn-red" onclick="startBoss()" id="boss-start-btn">üëπ –í—ã–∑–≤–∞—Ç—å –±–æ—Å—Å–∞</button>
<button class="btn btn-primary" onclick="startDuel()">‚öîÔ∏è –ù–∞–π—Ç–∏ –¥—É—ç–ª—å</button>
</div>
<div style="margin-top:8px;font-size:11px;color:var(--text2)">
<div>–ë–æ—Å—Å–æ–≤ —É–±–∏—Ç–æ: <span id="bosses-killed">0</span></div>
<div>–î—É—ç–ª–µ–π –≤—ã–∏–≥—Ä–∞–Ω–æ: <span id="duels-won">0</span></div>
</div>
</div>
<div class="card">
<div class="card-title">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
<canvas class="roulette-canvas" id="roulette-canvas"></canvas>
<button class="btn btn-gold" id="roulette-btn" onclick="spinRoulette()" style="margin-top:8px">–ö—Ä—É—Ç–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
</div>
</div>

<!-- –õ–ò–î–ï–†–´ -->
<div class="page" id="page-lb">
<div class="card">
<div class="card-title"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="12" width="5" height="9" rx="1" fill="var(--blue)"/><rect x="9.5" y="6" width="5" height="15" rx="1" fill="var(--gold)"/><rect x="16" y="9" width="5" height="12" rx="1" fill="var(--green)"/></svg>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</div>
<div class="tabs-row">
<button class="active" onclick="loadLB(0,this)">–ú–æ–Ω–µ—Ç—ã</button>
<button onclick="loadLB(1,this)">–¢–∞–ø—ã</button>
<button onclick="loadLB(2,this)">–£—Ä–æ–≤–µ–Ω—å</button>
</div>
<div id="lb-list"></div>
</div>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div class="page" id="page-profile">
<div class="card" style="text-align:center">
<div id="profile-photo" style="width:64px;height:64px;border-radius:50%;background:var(--accent);margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:28px;overflow:hidden">üë§</div>
<h3 id="profile-name">–ò–≥—Ä–æ–∫</h3>
<div id="profile-badges" style="display:flex;gap:4px;justify-content:center;margin:6px 0;flex-wrap:wrap"></div>
</div>
<div class="card">
<div class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
<div id="profile-stats" style="font-size:12px"></div>
</div>
<div class="card">
<div class="card-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
<div class="settings-item"><label>Material You</label><div class="toggle" id="toggle-material" onclick="toggleMaterial()"></div></div>
<div class="settings-item"><label>–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</label><div class="toggle" id="toggle-light" onclick="toggleLight()"></div></div>
<div class="settings-item"><label>Haptic</label><div class="toggle on" id="toggle-haptic" onclick="toggleHaptic()"></div></div>
<div class="settings-item"><label>–ó–≤—É–∫–∏</label><div class="toggle on" id="toggle-sound" onclick="toggleSound()"></div></div>
</div>
<div class="card">
<button class="btn btn-primary" onclick="testPayment()" style="margin-bottom:6px">‚≠ê –¢–µ—Å—Ç –æ–ø–ª–∞—Ç—ã (1‚≠ê‚Üí–≤–æ–∑–≤—Ä–∞—Ç)</button>
<button class="btn btn-outline" onclick="shareBot()" style="margin-bottom:6px">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º</button>
<button class="btn btn-red" onclick="resetProgress()">üóë –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</button>
</div>
<div id="admin-section"></div>
</div>
</div>

<nav class="nav">
<button class="tab-btn active" onclick="switchTab(0,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="900" fill="currentColor" stroke="none">V</text></svg><span>–ö–ª–∏–∫–µ—Ä</span></button>
<button class="tab-btn" onclick="switchTab(1,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="6" width="18" height="14" rx="2"/><path d="M3 10h18"/></svg><span>–ú–∞–≥–∞–∑–∏–Ω</span></button>
<button class="tab-btn" onclick="switchTab(2,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="4"/></svg><span>–°–∫–∏–Ω—ã</span></button>
<button class="tab-btn" onclick="switchTab(3,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15,9 22,9 16.5,14 18.5,21 12,17 5.5,21 7.5,14 2,9 9,9"/></svg><span>–ê—á–∏–≤–∫–∏</span></button>
<button class="tab-btn" onclick="switchTab(4,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="3" width="16" height="18" rx="2"/><path d="M8 8h8M8 12h6"/></svg><span>–ö–≤–µ—Å—Ç—ã</span></button>
<button class="tab-btn" onclick="switchTab(5,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2l2 8-4 2 8 10"/><circle cx="16" cy="8" r="4"/></svg><span>–ë–æ–π</span></button>
<button class="tab-btn" onclick="switchTab(6,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="12" width="5" height="9" rx="1"/><rect x="9.5" y="6" width="5" height="15" rx="1"/><rect x="16" y="9" width="5" height="12" rx="1"/></svg><span>–¢–æ–ø</span></button>
<button class="tab-btn" onclick="switchTab(7,this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="5"/><path d="M4 20c0-4 4-7 8-7s8 3 8 7"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</nav>
</div>

<div class="boss-overlay" id="boss-overlay">
<div style="font-size:14px;color:var(--text2)" id="boss-name">–ë–æ—Å—Å</div>
<div style="font-size:13px;color:var(--red)" id="boss-timer">30—Å</div>
<div class="boss-hp"><div class="boss-hp-fill" id="boss-hp-fill" style="width:100%"></div></div>
<div style="font-size:12px;color:var(--text2)" id="boss-hp-text">1000/1000</div>
<button class="boss-btn" id="boss-btn" ontouchstart="hitBoss()" onmousedown="hitBoss()">
<svg viewBox="0 0 80 80"><circle cx="40" cy="40" r="35" fill="rgba(255,0,0,0.2)" stroke="var(--red)" stroke-width="3"/><text x="40" y="50" text-anchor="middle" font-size="30">üëπ</text></svg>
</button>
<button class="btn btn-outline" onclick="fleeBoss()" style="width:auto;padding:8px 24px;margin-top:8px">–°–±–µ–∂–∞—Ç—å</button>
</div>

<div class="duel-overlay" id="duel-overlay">
<div style="font-size:14px;font-weight:700">‚öîÔ∏è –î–£–≠–õ–¨</div>
<div style="font-size:13px;color:var(--red)" id="duel-timer">30—Å</div>
<div class="duel-vs">
<div class="duel-player"><div class="score" id="duel-my-score">0</div><div class="name" id="duel-my-name">–¢—ã</div></div>
<div style="font-size:20px;color:var(--text2)">VS</div>
<div class="duel-player"><div class="score" id="duel-enemy-score">0</div><div class="name" id="duel-enemy-name">???</div></div>
</div>
<button class="duel-tap-btn" id="duel-tap-btn" ontouchstart="duelTap()" onmousedown="duelTap()">üëä</button>
</div>

<div class="modal" id="modal"><div class="modal-box" id="modal-box"></div></div>
<div class="toast" id="toast"></div>
<div class="banned-screen" id="banned-screen" style="display:none">
<svg viewBox="0 0 80 80"><circle cx="40" cy="40" r="35" fill="none" stroke="var(--red)" stroke-width="4"/><line x1="15" y1="15" x2="65" y2="65" stroke="var(--red)" stroke-width="4"/></svg>
<h2>–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã</h2>
<p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω—ã.</p>
</div>
<div class="banned-screen" id="cheat-screen" style="display:none">
<svg viewBox="0 0 80 80"><circle cx="40" cy="40" r="35" fill="none" stroke="var(--red)" stroke-width="4"/><text x="40" y="50" text-anchor="middle" font-size="28" fill="var(--red)">!</text></svg>
<h2>–ß–∏—Ç–∞–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!</h2>
<p>–í—ã –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω—ã. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã.</p>
</div>

<script>
const BOT_TOKEN='8328808800:AAGXn9OCZNgo79kcWZhnZgx4m1DEiUeVhdc';
const SAVE_KEY='vriskas_v25';
const ADMIN_USERNAME='Vriskas_official';
const tg=window.Telegram&&Telegram.WebApp?Telegram.WebApp:null;
if(tg)tg.expand();
const tgUser=tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user?tg.initDataUnsafe.user:null;
let db=null;

firebase.initializeApp({apiKey:"AIzaSyCnFnvWy-gklDVNqWMOFdx9B9uJi0Lo-JU",authDomain:"telegrambotvriskas.firebaseapp.com",databaseURL:"https://telegrambotvriskas-default-rtdb.firebaseio.com",projectId:"telegrambotvriskas",storageBucket:"telegrambotvriskas.firebasestorage.app",messagingSenderId:"878769255530",appId:"1:878769255530:web:461ef3885f859f039d8613"});
db=firebase.database();

// STATE
let S={coins:0,totalEarned:0,totalTaps:0,perTap:1,cps:0,energy:1000,maxEnergy:1000,energyRegen:1,
xp:0,level:1,
upgrades:{},skinId:'classic',ownedSkins:['classic'],
achievements:[],dailyStreak:0,lastDaily:0,
usedCodes:[],bossesKilled:0,duelsWon:0,duelsLost:0,
stars:0,pets:{},activePet:null,artifacts:{},
world:0,comboCount:0,comboTimer:0,comboMulti:1,
lastSave:0,lastOnline:Date.now(),
quests:{date:'',list:[]},rouletteTime:0,
settings:{material:false,light:false,haptic:true,sound:true}};

const LEVELS=[
{n:'–ù–æ–≤–∏—á–æ–∫',xp:0,r:0,s:0},{n:'–£—á–µ–Ω–∏–∫',xp:100,r:200,s:1},{n:'–ö–ª–∏–∫–µ—Ä',xp:500,r:500,s:2},
{n:'–¢–∞–ø–µ—Ä',xp:1500,r:1000,s:3},{n:'–ú–∞—Å—Ç–µ—Ä',xp:4000,r:2500,s:5},{n:'–≠–∫—Å–ø–µ—Ä—Ç',xp:10000,r:5000,s:8},
{n:'–í–µ—Ç–µ—Ä–∞–Ω',xp:25000,r:10000,s:12},{n:'–ß–µ–º–ø–∏–æ–Ω',xp:60000,r:25000,s:18},{n:'–ì–µ—Ä–æ–π',xp:150000,r:50000,s:25},
{n:'–õ–µ–≥–µ–Ω–¥–∞',xp:400000,r:100000,s:35},{n:'–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π',xp:1000000,r:250000,s:50},{n:'–ë–æ–∂–µ—Å—Ç–≤–æ',xp:2500000,r:500000,s:75},
{n:'–¢–∏—Ç–∞–Ω',xp:6000000,r:1000000,s:100},{n:'–°–æ–∑–¥–∞—Ç–µ–ª—å',xp:15000000,r:2500000,s:150},{n:'–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å',xp:40000000,r:5000000,s:200},
{n:'–û–º–µ–≥–∞',xp:100000000,r:10000000,s:300}];

const WORLDS=[
{n:'–ó–µ–º–ª—è',desc:'–ù–∞—á–∞–ª—å–Ω—ã–π –º–∏—Ä',mult:1,req:0},
{n:'–õ—É–Ω–∞',desc:'x1.5 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø',mult:1.5,req:3},
{n:'–ú–∞—Ä—Å',desc:'x2 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø',mult:2,req:6},
{n:'–Æ–ø–∏—Ç–µ—Ä',desc:'x3 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø',mult:3,req:9},
{n:'–°–∞—Ç—É—Ä–Ω',desc:'x5 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø',mult:5,req:12},
{n:'–ì–∞–ª–∞–∫—Ç–∏–∫–∞',desc:'x10 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø',mult:10,req:15}];

const UPGRADES=[
{id:'finger',n:'–ö—Ä–µ–ø–∫–∏–π –ø–∞–ª–µ—Ü',desc:'+1 –∫ —Ç–∞–ø—É',base:15,scaling:1.25,type:'perTap',val:1,icon:'üëÜ'},
{id:'double',n:'–î–≤–æ–π–Ω–æ–π —É–¥–∞—Ä',desc:'+2 –∫ —Ç–∞–ø—É',base:80,scaling:1.3,type:'perTap',val:2,icon:'‚úåÔ∏è'},
{id:'golden',n:'–ó–æ–ª–æ—Ç–æ–π –ø–∞–ª–µ—Ü',desc:'+5 –∫ —Ç–∞–ø—É',base:400,scaling:1.35,type:'perTap',val:5,icon:'üñêÔ∏è'},
{id:'diamond',n:'–ê–ª–º–∞–∑–Ω—ã–π –∫—É–ª–∞–∫',desc:'+15 –∫ —Ç–∞–ø—É',base:2000,scaling:1.4,type:'perTap',val:15,icon:'üíé'},
{id:'battery',n:'–ë–∞—Ç–∞—Ä–µ–π–∫–∞',desc:'+100 —ç–Ω–µ—Ä–≥–∏–∏',base:50,scaling:1.2,type:'maxEnergy',val:100,icon:'üîã'},
{id:'regen',n:'–£—Å–∫–æ—Ä–∏—Ç–µ–ª—å',desc:'+1 —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Å–µ–∫',base:100,scaling:1.3,type:'energyRegen',val:1,icon:'‚ö°'},
{id:'auto1',n:'–ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä',desc:'+1 –º–æ–Ω–µ—Ç/—Å–µ–∫',base:200,scaling:1.35,type:'cps',val:1,icon:'ü§ñ'},
{id:'auto2',n:'–ú–µ–≥–∞-–±–æ—Ç',desc:'+5 –º–æ–Ω–µ—Ç/—Å–µ–∫',base:1000,scaling:1.4,type:'cps',val:5,icon:'ü¶æ'},
{id:'auto3',n:'–§–∞–±—Ä–∏–∫–∞',desc:'+20 –º–æ–Ω–µ—Ç/—Å–µ–∫',base:5000,scaling:1.45,type:'cps',val:20,icon:'üè≠'},
{id:'auto4',n:'–ò–º–ø–µ—Ä–∏—è',desc:'+100 –º–æ–Ω–µ—Ç/—Å–µ–∫',base:25000,scaling:1.5,type:'cps',val:100,icon:'üè∞'},
{id:'crit',n:'–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä',desc:'–®–∞–Ω—Å x5 –∫ —Ç–∞–ø—É',base:3000,scaling:1.5,type:'special',val:'crit',icon:'üí•'},
{id:'combo',n:'–ö–æ–º–±–æ –º–∞—Å—Ç–µ—Ä',desc:'–ö–æ–º–±–æ –¥–æ–ª—å—à–µ –¥–µ—Ä–∂–∏—Ç—Å—è',base:2000,scaling:1.4,type:'special',val:'combo',icon:'üî•'},
{id:'magnet',n:'–ú–∞–≥–Ω–∏—Ç –º–æ–Ω–µ—Ç',desc:'+10% –∫–æ –≤—Å–µ–º—É',base:5000,scaling:1.5,type:'special',val:'magnet',icon:'üß≤'},
{id:'luck',n:'–£–¥–∞—á–∞',desc:'+20% –∫ —Ä–∞–Ω–¥–æ–º –Ω–∞–≥—Ä–∞–¥–∞–º',base:4000,scaling:1.45,type:'special',val:'luck',icon:'üçÄ'},
{id:'shield',n:'–©–∏—Ç',desc:'-30% –ø–æ—Ç–µ—Ä–∏ –≤ –¥—É—ç–ª—è—Ö',base:3500,scaling:1.4,type:'special',val:'shield',icon:'üõ°Ô∏è'},
{id:'stargen',n:'–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ë–∑–¥',desc:'+1‚≠ê –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω',base:8000,scaling:1.6,type:'special',val:'stargen',icon:'‚≠ê'}];

const SPECIAL_ITEMS=[
{id:'full_energy',n:'–ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è',desc:'–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é',price:3000,icon:'üîã',action:'fullEnergy'},
{id:'x2_60',n:'x2 –º–æ–Ω–µ—Ç—ã –Ω–∞ 60—Å',desc:'–î–≤–æ–π–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –Ω–∞ –º–∏–Ω—É—Ç—É',price:15000,icon:'üí∞',action:'x2'},
{id:'mega_combo',n:'–ú–µ–≥–∞ –∫–æ–º–±–æ x50',desc:'x50 –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 10 —Ç–∞–ø–æ–≤',price:30000,icon:'üî•',action:'megaCombo'},
{id:'buy_stars',n:'–ö—É–ø–∏—Ç—å 10‚≠ê',desc:'10 –∏–≥—Ä–æ–≤—ã—Ö –∑–≤—ë–∑–¥',price:50000,icon:'‚≠ê',action:'buyStars'},
{id:'star_boost',n:'–ó–≤—ë–∑–¥–Ω—ã–π –±—É—Å—Ç',desc:'+5 –∫ —Ç–∞–ø—É –Ω–∞–≤—Å–µ–≥–¥–∞',starPrice:20,icon:'üåü',action:'starBoost'},
{id:'random_skin',n:'–†–∞–Ω–¥–æ–º —Å–∫–∏–Ω',desc:'–°–ª—É—á–∞–π–Ω—ã–π —Å–∫–∏–Ω!',price:8000,icon:'üé≤',action:'randomSkin'},
{id:'boss_summon',n:'–í—ã–∑–æ–≤ —ç–ª–∏—Ç–Ω–æ–≥–æ –±–æ—Å—Å–∞',desc:'–ë–æ—Å—Å —Å x3 –Ω–∞–≥—Ä–∞–¥–æ–π',price:20000,icon:'üëπ',action:'eliteBoss'},
{id:'time_warp',n:'–°–∫–∞—á–æ–∫ –≤—Ä–µ–º–µ–Ω–∏',desc:'2 —á–∞—Å–∞ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞',price:25000,icon:'‚è∞',action:'timeWarp'}];

const STAR_ITEMS=[
{id:'s_megatap',n:'‚ö° –ú–µ–≥–∞ –¢–∞–ø',desc:'+10 –∫ —Ç–∞–ø—É –Ω–∞–≤—Å–µ–≥–¥–∞',stars:50,action:'megatap'},
{id:'s_energy',n:'üîã –ú–∞–∫—Å –≠–Ω–µ—Ä–≥–∏—è',desc:'+5000 —ç–Ω–µ—Ä–≥–∏–∏',stars:75,action:'maxenergy'},
{id:'s_bot',n:'ü§ñ –£–ª—å—Ç—Ä–∞-–±–æ—Ç',desc:'+50 –º–æ–Ω–µ—Ç/—Å–µ–∫',stars:100,action:'ultrabot'},
{id:'s_regen',n:'üåä –ú–µ–≥–∞ —Ä–µ–≥–µ–Ω',desc:'+20 —Ä–µ–≥–µ–Ω/—Å–µ–∫',stars:60,action:'megaregen'},
{id:'s_stars100',n:'‚≠ê 100 –∑–≤—ë–∑–¥',desc:'+100 –∏–≥—Ä–æ–≤—ã—Ö –∑–≤—ë–∑–¥',stars:30,action:'stars100'},
{id:'s_legendary',n:'üåü –õ–µ–≥–µ–Ω–¥–∞',desc:'+50 –∫ —Ç–∞–ø—É!',stars:150,action:'legendary'},
{id:'s_vip',n:'üëë VIP —Å—Ç–∞—Ç—É—Å',desc:'x2 –∫–æ –≤—Å–µ–º—É –Ω–∞–≤—Å–µ–≥–¥–∞',stars:200,action:'vip'}];

const PETS=[
{id:'cat',n:'–ö–æ—Ç',desc:'+2/—Å–µ–∫, +1 —Ç–∞–ø',price:5000,cps:2,tap:1,icon:'üê±'},
{id:'dog',n:'–ü—ë—Å',desc:'+3/—Å–µ–∫, +5% —É–¥–∞—á–∞',price:8000,cps:3,tap:0,icon:'üê∂'},
{id:'dragon',n:'–î—Ä–∞–∫–æ–Ω',desc:'+10/—Å–µ–∫, +3 —Ç–∞–ø',price:25000,cps:10,tap:3,icon:'üêâ'},
{id:'phoenix',n:'–§–µ–Ω–∏–∫—Å',desc:'+15/—Å–µ–∫, +5 —Ç–∞–ø',price:50000,cps:15,tap:5,icon:'üî•'},
{id:'unicorn',n:'–ï–¥–∏–Ω–æ—Ä–æ–≥',desc:'+25/—Å–µ–∫, +10 —Ç–∞–ø, +200üîã',price:100000,cps:25,tap:10,icon:'ü¶Ñ'},
{id:'alien',n:'–ò–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω',desc:'+50/—Å–µ–∫, +20 —Ç–∞–ø',price:250000,cps:50,tap:20,icon:'üëΩ'},
{id:'robot',n:'–£–ª—å—Ç—Ä–∞-–±–æ—Ç',desc:'+100/—Å–µ–∫, +50 —Ç–∞–ø',price:500000,cps:100,tap:50,icon:'ü§ñ'},
{id:'god',n:'–ë–æ–∂–µ—Å—Ç–≤–æ',desc:'+200/—Å–µ–∫, +100 —Ç–∞–ø',price:1000000,cps:200,tap:100,icon:'‚ö°'}];

const ARTIFACTS=[
{id:'crown',n:'–ö–æ—Ä–æ–Ω–∞',desc:'x1.5 XP',price:30000,icon:'üëë'},
{id:'ring',n:'–ö–æ–ª—å—Ü–æ —Å–∏–ª—ã',desc:'+20% –∫ —Ç–∞–ø—É',price:50000,icon:'üíç'},
{id:'amulet',n:'–ê–º—É–ª–µ—Ç —É–¥–∞—á–∏',desc:'+50% –∫ –Ω–∞–≥—Ä–∞–¥–∞–º',price:80000,icon:'üîÆ'},
{id:'sword',n:'–ú–µ—á –≥–µ—Ä–æ—è',desc:'+50% —É—Ä–æ–Ω –±–æ—Å—Å—É',price:60000,icon:'‚öîÔ∏è'},
{id:'book',n:'–ö–Ω–∏–≥–∞ –º—É–¥—Ä–æ—Å—Ç–∏',desc:'x2 XP',price:120000,icon:'üìñ'},
{id:'gem',n:'–ö–∞–º–µ–Ω—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏',desc:'+100% –∫–æ –≤—Å–µ–º—É',price:500000,icon:'üíé'},
{id:'clock',n:'–ß–∞—Å—ã –≤—Ä–µ–º–µ–Ω–∏',desc:'x2 –ø–∞—Å—Å–∏–≤',price:200000,icon:'‚è∞'},
{id:'heart',n:'–°–µ—Ä–¥—Ü–µ –¥—Ä–∞–∫–æ–Ω–∞',desc:'+500 —ç–Ω–µ—Ä–≥–∏–∏ +10/—Å–µ–∫',price:150000,icon:'‚ù§Ô∏è'}];

const SKINS=[
{id:'classic',n:'–ö–ª–∞—Å—Å–∏–∫–∞',price:0,tap:0,cps:0,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="url(#cg1)" stroke="#D4900A" stroke-width="4"/><circle cx="80" cy="80" r="58" fill="none" stroke="#FFF5CC" stroke-width="2" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="42" font-weight="900" fill="#8B6914">V</text>'},
{id:'ruby',n:'–†—É–±–∏–Ω',price:1000,tap:2,cps:0,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#e74c3c" stroke="#c0392b" stroke-width="4"/><polygon points="80,30 110,65 105,120 55,120 50,65" fill="#ff6b6b" opacity="0.6"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'sapphire',n:'–°–∞–ø—Ñ–∏—Ä',price:2000,tap:0,cps:3,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#2980b9" stroke="#1a5276" stroke-width="4"/><polygon points="80,25 115,60 110,125 50,125 45,60" fill="#74b9ff" opacity="0.5"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'emerald',n:'–ò–∑—É–º—Ä—É–¥',price:3000,tap:0,cps:0,regen:3,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#27ae60" stroke="#1e8449" stroke-width="4"/><polygon points="80,28 112,58 108,122 52,122 48,58" fill="#2ecc71" opacity="0.5"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'diamond',n:'–ê–ª–º–∞–∑',price:8000,tap:5,cps:2,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#5dade2" stroke="#2e86c1" stroke-width="4"/><polygon points="80,20 120,55 115,130 45,130 40,55" fill="#aed6f1" opacity="0.6"/><polygon points="80,35 105,60 100,115 60,115 55,60" fill="#d6eaf8" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#1a5276">V</text>'},
{id:'fire',n:'–û–≥–æ–Ω—å',price:5000,tap:3,cps:0,regen:2,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#e67e22" stroke="#d35400" stroke-width="4"/><ellipse cx="80" cy="75" rx="30" ry="45" fill="#f39c12" opacity="0.6"/><ellipse cx="80" cy="65" rx="18" ry="30" fill="#f1c40f" opacity="0.7"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'ice',n:'–õ—ë–¥',price:5000,tap:0,cps:0,regen:0,energy:300,svg:'<circle cx="80" cy="80" r="72" fill="#00cec9" stroke="#0984e3" stroke-width="4"/><polygon points="80,25 100,50 100,110 60,110 60,50" fill="#dfe6e9" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'galaxy',n:'–ì–∞–ª–∞–∫—Ç–∏–∫–∞',price:15000,tap:5,cps:5,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#2d3436" stroke="#6c5ce7" stroke-width="4"/><circle cx="60" cy="50" r="3" fill="#fff" opacity="0.8"/><circle cx="100" cy="40" r="2" fill="#fff" opacity="0.6"/><circle cx="90" cy="100" r="2.5" fill="#fff" opacity="0.7"/><circle cx="45" cy="90" r="2" fill="#fff" opacity="0.5"/><circle cx="110" cy="70" r="1.5" fill="#fff" opacity="0.6"/><ellipse cx="80" cy="80" rx="50" ry="15" fill="none" stroke="#a29bfe" stroke-width="2" opacity="0.4" transform="rotate(-20,80,80)"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#a29bfe">V</text>'},
{id:'toxic',n:'–¢–æ–∫—Å–∏–∫',price:10000,tap:8,cps:0,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#1e272e" stroke="#A3CB38" stroke-width="4"/><circle cx="80" cy="80" r="40" fill="#A3CB38" opacity="0.15"/><circle cx="65" cy="70" r="6" fill="#A3CB38" opacity="0.3"/><circle cx="95" cy="65" r="4" fill="#A3CB38" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#A3CB38">V</text>'},
{id:'skull',n:'–ß–µ—Ä–µ–ø',price:20000,tap:5,cps:5,regen:0,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#2d3436" stroke="#dfe6e9" stroke-width="4"/><ellipse cx="80" cy="65" rx="28" ry="30" fill="#dfe6e9" opacity="0.9"/><circle cx="70" cy="60" r="7" fill="#2d3436"/><circle cx="90" cy="60" r="7" fill="#2d3436"/><rect x="72" y="78" width="4" height="8" rx="1" fill="#2d3436"/><rect x="80" y="78" width="4" height="8" rx="1" fill="#2d3436"/><rect x="88" y="78" width="4" height="8" rx="1" fill="#2d3436"/><text x="80" y="120" text-anchor="middle" font-size="20" font-weight="900" fill="#dfe6e9">V</text>'},
{id:'rainbow',n:'–†–∞–¥—É–≥–∞',price:25000,tap:4,cps:4,regen:2,energy:100,svg:'<circle cx="80" cy="80" r="72" fill="#6c5ce7" stroke="#fd79a8" stroke-width="4"/><circle cx="80" cy="80" r="60" fill="none" stroke="#f39c12" stroke-width="3" opacity="0.4"/><circle cx="80" cy="80" r="48" fill="none" stroke="#e74c3c" stroke-width="3" opacity="0.3"/><circle cx="80" cy="80" r="36" fill="none" stroke="#2ecc71" stroke-width="3" opacity="0.3"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fff">V</text>'},
{id:'neon',n:'–ù–µ–æ–Ω',price:30000,tap:0,cps:12,regen:3,energy:0,svg:'<circle cx="80" cy="80" r="72" fill="#0a0a1a" stroke="#00ff88" stroke-width="3"/><circle cx="80" cy="80" r="60" fill="none" stroke="#00ff88" stroke-width="1" opacity="0.3"/><circle cx="80" cy="80" r="48" fill="none" stroke="#00ffff" stroke-width="1" opacity="0.2"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#00ff88">V</text>'},
{id:'golden',n:'–ó–æ–ª–æ—Ç–æ–π',price:50000,tap:10,cps:8,regen:3,energy:500,svg:'<circle cx="80" cy="80" r="72" fill="#f39c12" stroke="#e67e22" stroke-width="5"/><circle cx="80" cy="80" r="60" fill="none" stroke="#ffeaa7" stroke-width="2" opacity="0.5"/><circle cx="80" cy="80" r="48" fill="none" stroke="#ffeaa7" stroke-width="1" opacity="0.3"/><text x="80" y="95" text-anchor="middle" font-size="42" font-weight="900" fill="#fff">V</text>'},
{id:'abyss',n:'–ë–µ–∑–¥–Ω–∞',price:100000,tap:15,cps:15,regen:5,energy:1000,svg:'<circle cx="80" cy="80" r="72" fill="#0c0c1d" stroke="#8e44ad" stroke-width="4"/><circle cx="80" cy="80" r="50" fill="none" stroke="#9b59b6" stroke-width="2" opacity="0.3"/><circle cx="80" cy="80" r="30" fill="#8e44ad" opacity="0.15"/><circle cx="60" cy="55" r="2" fill="#e8daef" opacity="0.6"/><circle cx="100" cy="60" r="1.5" fill="#e8daef" opacity="0.5"/><circle cx="75" cy="105" r="1.5" fill="#e8daef" opacity="0.4"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#d2b4de">V</text>'},
{id:'plasma',n:'–ü–ª–∞–∑–º–∞',price:150000,tap:20,cps:20,regen:8,energy:1500,svg:'<circle cx="80" cy="80" r="72" fill="#1a0a2e" stroke="#e056fd" stroke-width="4"/><ellipse cx="80" cy="80" rx="45" ry="25" fill="none" stroke="#e056fd" stroke-width="2" opacity="0.4" transform="rotate(30,80,80)"/><ellipse cx="80" cy="80" rx="45" ry="25" fill="none" stroke="#be2edd" stroke-width="2" opacity="0.3" transform="rotate(-30,80,80)"/><circle cx="80" cy="80" r="20" fill="#e056fd" opacity="0.2"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#e056fd">V</text>'},
{id:'cosmic',n:'–ö–æ—Å–º–æ—Å',price:200000,tap:25,cps:25,regen:10,energy:2000,svg:'<defs><radialGradient id="cosmicG"><stop offset="0%" stop-color="#1a0533"/><stop offset="100%" stop-color="#0a0a1a"/></radialGradient></defs><circle cx="80" cy="80" r="72" fill="url(#cosmicG)" stroke="#fd79a8" stroke-width="4"/><circle cx="50" cy="45" r="2" fill="#fff"/><circle cx="110" cy="55" r="1.5" fill="#ffd700"/><circle cx="70" cy="110" r="1" fill="#74b9ff"/><circle cx="100" cy="100" r="2" fill="#a29bfe"/><circle cx="40" cy="80" r="1" fill="#ff6b6b"/><circle cx="95" cy="35" r="1.5" fill="#81ecec"/><ellipse cx="80" cy="80" rx="55" ry="20" fill="none" stroke="rgba(253,121,168,0.3)" stroke-width="1" transform="rotate(15,80,80)"/><text x="80" y="95" text-anchor="middle" font-size="36" font-weight="900" fill="#fd79a8">V</text>'}];

const ACHIEVEMENTS=[
{id:'tap10',n:'–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏',d:'–°–¥–µ–ª–∞–π 10 —Ç–∞–ø–æ–≤',icon:'üëÜ',req:()=>S.totalTaps>=10,prog:()=>Math.min(S.totalTaps/10,1),reward:50},
{id:'tap100',n:'–ê–∫—Ç–∏–≤–∏—Å—Ç',d:'100 —Ç–∞–ø–æ–≤',icon:'‚úåÔ∏è',req:()=>S.totalTaps>=100,prog:()=>Math.min(S.totalTaps/100,1),reward:200},
{id:'tap500',n:'–¢–∞–ø–æ–º–∞–Ω–∏—è',d:'500 —Ç–∞–ø–æ–≤',icon:'üñêÔ∏è',req:()=>S.totalTaps>=500,prog:()=>Math.min(S.totalTaps/500,1),reward:500},
{id:'tap1k',n:'–¢—ã—Å—è—á–Ω–∏–∫',d:'1,000 —Ç–∞–ø–æ–≤',icon:'üí™',req:()=>S.totalTaps>=1000,prog:()=>Math.min(S.totalTaps/1000,1),reward:1000},
{id:'tap5k',n:'–ú–∞—Å—Ç–µ—Ä —Ç–∞–ø–∞',d:'5,000 —Ç–∞–ø–æ–≤',icon:'üî•',req:()=>S.totalTaps>=5000,prog:()=>Math.min(S.totalTaps/5000,1),reward:3000},
{id:'tap10k',n:'–ù–µ—É–¥–µ—Ä–∂–∏–º—ã–π',d:'10,000 —Ç–∞–ø–æ–≤',icon:'‚ö°',req:()=>S.totalTaps>=10000,prog:()=>Math.min(S.totalTaps/10000,1),reward:5000},
{id:'tap50k',n:'–õ–µ–≥–µ–Ω–¥–∞ —Ç–∞–ø–∞',d:'50,000 —Ç–∞–ø–æ–≤',icon:'üåü',req:()=>S.totalTaps>=50000,prog:()=>Math.min(S.totalTaps/50000,1),reward:15000},
{id:'tap100k',n:'–ë–æ–≥ —Ç–∞–ø–∞',d:'100,000 —Ç–∞–ø–æ–≤',icon:'üëë',req:()=>S.totalTaps>=100000,prog:()=>Math.min(S.totalTaps/100000,1),reward:30000},
{id:'tap500k',n:'–ó–∞–ø—Ä–µ–¥–µ–ª—å–Ω—ã–π',d:'500,000 —Ç–∞–ø–æ–≤',icon:'üíé',req:()=>S.totalTaps>=500000,prog:()=>Math.min(S.totalTaps/500000,1),reward:80000},
{id:'tap1m',n:'–ú–∏–ª–ª–∏–æ–Ω–µ—Ä —Ç–∞–ø–æ–≤',d:'1,000,000 —Ç–∞–ø–æ–≤',icon:'üèÜ',req:()=>S.totalTaps>=1000000,prog:()=>Math.min(S.totalTaps/1000000,1),reward:200000},
{id:'earn1k',n:'–ü–µ—Ä–≤—ã–µ –¥–µ–Ω—å–≥–∏',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1K',icon:'üí∞',req:()=>S.totalEarned>=1000,prog:()=>Math.min(S.totalEarned/1000,1),reward:100},
{id:'earn10k',n:'–ë–æ–≥–∞—Ç–µ–Ω—å–∫–∏–π',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10K',icon:'üí∞',req:()=>S.totalEarned>=10000,prog:()=>Math.min(S.totalEarned/10000,1),reward:500},
{id:'earn100k',n:'–ë–æ–≥–∞—á',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 100K',icon:'üí∞',req:()=>S.totalEarned>=100000,prog:()=>Math.min(S.totalEarned/100000,1),reward:2000},
{id:'earn1m',n:'–ú–∏–ª–ª–∏–æ–Ω–µ—Ä',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1M',icon:'üí∞',req:()=>S.totalEarned>=1000000,prog:()=>Math.min(S.totalEarned/1000000,1),reward:10000},
{id:'earn10m',n:'–ú—É–ª—å—Ç–∏–º–∏–ª–ª–∏–æ–Ω–µ—Ä',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10M',icon:'üí∞',req:()=>S.totalEarned>=10000000,prog:()=>Math.min(S.totalEarned/10000000,1),reward:50000},
{id:'earn100m',n:'–û–ª–∏–≥–∞—Ä—Ö',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 100M',icon:'üí∞',req:()=>S.totalEarned>=100000000,prog:()=>Math.min(S.totalEarned/100000000,1),reward:200000},
{id:'earn1b',n:'–ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä',d:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 1B',icon:'üí∞',req:()=>S.totalEarned>=1000000000,prog:()=>Math.min(S.totalEarned/1000000000,1),reward:1000000},
{id:'combo5',n:'–ö–æ–º–±–æ!',d:'–ö–æ–º–±–æ x5',icon:'üî•',req:()=>S.comboMulti>=5,prog:()=>Math.min(S.comboMulti/5,1),reward:300},
{id:'combo10',n:'–ú–µ–≥–∞ –∫–æ–º–±–æ',d:'–ö–æ–º–±–æ x10',icon:'üî•',req:()=>S.comboMulti>=10,prog:()=>Math.min(S.comboMulti/10,1),reward:1000},
{id:'combo20',n:'–£–ª—å—Ç—Ä–∞ –∫–æ–º–±–æ',d:'–ö–æ–º–±–æ x20',icon:'üî•',req:()=>S.comboMulti>=20,prog:()=>Math.min(S.comboMulti/20,1),reward:5000},
{id:'boss1',n:'–û—Ö–æ—Ç–Ω–∏–∫',d:'–£–±–µ–π 1 –±–æ—Å—Å–∞',icon:'üëπ',req:()=>S.bossesKilled>=1,prog:()=>Math.min(S.bossesKilled/1,1),reward:500},
{id:'boss5',n:'–ò—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å',d:'–£–±–µ–π 5 –±–æ—Å—Å–æ–≤',icon:'üëπ',req:()=>S.bossesKilled>=5,prog:()=>Math.min(S.bossesKilled/5,1),reward:3000},
{id:'boss20',n:'–£–±–∏–π—Ü–∞ –±–æ—Å—Å–æ–≤',d:'–£–±–µ–π 20 –±–æ—Å—Å–æ–≤',icon:'üëπ',req:()=>S.bossesKilled>=20,prog:()=>Math.min(S.bossesKilled/20,1),reward:15000},
{id:'boss50',n:'–õ–µ–≥–µ–Ω–¥–∞ –∞—Ä–µ–Ω—ã',d:'–£–±–µ–π 50 –±–æ—Å—Å–æ–≤',icon:'üëπ',req:()=>S.bossesKilled>=50,prog:()=>Math.min(S.bossesKilled/50,1),reward:50000},
{id:'duel1',n:'–î—É—ç–ª—è–Ω—Ç',d:'–í—ã–∏–≥—Ä–∞–π 1 –¥—É—ç–ª—å',icon:'‚öîÔ∏è',req:()=>S.duelsWon>=1,prog:()=>Math.min(S.duelsWon/1,1),reward:500},
{id:'duel10',n:'–ë–æ–µ—Ü',d:'–í—ã–∏–≥—Ä–∞–π 10 –¥—É—ç–ª–µ–π',icon:'‚öîÔ∏è',req:()=>S.duelsWon>=10,prog:()=>Math.min(S.duelsWon/10,1),reward:5000},
{id:'duel50',n:'–ß–µ–º–ø–∏–æ–Ω –¥—É—ç–ª–µ–π',d:'–í—ã–∏–≥—Ä–∞–π 50 –¥—É—ç–ª–µ–π',icon:'‚öîÔ∏è',req:()=>S.duelsWon>=50,prog:()=>Math.min(S.duelsWon/50,1),reward:25000},
{id:'skin3',n:'–ú–æ–¥–Ω–∏–∫',d:'–ö—É–ø–∏ 3 —Å–∫–∏–Ω–∞',icon:'üé®',req:()=>S.ownedSkins.length>=3,prog:()=>Math.min(S.ownedSkins.length/3,1),reward:500},
{id:'skin8',n:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä',d:'–ö—É–ø–∏ 8 —Å–∫–∏–Ω–æ–≤',icon:'üé®',req:()=>S.ownedSkins.length>=8,prog:()=>Math.min(S.ownedSkins.length/8,1),reward:5000},
{id:'skin_all',n:'–ü–æ–ª–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è',d:'–í—Å–µ —Å–∫–∏–Ω—ã',icon:'üé®',req:()=>S.ownedSkins.length>=SKINS.length,prog:()=>Math.min(S.ownedSkins.length/SKINS.length,1),reward:50000},
{id:'lvl5',n:'–†–∞—Å—Ç—ë—à—å',d:'–î–æ—Å—Ç–∏–≥–Ω–∏ 5 —É—Ä–æ–≤–Ω—è',icon:'üìà',req:()=>S.level>=5,prog:()=>Math.min(S.level/5,1),reward:1000},
{id:'lvl10',n:'–î–µ—Å—è—Ç–∫–∞',d:'–î–æ—Å—Ç–∏–≥–Ω–∏ 10 —É—Ä–æ–≤–Ω—è',icon:'üìà',req:()=>S.level>=10,prog:()=>Math.min(S.level/10,1),reward:10000},
{id:'lvl15',n:'–¢–æ–ø –∏–≥—Ä–æ–∫',d:'–î–æ—Å—Ç–∏–≥–Ω–∏ 15 —É—Ä–æ–≤–Ω—è',icon:'üìà',req:()=>S.level>=15,prog:()=>Math.min(S.level/15,1),reward:50000},
{id:'daily3',n:'–ü–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ',d:'3 –¥–Ω—è –ø–æ–¥—Ä—è–¥',icon:'üìÖ',req:()=>S.dailyStreak>=3,prog:()=>Math.min(S.dailyStreak/3,1),reward:500},
{id:'daily7',n:'–ù–µ–¥–µ–ª—å–∫–∞',d:'7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',icon:'üìÖ',req:()=>S.dailyStreak>=7,prog:()=>Math.min(S.dailyStreak/7,1),reward:3000},
{id:'daily30',n:'–ú–µ—Å—è—Ü!',d:'30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',icon:'üìÖ',req:()=>S.dailyStreak>=30,prog:()=>Math.min(S.dailyStreak/30,1),reward:30000},
{id:'star10',n:'–ó–≤–µ–∑–¥–æ—á—ë—Ç',d:'10 –∏–≥—Ä–æ–≤—ã—Ö –∑–≤—ë–∑–¥',icon:'‚≠ê',req:()=>S.stars>=10,prog:()=>Math.min(S.stars/10,1),reward:1000},
{id:'star50',n:'–ó–≤—ë–∑–¥–Ω—ã–π –ø—É—Ç—å',d:'50 –∏–≥—Ä–æ–≤—ã—Ö –∑–≤—ë–∑–¥',icon:'‚≠ê',req:()=>S.stars>=50,prog:()=>Math.min(S.stars/50,1),reward:5000},
{id:'star200',n:'–ì–∞–ª–∞–∫—Ç–∏–∫–∞',d:'200 –∏–≥—Ä–æ–≤—ã—Ö –∑–≤—ë–∑–¥',icon:'‚≠ê',req:()=>S.stars>=200,prog:()=>Math.min(S.stars/200,1),reward:20000},
{id:'pet1',n:'–î—Ä—É–≥',d:'–ö—É–ø–∏ –ø–µ—Ä–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞',icon:'üêæ',req:()=>Object.keys(S.pets).length>=1,prog:()=>Math.min(Object.keys(S.pets).length,1),reward:1000},
{id:'pet4',n:'–ó–æ–æ–ø–∞—Ä–∫',d:'–ö—É–ø–∏ 4 –ø–∏—Ç–æ–º—Ü–∞',icon:'üêæ',req:()=>Object.keys(S.pets).length>=4,prog:()=>Math.min(Object.keys(S.pets).length/4,1),reward:10000},
{id:'pet_all',n:'–í—Å–µ –ø–∏—Ç–æ–º—Ü—ã',d:'–í—Å–µ –ø–∏—Ç–æ–º—Ü—ã',icon:'üêæ',req:()=>Object.keys(S.pets).length>=PETS.length,prog:()=>Math.min(Object.keys(S.pets).length/PETS.length,1),reward:50000},
{id:'art1',n:'–ê—Ä—Ö–µ–æ–ª–æ–≥',d:'–ö—É–ø–∏ 1 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç',icon:'üîÆ',req:()=>Object.keys(S.artifacts).length>=1,prog:()=>Math.min(Object.keys(S.artifacts).length,1),reward:2000},
{id:'art4',n:'–°–æ–±–∏—Ä–∞—Ç–µ–ª—å',d:'4 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞',icon:'üîÆ',req:()=>Object.keys(S.artifacts).length>=4,prog:()=>Math.min(Object.keys(S.artifacts).length/4,1),reward:15000},
{id:'art_all',n:'–í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã',d:'–í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã',icon:'üîÆ',req:()=>Object.keys(S.artifacts).length>=ARTIFACTS.length,prog:()=>Math.min(Object.keys(S.artifacts).length/ARTIFACTS.length,1),reward:100000},
{id:'world2',n:'–õ—É–Ω–∞—Ç–∏–∫',d:'–û—Ç–∫—Ä–æ–π –õ—É–Ω—É',icon:'üåô',req:()=>S.world>=1,prog:()=>Math.min(S.world,1),reward:1000},
{id:'world4',n:'–ö–æ—Å–º–æ–Ω–∞–≤—Ç',d:'–û—Ç–∫—Ä–æ–π –Æ–ø–∏—Ç–µ—Ä',icon:'ü™ê',req:()=>S.world>=3,prog:()=>Math.min(S.world/3,1),reward:15000},
{id:'world6',n:'–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',d:'–û—Ç–∫—Ä–æ–π –ì–∞–ª–∞–∫—Ç–∏–∫—É',icon:'üåå',req:()=>S.world>=5,prog:()=>Math.min(S.world/5,1),reward:100000},
{id:'energy5k',n:'–≠–Ω–µ—Ä–¥–∂–∞–π–∑–µ—Ä',d:'5000 –º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏–∏',icon:'üîã',req:()=>S.maxEnergy>=5000,prog:()=>Math.min(S.maxEnergy/5000,1),reward:3000},
{id:'cps50',n:'–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥',d:'50 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü§ñ',req:()=>calcCPS()>=50,prog:()=>Math.min(calcCPS()/50,1),reward:5000},
{id:'cps500',n:'–ú–µ–≥–∞ –ø–∞—Å—Å–∏–≤',d:'500 –º–æ–Ω–µ—Ç/—Å–µ–∫',icon:'ü§ñ',req:()=>calcCPS()>=500,prog:()=>Math.min(calcCPS()/500,1),reward:50000},
{id:'pertap50',n:'–ú–æ—â–Ω—ã–π —É–¥–∞—Ä',d:'+50 –∫ —Ç–∞–ø—É',icon:'üí™',req:()=>calcPerTap()>=50,prog:()=>Math.min(calcPerTap()/50,1),reward:5000},
{id:'pertap200',n:'–†–∞–∑—Ä—É—à–∏—Ç–µ–ª—å',d:'+200 –∫ —Ç–∞–ø—É',icon:'üí™',req:()=>calcPerTap()>=200,prog:()=>Math.min(calcPerTap()/200,1),reward:25000},
{id:'up10',n:'–®–æ–ø–æ–≥–æ–ª–∏–∫',d:'10 –ø–æ–∫—É–ø–æ–∫',icon:'üõí',req:()=>totalUpgrades()>=10,prog:()=>Math.min(totalUpgrades()/10,1),reward:1000},
{id:'up50',n:'–ú–∞–≥–Ω–∞—Ç',d:'50 –ø–æ–∫—É–ø–æ–∫',icon:'üõí',req:()=>totalUpgrades()>=50,prog:()=>Math.min(totalUpgrades()/50,1),reward:10000},
{id:'code1',n:'–•–∞–∫–µ—Ä',d:'–ò—Å–ø–æ–ª—å–∑—É–π 1 –∫–æ–¥',icon:'üîë',req:()=>S.usedCodes.length>=1,prog:()=>Math.min(S.usedCodes.length,1),reward:500},
{id:'code5',n:'–ö–æ–¥–µ—Ä',d:'5 –∫–æ–¥–æ–≤',icon:'üîë',req:()=>S.usedCodes.length>=5,prog:()=>Math.min(S.usedCodes.length/5,1),reward:3000},
{id:'golden5',n:'–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞',d:'–ü–æ–π–º–∞–π 5 –∑–æ–ª–æ—Ç—ã—Ö',icon:'üåü',req:()=>(S.goldenCaught||0)>=5,prog:()=>Math.min((S.goldenCaught||0)/5,1),reward:2000},
{id:'golden20',n:'–ó–æ–ª–æ—Ç–æ–π –º–∞–≥–Ω–∞—Ç',d:'20 –∑–æ–ª–æ—Ç—ã—Ö',icon:'üåü',req:()=>(S.goldenCaught||0)>=20,prog:()=>Math.min((S.goldenCaught||0)/20,1),reward:10000},
{id:'lucky1',n:'–í–µ–∑—É–Ω—á–∏–∫',d:'–í—ã–∏–≥—Ä–∞–π —Ä—É–ª–µ—Ç–∫—É',icon:'üé∞',req:()=>(S.rouletteWins||0)>=1,prog:()=>Math.min((S.rouletteWins||0),1),reward:500},
{id:'lucky10',n:'–†—É–ª–µ—Ç–∫–∞ –º–∞—Å—Ç–µ—Ä',d:'10 —Ä—É–ª–µ—Ç–æ–∫',icon:'üé∞',req:()=>(S.rouletteWins||0)>=10,prog:()=>Math.min((S.rouletteWins||0)/10,1),reward:5000}
];

const SECRET_CODES=[
{code:'VRISKAS2024',reward:{coins:5000,stars:5},once:true},
{code:'FREESTARS',reward:{stars:10},once:true},
{code:'MEGABOOST',reward:{coins:10000},once:true},
{code:'CLICKERGOD',reward:{coins:50000,stars:20},once:true},
{code:'ENERGY9999',reward:{coins:3000},once:true},
{code:'LUCKY777',reward:{coins:7777,stars:7},once:true},
{code:'BOSS',reward:{coins:5000},once:true,action:'spawnBoss'},
{code:'GOLDRUSH',reward:{coins:25000},once:true},
{code:'STARFALL',reward:{stars:30},once:true},
{code:'SPEEDRUN',reward:{coins:15000,stars:10},once:true}
];

const BOSSES=[
{n:'–°–ª–∞–π–º',hp:200,reward:500,stars:1},{n:'–ì–æ–±–ª–∏–Ω',hp:500,reward:1500,stars:2},
{n:'–û—Ä–∫',hp:1200,reward:4000,stars:3},{n:'–î—Ä–∞–∫–æ–Ω',hp:3000,reward:10000,stars:5},
{n:'–î–µ–º–æ–Ω',hp:8000,reward:30000,stars:8},{n:'–¢–∏—Ç–∞–Ω',hp:20000,reward:80000,stars:12},
{n:'–ê—Ä—Ö–∏–¥–µ–º–æ–Ω',hp:50000,reward:200000,stars:18},{n:'–õ–µ–≤–∏–∞—Ñ–∞–Ω',hp:120000,reward:500000,stars:25},
{n:'–ë–æ–≥ –•–∞–æ—Å–∞',hp:300000,reward:1200000,stars:35},{n:'–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –ë–µ–∑–¥–Ω—ã',hp:1000000,reward:5000000,stars:50}];

// Temps
let x2Active=false,megaComboLeft=0,eventActive=null,eventTimer=0;
let bossState=null,duelState=null,goldenTimer=null;
let pollingInterval=null;
let banCheckInterval=null;
let vipMode=false;

function calcPerTap(){
let t=S.perTap;
let skin=SKINS.find(s=>s.id===S.skinId);
if(skin)t+=skin.tap;
let pet=PETS.find(p=>p.id===S.activePet);
if(pet&&S.pets[pet.id])t+=pet.tap;
if(S.artifacts.ring)t=Math.floor(t*1.2);
if(S.artifacts.gem)t=Math.floor(t*2);
if(vipMode)t*=2;
return Math.floor(t);
}
function calcCPS(){
let c=S.cps;
let skin=SKINS.find(s=>s.id===S.skinId);
if(skin)c+=skin.cps;
let pet=PETS.find(p=>p.id===S.activePet);
if(pet&&S.pets[pet.id])c+=pet.cps;
if(S.artifacts.clock)c*=2;
if(S.artifacts.gem)c*=2;
if(vipMode)c*=2;
return Math.floor(c);
}
function calcMaxEnergy(){
let e=S.maxEnergy;
let skin=SKINS.find(s=>s.id===S.skinId);
if(skin)e+=skin.energy;
let pet=PETS.find(p=>p.id===S.activePet&&p.id==='unicorn');
if(pet&&S.pets[pet.id])e+=200;
if(S.artifacts.heart)e+=500;
return e;
}
function calcRegen(){
let r=S.energyRegen;
let skin=SKINS.find(s=>s.id===S.skinId);
if(skin)r+=skin.regen;
if(S.artifacts.heart)r+=10;
return r;
}
function totalUpgrades(){return Object.values(S.upgrades).reduce((a,b)=>a+b,0)}
function getLuck(){let l=1;if((S.upgrades.luck||0)>0)l+=0.2*(S.upgrades.luck||0);if(S.artifacts.amulet)l+=0.5;return l}
function hasCrit(){return(S.upgrades.crit||0)>0}
function getComboDecay(){return 2500+(S.upgrades.combo||0)*500}

function fmt(n){
if(n>=1e9)return(n/1e9).toFixed(1)+'B';
if(n>=1e6)return(n/1e6).toFixed(1)+'M';
if(n>=1e3)return(n/1e3).toFixed(1)+'K';
return Math.floor(n).toString();
}

// ANTI-CHEAT
function antiCheat(){
const limits={coins:50e9,totalEarned:50e9,totalTaps:100e6,perTap:100000,cps:50000,stars:10000,maxEnergy:100000};
for(let k in limits){
if((S[k]||0)>limits[k]){
S={coins:0,totalEarned:0,totalTaps:0,perTap:1,cps:0,energy:1000,maxEnergy:1000,energyRegen:1,xp:0,level:1,upgrades:{},skinId:'classic',ownedSkins:['classic'],achievements:[],dailyStreak:0,lastDaily:0,usedCodes:[],bossesKilled:0,duelsWon:0,duelsLost:0,stars:0,pets:{},activePet:null,artifacts:{},world:0,comboCount:0,comboTimer:0,comboMulti:1,lastSave:0,lastOnline:Date.now(),quests:{date:'',list:[]},rouletteTime:0,goldenCaught:0,rouletteWins:0,settings:S.settings||{}};
save();
if(db&&tgUser)db.ref('vriskas_clicker/'+tgUser.id).remove();
document.getElementById('cheat-screen').style.display='flex';
return true;
}
}
return false;
}

// SAVE/LOAD
function save(){
S.lastSave=Date.now();
S.lastOnline=Date.now();
localStorage.setItem(SAVE_KEY,JSON.stringify(S));
}
function load(){
// migrate
for(let i=15;i<25;i++){
let old=localStorage.getItem('vriskas_v'+i);
if(old&&i<25){localStorage.setItem(SAVE_KEY,old);localStorage.removeItem('vriskas_v'+i);}
}
let d=localStorage.getItem(SAVE_KEY);
if(d){
try{
let p=JSON.parse(d);
for(let k in p)if(k in S)S[k]=p[k];
// offline earnings
let offline=Math.min((Date.now()-S.lastOnline)/1000,14400);
if(offline>10){
let earned=Math.floor(calcCPS()*offline);
if(earned>0){S.coins+=earned;S.totalEarned+=earned;toast('üí∞ –û—Ñ–ª–∞–π–Ω: +'+fmt(earned)+' –º–æ–Ω–µ—Ç');}
}
}catch(e){}
}
}

// CLOUD
function syncToCloud(){
if(!db||!tgUser)return;
let ref=db.ref('vriskas_clicker/'+tgUser.id);
ref.once('value').then(snap=>{
let d=snap.val();
if(d&&d.banned){
document.getElementById('banned-screen').style.display='flex';
return;
}
if(d&&d.adminForceUpdate){
// admin changed data - apply
if(d.coins!==undefined)S.coins=d.coins;
if(d.totalEarned!==undefined)S.totalEarned=d.totalEarned;
if(d.totalTaps!==undefined)S.totalTaps=d.totalTaps;
if(d.stars!==undefined)S.stars=d.stars;
ref.update({adminForceUpdate:null});
save();
updateUI();
}
ref.update({
name:tgUser.first_name||'–ò–≥—Ä–æ–∫',
username:tgUser.username||'',
photo:tgUser.photo_url||'',
coins:S.coins,totalEarned:S.totalEarned,totalTaps:S.totalTaps,
level:S.level,stars:S.stars,
perTap:calcPerTap(),cps:calcCPS(),
bossesKilled:S.bossesKilled,duelsWon:S.duelsWon,
lastOnline:Date.now()
});
}).catch(()=>{});
}

function checkBan(){
if(!db||!tgUser)return;
db.ref('vriskas_clicker/'+tgUser.id).once('value').then(snap=>{
let d=snap.val();
if(d&&d.banned){
document.getElementById('banned-screen').style.display='flex';
}
if(d&&d.adminForceUpdate){
if(d.coins!==undefined)S.coins=d.coins;
if(d.totalEarned!==undefined)S.totalEarned=d.totalEarned;
if(d.totalTaps!==undefined)S.totalTaps=d.totalTaps;
if(d.stars!==undefined)S.stars=d.stars;
db.ref('vriskas_clicker/'+tgUser.id).update({adminForceUpdate:null});
save();updateUI();
toast('üì° –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
}
}).catch(()=>{});
}

// TABS
const pageIds=['page-clicker','page-shop','page-skins','page-ach','page-quests','page-battle','page-lb','page-profile'];
function switchTab(i,btn){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.getElementById(pageIds[i]).classList.add('active');
document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
if(tg&&S.settings.haptic)try{tg.HapticFeedback.selectionChanged();}catch(e){}
if(i===6)loadLB(0);
if(i===7)renderProfile();
if(i===3)renderAchievements();
if(i===4){renderQuests();renderWorlds();}
}

// CLICK
let lastClickTime=0;
function doClick(e){
e.preventDefault();
if(S.energy<1)return;
let now=Date.now();
let tap=calcPerTap();
let worldMult=WORLDS[S.world].mult;
let isCrit=hasCrit()&&Math.random()<0.15;
let amount=Math.floor(tap*worldMult*S.comboMulti*(x2Active?2:1)*(isCrit?5:1));
if(megaComboLeft>0){amount*=50;megaComboLeft--;}
if(eventActive==='diamond')amount*=5;
if(eventActive==='golden_hour')amount*=3;
S.coins+=amount;
S.totalEarned+=amount;
S.totalTaps++;
S.energy=Math.max(0,S.energy-1);
// XP
let xpGain=Math.max(1,Math.floor(tap/2));
if(S.artifacts.crown)xpGain=Math.floor(xpGain*1.5);
if(S.artifacts.book)xpGain*=2;
S.xp+=xpGain;
checkLevelUp();
// Combo
S.comboCount++;
S.comboTimer=now;
if(now-lastClickTime<400){
if(S.comboCount%5===0&&S.comboMulti<50)S.comboMulti=Math.min(50,S.comboMulti+1);
}else{S.comboCount=1;}
lastClickTime=now;
// Float text
let txt='+'+fmt(amount);
if(isCrit)txt='üí• –ö–†–ò–¢ '+txt;
floatText(e,txt,isCrit);
// Animation
let btn=document.getElementById('coin-btn');
btn.style.transform='scale(0.88)';
setTimeout(()=>btn.style.transform='',80);
if(tg&&S.settings.haptic)try{tg.HapticFeedback.impactOccurred('light');}catch(e){}
// Combo badge
let cb=document.getElementById('combo-badge');
if(S.comboMulti>1){cb.style.display='block';cb.textContent='x'+S.comboMulti;}else{cb.style.display='none';}
// Random events
if(S.totalTaps%150===0&&Math.random()<0.3)spawnGolden();
if(S.totalTaps%200===0&&Math.random()<0.2)triggerEvent();
if(S.totalTaps%300===0&&Math.random()<0.25)luckBlock();
// Quest progress
updateQuestProgress('taps',1);
updateQuestProgress('earn',amount);
// Save periodically
if(S.totalTaps%15===0)save();
if(S.totalTaps%50===0)syncToCloud();
updateUI();
}

function floatText(e,txt,isCrit){
let el=document.createElement('div');
el.className='float-text';
el.textContent=txt;
if(isCrit)el.style.color='#ff6b6b';
let rect=e.target.getBoundingClientRect();
el.style.left=(rect.left+rect.width/2-20)+'px';
el.style.top=(rect.top-10)+'px';
document.body.appendChild(el);
setTimeout(()=>el.remove(),1000);
}

// BOSS
function startBoss(elite){
let idx=Math.min(S.bossesKilled,BOSSES.length-1);
let boss=BOSSES[idx];
let mult=elite?3:1;
bossState={name:boss.n,hp:boss.hp*mult,maxHp:boss.hp*mult,reward:boss.reward*mult,stars:boss.stars*mult,time:30,elite:!!elite};
document.getElementById('boss-overlay').classList.add('show');
document.getElementById('boss-name').textContent=(elite?'‚ö° –≠–õ–ò–¢–ù–´–ô ':'')+'üëπ '+boss.n;
updateBossUI();
bossState.interval=setInterval(()=>{
bossState.time--;
if(bossState.time<=0){clearInterval(bossState.interval);document.getElementById('boss-overlay').classList.remove('show');toast('‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ! –ë–æ—Å—Å —Å–±–µ–∂–∞–ª');bossState=null;}
updateBossUI();
},1000);
}
function hitBoss(){
if(!bossState)return;
let dmg=calcPerTap();
if(S.artifacts.sword)dmg=Math.floor(dmg*1.5);
bossState.hp-=dmg;
if(tg&&S.settings.haptic)try{tg.HapticFeedback.impactOccurred('medium');}catch(e){}
let btn=document.getElementById('boss-btn');
btn.classList.add('boss-shake');
setTimeout(()=>btn.classList.remove('boss-shake'),150);
if(bossState.hp<=0){
clearInterval(bossState.interval);
let reward=Math.floor(bossState.reward*getLuck());
let stars=bossState.stars;
S.coins+=reward;S.totalEarned+=reward;S.stars+=stars;S.bossesKilled++;
document.getElementById('boss-overlay').classList.remove('show');
toast('üéâ –ë–æ—Å—Å –ø–æ–≤–µ—Ä–∂–µ–Ω! +'+fmt(reward)+' üí∞ +'+stars+'‚≠ê');
updateQuestProgress('boss',1);
bossState=null;save();updateUI();
}
updateBossUI();
}
function fleeBoss(){
if(bossState){clearInterval(bossState.interval);bossState=null;}
document.getElementById('boss-overlay').classList.remove('show');
}
function updateBossUI(){
if(!bossState)return;
document.getElementById('boss-timer').textContent=bossState.time+'—Å';
document.getElementById('boss-hp-fill').style.width=(bossState.hp/bossState.maxHp*100)+'%';
document.getElementById('boss-hp-text').textContent=fmt(bossState.hp)+'/'+fmt(bossState.maxHp);
}

// DUEL
function startDuel(){
if(S.coins<5000){toast('‚ùå –ù—É–∂–Ω–æ 5,000 –º–æ–Ω–µ—Ç');return;}
if(!db||!tgUser){toast('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');return;}
S.coins-=5000;save();
let myName=tgUser.first_name||'–ò–≥—Ä–æ–∫';
// Check for open duels
let duelsRef=db.ref('vriskas_clicker_duels');
duelsRef.orderByChild('status').equalTo('waiting').limitToFirst(1).once('value').then(snap=>{
let found=false;
snap.forEach(child=>{
let d=child.val();
if(d.p1_id!==tgUser.id.toString()){
found=true;
// Join duel
child.ref.update({p2_id:tgUser.id.toString(),p2_name:myName,p2_taps:0,status:'active',startTime:Date.now()});
startDuelGame(child.key,2,d.p1_name);
}
});
if(!found){
// Create new duel
let newRef=duelsRef.push({p1_id:tgUser.id.toString(),p1_name:myName,p1_taps:0,p2_id:'',p2_name:'',p2_taps:0,status:'waiting',startTime:0});
toast('‚è≥ –ò—â–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...');
// Listen for opponent
let listener=newRef.on('value',snap=>{
let d=snap.val();
if(d&&d.status==='active'){
newRef.off('value',listener);
startDuelGame(newRef.key,1,d.p2_name);
}
});
// Timeout 30s
setTimeout(()=>{
newRef.once('value').then(snap=>{
let d=snap.val();
if(d&&d.status==='waiting'){
newRef.remove();
S.coins+=5000;save();updateUI();
toast('‚ùå –°–æ–ø–µ—Ä–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –º–æ–Ω–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã');
}
});
},30000);
}
});
}
function startDuelGame(duelId,playerNum,enemyName){
duelState={id:duelId,playerNum,myTaps:0,enemyTaps:0,time:30};
document.getElementById('duel-overlay').classList.add('show');
document.getElementById('duel-my-name').textContent=tgUser.first_name||'–¢—ã';
document.getElementById('duel-enemy-name').textContent=enemyName;
document.getElementById('duel-my-score').textContent='0';
document.getElementById('duel-enemy-score').textContent='0';
let ref=db.ref('vriskas_clicker_duels/'+duelId);
// Listen for enemy taps
ref.on('value',snap=>{
let d=snap.val();
if(!d)return;
duelState.enemyTaps=playerNum===1?(d.p2_taps||0):(d.p1_taps||0);
document.getElementById('duel-enemy-score').textContent=duelState.enemyTaps;
});
duelState.interval=setInterval(()=>{
duelState.time--;
document.getElementById('duel-timer').textContent=duelState.time+'—Å';
if(duelState.time<=0){
clearInterval(duelState.interval);
ref.off();
endDuel(ref);
}
},1000);
}
function duelTap(){
if(!duelState)return;
duelState.myTaps++;
document.getElementById('duel-my-score').textContent=duelState.myTaps;
let field=duelState.playerNum===1?'p1_taps':'p2_taps';
let upd={};upd[field]=duelState.myTaps;
db.ref('vriskas_clicker_duels/'+duelState.id).update(upd);
if(tg&&S.settings.haptic)try{tg.HapticFeedback.impactOccurred('light');}catch(e){}
let btn=document.getElementById('duel-tap-btn');
btn.style.transform='scale(0.85)';
setTimeout(()=>btn.style.transform='',60);
}
function endDuel(ref){
document.getElementById('duel-overlay').classList.remove('show');
let won=duelState.myTaps>duelState.enemyTaps;
if(won){
let prize=9000;
S.coins+=prize;S.totalEarned+=prize;S.stars+=3;S.duelsWon++;
toast('üèÜ –ü–æ–±–µ–¥–∞! +'+fmt(prize)+' üí∞ +3‚≠ê ('+duelState.myTaps+' vs '+duelState.enemyTaps+')');
updateQuestProgress('duel',1);
}else if(duelState.myTaps===duelState.enemyTaps){
S.coins+=5000;
toast('ü§ù –ù–∏—á—å—è! –ú–æ–Ω–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã ('+duelState.myTaps+' vs '+duelState.enemyTaps+')');
}else{
S.duelsLost++;
toast('üò¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ ('+duelState.myTaps+' vs '+duelState.enemyTaps+')');
}
ref.remove();
duelState=null;save();updateUI();
}

// GOLDEN COIN
function spawnGolden(){
if(document.querySelector('.golden-coin'))return;
let coin=document.createElement('div');
coin.className='golden-coin';
coin.innerHTML='<svg viewBox="0 0 44 44"><circle cx="22" cy="22" r="20" fill="#FFD700" stroke="#FFA500" stroke-width="2"/><text x="22" y="28" text-anchor="middle" font-size="16" font-weight="900" fill="#8B6914">$</text></svg>';
coin.style.left=Math.random()*70+10+'%';
coin.style.top=Math.random()*50+15+'%';
coin.onclick=()=>{
let amount=Math.floor(calcPerTap()*15*getLuck());
S.coins+=amount;S.totalEarned+=amount;S.goldenCaught=(S.goldenCaught||0)+1;
toast('üåü –ó–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞! +'+fmt(amount));
updateQuestProgress('golden',1);
coin.remove();save();updateUI();
};
document.body.appendChild(coin);
setTimeout(()=>{if(coin.parentNode)coin.remove();},4000);
}

// EVENTS
function triggerEvent(){
const events=[
{n:'–ó–æ–ª–æ—Ç–æ–π –ß–∞—Å',id:'golden_hour',dur:60,desc:'x3 –º–æ–Ω–µ—Ç!'},
{n:'–ê–ª–º–∞–∑–Ω–∞—è –õ–∏—Ö–æ—Ä–∞–¥–∫–∞',id:'diamond',dur:30,desc:'x5 –∫ —Ç–∞–ø—É!'},
{n:'–î–æ–∂–¥—å –ú–æ–Ω–µ—Ç',id:'rain',dur:45,desc:'–ë–æ–Ω—É—Å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã!'},
{n:'–≠–Ω–µ—Ä–≥–æ –®—Ç–æ—Ä–º',id:'energy_storm',dur:40,desc:'–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è!'}
];
let ev=events[Math.floor(Math.random()*events.length)];
eventActive=ev.id;
eventTimer=ev.dur;
let banner=document.createElement('div');
banner.className='event-banner';
banner.id='event-banner';
banner.textContent='‚ö° '+ev.n+': '+ev.desc;
document.body.appendChild(banner);
let interval=setInterval(()=>{
eventTimer--;
if(ev.id==='rain'&&eventTimer%5===0){
let amount=Math.floor(calcPerTap()*10*getLuck());
S.coins+=amount;S.totalEarned+=amount;
}
if(ev.id==='energy_storm')S.energy=calcMaxEnergy();
if(eventTimer<=0){
clearInterval(interval);eventActive=null;
banner.remove();
}
},1000);
toast('‚ö° –°–æ–±—ã—Ç–∏–µ: '+ev.n+'!');
}

// LUCK BLOCK
function luckBlock(){
let rewards=[
{n:'–ú–æ–Ω–µ—Ç—ã',fn:()=>{let a=Math.floor(1000*getLuck());S.coins+=a;S.totalEarned+=a;return'+'+fmt(a)+' –º–æ–Ω–µ—Ç';}},
{n:'–ó–≤—ë–∑–¥—ã',fn:()=>{let a=Math.floor(3*getLuck());S.stars+=a;return'+'+a+' ‚≠ê';}},
{n:'–≠–Ω–µ—Ä–≥–∏—è',fn:()=>{S.energy=calcMaxEnergy();return'–ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è!';}},
{n:'XP –±—É—Å—Ç',fn:()=>{let a=Math.floor(500*getLuck());S.xp+=a;checkLevelUp();return'+'+a+' XP';}},
{n:'–ö–æ–º–±–æ',fn:()=>{S.comboMulti=Math.min(50,S.comboMulti+5);return'–ö–æ–º–±–æ +5!';}},
];
let r=rewards[Math.floor(Math.random()*rewards.length)];
let result=r.fn();
toast('üéÅ –õ–∞–∫–∏ –±–ª–æ–∫: '+result);
save();updateUI();
}

// ROULETTE
let rouletteSpinning=false;
const ROULETTE_PRIZES=[
{n:'100',v:100,color:'#e74c3c'},{n:'500',v:500,color:'#3498db'},
{n:'1K',v:1000,color:'#2ecc71'},{n:'2K',v:2000,color:'#f39c12'},
{n:'5K',v:5000,color:'#9b59b6'},{n:'10K',v:10000,color:'#1abc9c'},
{n:'25K',v:25000,color:'#e67e22'},{n:'50K',v:50000,color:'#fd79a8'}
];
function drawRoulette(angle){
let canvas=document.getElementById('roulette-canvas');
if(!canvas)return;
let ctx=canvas.getContext('2d');
let w=canvas.width=canvas.offsetWidth*2;
let h=canvas.height=canvas.offsetHeight*2;
ctx.clearRect(0,0,w,h);
let cx=w/2,cy=h/2,r=Math.min(cx,cy)-10;
let sliceAngle=Math.PI*2/ROULETTE_PRIZES.length;
ROULETTE_PRIZES.forEach((p,i)=>{
ctx.beginPath();
ctx.moveTo(cx,cy);
ctx.arc(cx,cy,r,angle+i*sliceAngle,angle+(i+1)*sliceAngle);
ctx.fillStyle=p.color;
ctx.fill();
ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=2;ctx.stroke();
ctx.save();
ctx.translate(cx,cy);
ctx.rotate(angle+(i+0.5)*sliceAngle);
ctx.fillStyle='#fff';ctx.font='bold '+(r/8)+'px sans-serif';ctx.textAlign='center';
ctx.fillText(p.n,r*0.65,5);
ctx.restore();
});
// Arrow
ctx.beginPath();ctx.moveTo(cx+r+5,cy);ctx.lineTo(cx+r-20,cy-12);ctx.lineTo(cx+r-20,cy+12);ctx.fillStyle='#fff';ctx.fill();
}
function spinRoulette(){
if(rouletteSpinning)return;
let now=Date.now();
if(now-S.rouletteTime<1800000){
let left=Math.ceil((1800000-(now-S.rouletteTime))/60000);
toast('‚è∞ –ü–æ–¥–æ–∂–¥–∏ '+left+' –º–∏–Ω');return;
}
rouletteSpinning=true;
S.rouletteTime=now;
let totalAngle=Math.PI*2*5+Math.random()*Math.PI*2;
let duration=4000;
let start=Date.now();
let startAngle=0;
function animate(){
let elapsed=Date.now()-start;
let progress=Math.min(elapsed/duration,1);
let eased=1-Math.pow(1-progress,3);
let currentAngle=startAngle+totalAngle*eased;
drawRoulette(currentAngle);
if(progress<1){requestAnimationFrame(animate);}
else{
rouletteSpinning=false;
let finalAngle=(currentAngle%(Math.PI*2));
let sliceAngle=Math.PI*2/ROULETTE_PRIZES.length;
let idx=Math.floor(((Math.PI*2-finalAngle)%( Math.PI*2))/sliceAngle)%ROULETTE_PRIZES.length;
let prize=ROULETTE_PRIZES[idx];
let amount=Math.floor(prize.v*getLuck());
S.coins+=amount;S.totalEarned+=amount;S.rouletteWins=(S.rouletteWins||0)+1;
toast('üé∞ –í—ã–∏–≥—Ä—ã—à: +'+fmt(amount)+' –º–æ–Ω–µ—Ç!');
save();updateUI();
}
}
animate();
}

// QUESTS
function generateQuests(){
let today=new Date().toDateString();
if(S.quests.date===today&&S.quests.list.length>0)return;
S.quests={date:today,list:[
{id:'taps',n:'–°–¥–µ–ª–∞–π 200 —Ç–∞–ø–æ–≤',target:200,progress:0,reward:800,starReward:2,done:false},
{id:'earn',n:'–ó–∞—Ä–∞–±–æ—Ç–∞–π 10K',target:10000,progress:0,reward:2000,starReward:3,done:false},
{id:'boss',n:'–£–±–µ–π –±–æ—Å—Å–∞',target:1,progress:0,reward:3000,starReward:5,done:false},
{id:'golden',n:'–ü–æ–π–º–∞–π 3 –∑–æ–ª–æ—Ç—ã—Ö',target:3,progress:0,reward:1500,starReward:2,done:false},
{id:'combo',n:'–ö–æ–º–±–æ x10',target:1,progress:0,reward:2000,starReward:3,done:false},
{id:'duel',n:'–í—ã–∏–≥—Ä–∞–π –¥—É—ç–ª—å',target:1,progress:0,reward:3000,starReward:4,done:false}
]};
save();
}
function updateQuestProgress(type,amount){
if(!S.quests.list)return;
S.quests.list.forEach(q=>{
if(q.id===type&&!q.done){
q.progress=Math.min(q.target,q.progress+amount);
if(q.progress>=q.target){
q.done=true;
S.coins+=q.reward;S.totalEarned+=q.reward;S.stars+=q.starReward;
toast('üìã –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +'+fmt(q.reward)+' üí∞ +'+q.starReward+'‚≠ê');
save();updateUI();
}
}
});
if(type==='combo'&&S.comboMulti>=10){
S.quests.list.forEach(q=>{if(q.id==='combo'&&!q.done){q.progress=1;q.done=true;S.coins+=q.reward;S.totalEarned+=q.reward;S.stars+=q.starReward;toast('üìã –ö–≤–µ—Å—Ç: –ö–æ–º–±–æ x10! +'+fmt(q.reward));save();updateUI();}});
}
}
function renderQuests(){
generateQuests();
let el=document.getElementById('quest-list');
el.innerHTML=S.quests.list.map(q=>`
<div class="quest-item ${q.done?'done':''}">
<div class="quest-prog">
<h4>${q.done?'‚úÖ':'üìã'} ${q.n}</h4>
<p>–ù–∞–≥—Ä–∞–¥–∞: ${fmt(q.reward)} üí∞ +${q.starReward}‚≠ê</p>
<div class="quest-bar"><div class="quest-bar-fill" style="width:${q.progress/q.target*100}%"></div></div>
</div>
<span style="font-size:11px;color:var(--text2)">${q.progress}/${q.target}</span>
</div>`).join('');
}

// WORLDS
function renderWorlds(){
let el=document.getElementById('worlds-list');
el.innerHTML=WORLDS.map((w,i)=>`
<div class="world-card ${i===S.world?'active':''} ${S.level<w.req?'locked':''}" onclick="selectWorld(${i})">
<h4>${i<=S.world?'üåç':'üîí'} ${w.n}</h4>
<p>${w.desc} ${S.level<w.req?'(–ù—É–∂–µ–Ω —É—Ä.'+w.req+')':''}</p>
</div>`).join('');
}
function selectWorld(i){
if(S.level<WORLDS[i].req){toast('‚ùå –ù—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å '+WORLDS[i].req);return;}
S.world=i;save();renderWorlds();updateUI();
toast('üåç –ú–∏—Ä: '+WORLDS[i].n+' (x'+WORLDS[i].mult+')');
}

// DAILY
function renderStreak(){
let el=document.getElementById('streak-display');
let html='';
for(let i=1;i<=7;i++){
let cls=i<=S.dailyStreak?'claimed':i===S.dailyStreak+1?'current':'';
html+=`<div class="streak-day ${cls}">${i}</div>`;
}
el.innerHTML=html;
let btn=document.getElementById('daily-btn');
let canClaim=Date.now()-S.lastDaily>82800000;
btn.disabled=!canClaim;
btn.textContent=canClaim?'–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å':'–£–∂–µ –ø–æ–ª—É—á–µ–Ω';
btn.style.opacity=canClaim?1:0.5;
}
function claimDaily(){
if(Date.now()-S.lastDaily<82800000){toast('‚ùå –£–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è');return;}
S.dailyStreak++;S.lastDaily=Date.now();
let reward=Math.floor(500*S.dailyStreak*getLuck());
let starR=Math.min(S.dailyStreak,7);
S.coins+=reward;S.totalEarned+=reward;S.stars+=starR;
toast('üéÅ –î–µ–Ω—å '+S.dailyStreak+'! +'+fmt(reward)+' üí∞ +'+starR+'‚≠ê');
save();updateUI();renderStreak();
}

// LEVEL
function checkLevelUp(){
while(S.level<LEVELS.length){
let next=LEVELS[S.level];
if(!next||S.xp<next.xp)break;
S.level++;
if(next.r>0){S.coins+=next.r;S.totalEarned+=next.r;}
if(next.s>0)S.stars+=next.s;
toast('üéâ –£—Ä–æ–≤–µ–Ω—å '+S.level+'! '+LEVELS[S.level-1].n+(next.r>0?' +'+fmt(next.r):'')+(next.s>0?' +'+next.s+'‚≠ê':''));
}
}

// SHOP
let shopTab=0;
function showShopTab(t){
shopTab=t;
document.querySelectorAll('#shop-tabs button').forEach((b,i)=>b.classList.toggle('active',i===t));
renderShop();
}
function renderShop(){
let el=document.getElementById('shop-content');
if(shopTab===0){
el.innerHTML=UPGRADES.map(u=>{
let lvl=S.upgrades[u.id]||0;
let price=Math.floor(u.base*Math.pow(u.scaling,lvl));
let canBuy=S.coins>=price;
return`<div class="upgrade-item ${canBuy?'':'locked'}" onclick="buyUpgrade('${u.id}')">
<div class="upgrade-icon" style="background:${canBuy?'rgba(108,92,231,0.2)':'rgba(255,255,255,0.05)'}">${u.icon}</div>
<div class="upgrade-info"><h4>${u.n} (—É—Ä.${lvl})</h4><p>${u.desc}</p></div>
<div class="upgrade-price"><svg viewBox="0 0 16 16"><circle cx="8" cy="8" r="7" fill="#FFD700" stroke="#FFA500" stroke-width="1"/><text x="8" y="11" text-anchor="middle" font-size="8" font-weight="900" fill="#8B6914">$</text></svg>${fmt(price)}</div>
</div>`;
}).join('');
}else if(shopTab===1){
el.innerHTML=SPECIAL_ITEMS.map(item=>{
let priceText=item.starPrice?item.starPrice+'‚≠ê':fmt(item.price)+' üí∞';
let canBuy=item.starPrice?S.stars>=item.starPrice:S.coins>=item.price;
return`<div class="upgrade-item ${canBuy?'':'locked'}" onclick="buySpecial('${item.id}')">
<div class="upgrade-icon" style="background:rgba(108,92,231,0.2)">${item.icon}</div>
<div class="upgrade-info"><h4>${item.n}</h4><p>${item.desc}</p></div>
<div class="upgrade-price">${priceText}</div>
</div>`;
}).join('');
}else if(shopTab===2){
el.innerHTML=STAR_ITEMS.map(item=>`
<div class="upgrade-item" onclick="buyStarItem('${item.id}')">
<div class="upgrade-icon" style="background:rgba(253,121,168,0.2)">${item.n.split(' ')[0]}</div>
<div class="upgrade-info"><h4>${item.n}</h4><p>${item.desc}</p></div>
<div class="upgrade-price">‚≠ê ${item.stars} Stars</div>
</div>`).join('');
}else if(shopTab===3){
el.innerHTML=PETS.map(p=>{
let owned=!!S.pets[p.id];
let active=S.activePet===p.id;
return`<div class="pet-card ${active?'active':''} ${!owned&&S.coins<p.price?'locked':''}" onclick="buyPet('${p.id}')">
<div style="font-size:36px">${p.icon}</div>
<div class="name">${p.n}${active?' ‚úÖ':''}</div>
<div class="desc">${p.desc}</div>
${owned?'<div style="font-size:10px;color:var(--green)">–ö—É–ø–ª–µ–Ω–æ</div>':'<div style="font-size:10px;color:var(--gold)">'+fmt(p.price)+' üí∞</div>'}
</div>`;
}).join('');
}else if(shopTab===4){
el.innerHTML='<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">'+ARTIFACTS.map(a=>{
let owned=!!S.artifacts[a.id];
return`<div class="artifact-card ${owned?'owned':''}" onclick="buyArtifact('${a.id}')" style="cursor:pointer">
<div style="font-size:28px">${a.icon}</div>
<div style="font-size:11px;font-weight:700;margin-top:4px">${a.n}</div>
<div style="font-size:9px;color:var(--text2)">${a.desc}</div>
${owned?'<div style="font-size:9px;color:var(--green)">‚úÖ</div>':'<div style="font-size:9px;color:var(--gold)">'+fmt(a.price)+' üí∞</div>'}
</div>`;
}).join('')+'</div>';
}
}
function buyUpgrade(id){
let u=UPGRADES.find(u=>u.id===id);
let lvl=S.upgrades[u.id]||0;
let price=Math.floor(u.base*Math.pow(u.scaling,lvl));
if(S.coins<price)return;
S.coins-=price;S.upgrades[u.id]=(S.upgrades[u.id]||0)+1;
if(u.type==='perTap')S.perTap+=u.val;
if(u.type==='cps')S.cps+=u.val;
if(u.type==='maxEnergy')S.maxEnergy+=u.val;
if(u.type==='energyRegen')S.energyRegen+=u.val;
updateQuestProgress('upgrade',1);
toast('‚úÖ '+u.n+' ‚Üí —É—Ä.'+(S.upgrades[u.id]));
save();updateUI();renderShop();
}
function buySpecial(id){
let item=SPECIAL_ITEMS.find(i=>i.id===id);
if(item.starPrice){if(S.stars<item.starPrice)return;S.stars-=item.starPrice;}
else{if(S.coins<item.price)return;S.coins-=item.price;}
switch(item.action){
case'fullEnergy':S.energy=calcMaxEnergy();toast('üîã –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!');break;
case'x2':x2Active=true;setTimeout(()=>{x2Active=false;toast('‚è∞ x2 –∑–∞–∫–æ–Ω—á–∏–ª—Å—è');},60000);toast('üí∞ x2 –º–æ–Ω–µ—Ç—ã –Ω–∞ 60 —Å–µ–∫—É–Ω–¥!');break;
case'megaCombo':megaComboLeft=10;toast('üî• x50 –Ω–∞ 10 —Ç–∞–ø–æ–≤!');break;
case'buyStars':S.stars+=10;toast('‚≠ê +10 –∑–≤—ë–∑–¥!');break;
case'starBoost':S.perTap+=5;toast('üåü +5 –∫ —Ç–∞–ø—É –Ω–∞–≤—Å–µ–≥–¥–∞!');break;
case'randomSkin':let locked=SKINS.filter(s=>!S.ownedSkins.includes(s.id));if(locked.length===0){toast('–£ —Ç–µ–±—è –≤—Å–µ —Å–∫–∏–Ω—ã!');S.coins+=item.price;break;}let rs=locked[Math.floor(Math.random()*locked.length)];S.ownedSkins.push(rs.id);toast('üé≤ –ü–æ–ª—É—á–µ–Ω —Å–∫–∏–Ω: '+rs.n+'!');break;
case'eliteBoss':startBoss(true);break;
case'timeWarp':let earned=calcCPS()*7200;S.coins+=earned;S.totalEarned+=earned;toast('‚è∞ +'+fmt(earned)+' –º–æ–Ω–µ—Ç (2—á)');break;
}
save();updateUI();renderShop();
}
function buyStarItem(id){
let item=STAR_ITEMS.find(i=>i.id===id);
startPreCheckoutPolling();
fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/createInvoiceLink',{
method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({title:item.n,description:item.desc,payload:'star_'+item.id+'_'+(tgUser?tgUser.id:'0'),provider_token:'',currency:'XTR',prices:[{label:item.n,amount:item.stars}]})
}).then(r=>r.json()).then(data=>{
if(data.ok&&tg){
tg.openInvoice(data.result,status=>{
stopPreCheckoutPolling();
if(status==='paid'){
switch(item.action){
case'megatap':S.perTap+=10;break;
case'maxenergy':S.maxEnergy+=5000;break;
case'ultrabot':S.cps+=50;break;
case'megaregen':S.energyRegen+=20;break;
case'stars100':S.stars+=100;break;
case'legendary':S.perTap+=50;break;
case'vip':vipMode=true;break;
}
toast('‚úÖ –ö—É–ø–ª–µ–Ω–æ: '+item.n+'!');
save();updateUI();
}
});
}else{stopPreCheckoutPolling();toast('‚ùå –û—à–∏–±–∫–∞: '+(data.description||'–Ω–µ —É–¥–∞–ª–æ—Å—å'));}
}).catch(e=>{stopPreCheckoutPolling();toast('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');});
}
function buyPet(id){
let p=PETS.find(p=>p.id===id);
if(S.pets[p.id]){S.activePet=S.activePet===p.id?null:p.id;toast(S.activePet?'üêæ '+p.n+' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!':'üêæ –ü–∏—Ç–æ–º–µ—Ü —Å–Ω—è—Ç');save();updateUI();renderShop();return;}
if(S.coins<p.price){toast('‚ùå –ù—É–∂–Ω–æ '+fmt(p.price));return;}
S.coins-=p.price;S.pets[p.id]=true;S.activePet=p.id;
toast('üêæ –ö—É–ø–ª–µ–Ω: '+p.n+'!');save();updateUI();renderShop();
}
function buyArtifact(id){
let a=ARTIFACTS.find(a=>a.id===id);
if(S.artifacts[a.id]){toast('–£–∂–µ –∫—É–ø–ª–µ–Ω');return;}
if(S.coins<a.price){toast('‚ùå –ù—É–∂–Ω–æ '+fmt(a.price));return;}
S.coins-=a.price;S.artifacts[a.id]=true;
toast('üîÆ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç: '+a.n+'!');save();updateUI();renderShop();
}

// SKINS
function renderSkins(){
let el=document.getElementById('skin-grid');
el.innerHTML=SKINS.map(s=>{
let owned=S.ownedSkins.includes(s.id);
let active=S.skinId===s.id;
let bonuses=[];
if(s.tap>0)bonuses.push('+'+s.tap+' —Ç–∞–ø');
if(s.cps>0)bonuses.push('+'+s.cps+'/—Å');
if(s.regen>0)bonuses.push('+'+s.regen+' —Ä–µ–≥–µ–Ω');
if(s.energy>0)bonuses.push('+'+s.energy+' üîã');
return`<div class="skin-card ${active?'active':''} ${!owned?'locked':''}" onclick="selectSkin('${s.id}')">
<svg viewBox="0 0 160 160"><defs><radialGradient id="cg1" cx="40%" cy="35%"><stop offset="0%" stop-color="#FFE66D"/><stop offset="100%" stop-color="#F7A800"/></radialGradient></defs>${s.svg}</svg>
<div class="name">${s.n}</div>
<div class="bonus">${bonuses.join(' ')}</div>
${owned?'':'<div class="price">'+fmt(s.price)+' üí∞</div>'}
</div>`;
}).join('');
}
function selectSkin(id){
let s=SKINS.find(s=>s.id===id);
if(!S.ownedSkins.includes(id)){
if(S.coins<s.price){toast('‚ùå –ù—É–∂–Ω–æ '+fmt(s.price));return;}
S.coins-=s.price;S.ownedSkins.push(id);
toast('üé® –°–∫–∏–Ω: '+s.n+'!');
}
S.skinId=id;
document.getElementById('coin-svg').innerHTML='<defs><radialGradient id="cg1" cx="40%" cy="35%"><stop offset="0%" stop-color="#FFE66D"/><stop offset="100%" stop-color="#F7A800"/></radialGradient></defs>'+s.svg;
save();updateUI();renderSkins();
}

// ACHIEVEMENTS
function renderAchievements(){
let el=document.getElementById('ach-list');
let done=ACHIEVEMENTS.filter(a=>S.achievements.includes(a.id)).length;
document.getElementById('ach-count').textContent=done+'/'+ACHIEVEMENTS.length;
el.innerHTML=ACHIEVEMENTS.map(a=>{
let isDone=S.achievements.includes(a.id);
let prog=a.prog();
return`<div class="ach-item ${isDone?'done':''}">
<div class="ach-icon">${a.icon}</div>
<div class="ach-info">
<h4>${isDone?'‚úÖ ':''}${a.n}</h4>
<p>${a.d}</p>
<div class="ach-prog"><div class="ach-prog-fill" style="width:${prog*100}%"></div></div>
</div>
<div class="ach-reward">${fmt(a.reward)} üí∞</div>
</div>`;
}).join('');
}
function checkAchievements(){
ACHIEVEMENTS.forEach(a=>{
if(!S.achievements.includes(a.id)&&a.req()){
S.achievements.push(a.id);
S.coins+=a.reward;S.totalEarned+=a.reward;
toast('üèÖ –ê—á–∏–≤–∫–∞: '+a.n+'! +'+fmt(a.reward));
}
});
}

// LEADERBOARD
function loadLB(type,btn){
if(btn){
btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
}
let el=document.getElementById('lb-list');
if(!db){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text2)">‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ</div>';return;}
el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text2)">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
let field=type===0?'totalEarned':type===1?'totalTaps':'level';
db.ref('vriskas_clicker').orderByChild(field).limitToLast(50).once('value').then(snap=>{
let players=[];
snap.forEach(child=>{let d=child.val();d.id=child.key;players.push(d);});
players.sort((a,b)=>(b[field]||0)-(a[field]||0));
if(players.length===0){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text2)">–ü–æ–∫–∞ –ø—É—Å—Ç–æ ‚Äî –ø—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π!</div>';return;}
el.innerHTML=players.map((p,i)=>{
let isMe=tgUser&&p.id==tgUser.id;
let medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
let posColor=i===0?'#FFD700':i===1?'#C0C0C0':i===2?'#CD7F32':'var(--card2)';
let val=type===0?fmt(p.totalEarned||0):type===1?fmt(p.totalTaps||0):'–£—Ä.'+(p.level||1);
return`<div class="lb-item ${isMe?'lb-me':''}">
<div class="lb-pos" style="background:${posColor};color:${i<3?'#000':'var(--text)'}">${medal||i+1}</div>
<div class="lb-info"><h4>${p.name||'–ò–≥—Ä–æ–∫'}${isMe?' (—Ç—ã)':''}</h4><p>–£—Ä.${p.level||1}</p></div>
<div class="lb-score">${val}</div>
</div>`;
}).join('');
}).catch(()=>{el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text2)">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';});
}

// PROFILE
function renderProfile(){
let name=tgUser?tgUser.first_name:'–ò–≥—Ä–æ–∫';
document.getElementById('profile-name').textContent=name;
if(tgUser&&tgUser.photo_url){
document.getElementById('profile-photo').innerHTML='<img src="'+tgUser.photo_url+'" style="width:100%;height:100%;object-fit:cover;border-radius:50%">';
}
let badges=[];
badges.push('<span class="lvl">–£—Ä.'+S.level+' '+LEVELS[Math.min(S.level-1,LEVELS.length-1)].n+'</span>');
if(vipMode)badges.push('<span style="background:var(--gold);color:#000;padding:2px 8px;border-radius:10px;font-size:11px">üëë VIP</span>');
if(S.bossesKilled>=50)badges.push('<span style="background:var(--red);padding:2px 8px;border-radius:10px;font-size:11px;color:#fff">üëπ –ë–æ—Å—Å-–∫–∏–ª–ª–µ—Ä</span>');
if(S.duelsWon>=50)badges.push('<span style="background:var(--blue);padding:2px 8px;border-radius:10px;font-size:11px;color:#fff">‚öîÔ∏è –ß–µ–º–ø–∏–æ–Ω</span>');
document.getElementById('profile-badges').innerHTML=badges.join(' ');

let stats=`
<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
<div>üí∞ –ú–æ–Ω–µ—Ç—ã: <b>${fmt(S.coins)}</b></div>
<div>üìà –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b>${fmt(S.totalEarned)}</b></div>
<div>üëÜ –¢–∞–ø–æ–≤: <b>${fmt(S.totalTaps)}</b></div>
<div>üí™ –ó–∞ —Ç–∞–ø: <b>${fmt(calcPerTap())}</b></div>
<div>ü§ñ –í —Å–µ–∫: <b>${fmt(calcCPS())}</b></div>
<div>üîã –≠–Ω–µ—Ä–≥–∏—è: <b>${calcMaxEnergy()}</b></div>
<div>‚≠ê –ó–≤—ë–∑–¥—ã: <b>${S.stars}</b></div>
<div>üëπ –ë–æ—Å—Å–æ–≤: <b>${S.bossesKilled}</b></div>
<div>‚öîÔ∏è –ü–æ–±–µ–¥: <b>${S.duelsWon}</b></div>
<div>üìÖ –°–µ—Ä–∏—è: <b>${S.dailyStreak} –¥–Ω</b></div>
<div>üåç –ú–∏—Ä: <b>${WORLDS[S.world].n}</b></div>
<div>üêæ –ü–∏—Ç–æ–º—Ü–µ–≤: <b>${Object.keys(S.pets).length}</b></div>
<div>üîÆ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤: <b>${Object.keys(S.artifacts).length}</b></div>
<div>üèÖ –ê—á–∏–≤–æ–∫: <b>${S.achievements.length}/${ACHIEVEMENTS.length}</b></div>
</div>`;
document.getElementById('profile-stats').innerHTML=stats;
renderStreak();
// Admin
if(tgUser&&tgUser.username&&tgUser.username.toLowerCase()===ADMIN_USERNAME.toLowerCase()){
renderAdmin();
}
}

// ADMIN
function renderAdmin(){
let sec=document.getElementById('admin-section');
sec.innerHTML=`
<div class="card" style="border:1px solid var(--red)">
<div class="card-title" style="color:var(--red)">üîß –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px">
<button class="btn btn-primary" onclick="adminListPlayers()" style="font-size:11px">üìã –ò–≥—Ä–æ–∫–∏</button>
<button class="btn btn-gold" onclick="adminStats()" style="font-size:11px">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
<button class="btn btn-outline" onclick="adminSearchPlayer()" style="font-size:11px">üîç –ü–æ–∏—Å–∫</button>
<button class="btn btn-red" onclick="adminResetAll()" style="font-size:11px">üóë –†–µ—Å–µ—Ç –≤—Å–µ—Ö</button>
</div>
<div id="admin-content"></div>
</div>`;
}
function adminListPlayers(){
if(!db)return;
db.ref('vriskas_clicker').once('value').then(snap=>{
let html='';
snap.forEach(child=>{
let d=child.val();
let banned=d.banned?'üîí':'';
html+=`<div class="admin-player">
<div class="info"><h4>${banned}${d.name||'?'} (${child.key})</h4><p>üí∞${fmt(d.totalEarned||0)} üëÜ${fmt(d.totalTaps||0)} ‚≠ê${d.stars||0} –£—Ä.${d.level||1}</p></div>
<div class="actions">
<button onclick="adminEditPlayer('${child.key}')" style="background:var(--blue);color:#fff">‚úèÔ∏è</button>
<button onclick="adminBanPlayer('${child.key}',${!d.banned})" style="background:${d.banned?'var(--green)':'var(--red)'};color:#fff">${d.banned?'üîì':'üîí'}</button>
<button onclick="adminDeletePlayer('${child.key}')" style="background:var(--red);color:#fff">üóë</button>
</div>
</div>`;
});
document.getElementById('admin-content').innerHTML=html||'<p style="color:var(--text2)">–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</p>';
});
}
function adminBanPlayer(id,ban){
if(!db)return;
if(ban){
db.ref('vriskas_clicker/'+id).update({banned:true,adminForceUpdate:true,coins:0,totalEarned:0,totalTaps:0,stars:0});
toast('üîí –ò–≥—Ä–æ–∫ '+id+' –∑–∞–±–∞–Ω–µ–Ω –∏ –æ–±–Ω—É–ª—ë–Ω');
}else{
db.ref('vriskas_clicker/'+id).update({banned:false,adminForceUpdate:true});
toast('üîì –ò–≥—Ä–æ–∫ '+id+' —Ä–∞–∑–±–∞–Ω–µ–Ω');
}
setTimeout(()=>adminListPlayers(),500);
}
function adminEditPlayer(id){
if(!db)return;
db.ref('vriskas_clicker/'+id).once('value').then(snap=>{
let d=snap.val()||{};
let box=document.getElementById('modal-box');
box.innerHTML=`
<h3 style="margin-bottom:12px">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: ${d.name||id}</h3>
<div style="display:grid;gap:8px">
<div><label style="font-size:12px">–ú–æ–Ω–µ—Ç—ã</label><input type="number" id="ae-coins" value="${d.coins||0}"></div>
<div><label style="font-size:12px">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</label><input type="number" id="ae-earned" value="${d.totalEarned||0}"></div>
<div><label style="font-size:12px">–¢–∞–ø—ã</label><input type="number" id="ae-taps" value="${d.totalTaps||0}"></div>
<div><label style="font-size:12px">–ó–≤—ë–∑–¥—ã</label><input type="number" id="ae-stars" value="${d.stars||0}"></div>
<div><label style="font-size:12px">–£—Ä–æ–≤–µ–Ω—å</label><input type="number" id="ae-level" value="${d.level||1}"></div>
<button class="btn btn-primary" onclick="adminSavePlayer('${id}')">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å</button>
<button class="btn btn-outline" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
</div>`;
document.getElementById('modal').classList.add('show');
});
}
function adminSavePlayer(id){
let data={
coins:parseInt(document.getElementById('ae-coins').value)||0,
totalEarned:parseInt(document.getElementById('ae-earned').value)||0,
totalTaps:parseInt(document.getElementById('ae-taps').value)||0,
stars:parseInt(document.getElementById('ae-stars').value)||0,
level:parseInt(document.getElementById('ae-level').value)||1,
adminForceUpdate:true
};
db.ref('vriskas_clicker/'+id).update(data).then(()=>{
toast('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
closeModal();adminListPlayers();
});
}
function adminDeletePlayer(id){
if(confirm('–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ '+id+'?')){
db.ref('vriskas_clicker/'+id).remove();
toast('üóë –£–¥–∞–ª—ë–Ω');setTimeout(()=>adminListPlayers(),500);
}
}
function adminSearchPlayer(){
let id=prompt('User ID:');
if(id)adminEditPlayer(id);
}
function adminStats(){
db.ref('vriskas_clicker').once('value').then(snap=>{
let count=0,totalCoins=0,totalTaps=0,banned=0;
snap.forEach(child=>{
let d=child.val();count++;
totalCoins+=(d.totalEarned||0);totalTaps+=(d.totalTaps||0);
if(d.banned)banned++;
});
document.getElementById('admin-content').innerHTML=`
<div style="font-size:12px;display:grid;gap:4px">
<div>üë• –ò–≥—Ä–æ–∫–æ–≤: <b>${count}</b></div>
<div>üí∞ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b>${fmt(totalCoins)}</b></div>
<div>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤: <b>${fmt(totalTaps)}</b></div>
<div>üîí –ó–∞–±–∞–Ω–µ–Ω–æ: <b>${banned}</b></div>
</div>`;
});
}
function adminResetAll(){
if(confirm('–£–î–ê–õ–ò–¢–¨ –í–°–ï–• –ò–ì–†–û–ö–û–í?')){
db.ref('vriskas_clicker').remove();
toast('üóë –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
}
}
function closeModal(){document.getElementById('modal').classList.remove('show');}

// CODES
function useCode(){
let code=document.getElementById('code-input').value.trim().toUpperCase();
if(!code)return;
let sc=SECRET_CODES.find(c=>c.code===code);
if(!sc){toast('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥');return;}
if(sc.once&&S.usedCodes.includes(code)){toast('‚ùå –ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');return;}
S.usedCodes.push(code);
if(sc.reward.coins){S.coins+=sc.reward.coins;S.totalEarned+=sc.reward.coins;}
if(sc.reward.stars)S.stars+=sc.reward.stars;
let msg='üîë –ö–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!';
if(sc.reward.coins)msg+=' +'+fmt(sc.reward.coins)+' üí∞';
if(sc.reward.stars)msg+=' +'+sc.reward.stars+'‚≠ê';
toast(msg);
if(sc.action==='spawnBoss')startBoss();
document.getElementById('code-input').value='';
save();updateUI();
}

// STARS POLLING
function startPreCheckoutPolling(){
if(pollingInterval)return;
let offset=0;
pollingInterval=setInterval(()=>{
fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/getUpdates?offset='+offset+'&timeout=1&allowed_updates=["pre_checkout_query"]')
.then(r=>r.json()).then(data=>{
if(data.ok&&data.result){
data.result.forEach(upd=>{
offset=upd.update_id+1;
if(upd.pre_checkout_query){
fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/answerPreCheckoutQuery',{
method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({pre_checkout_query_id:upd.pre_checkout_query.id,ok:true})
});
}
});
}
}).catch(()=>{});
},1500);
}
function stopPreCheckoutPolling(){
if(pollingInterval){clearInterval(pollingInterval);pollingInterval=null;}
}

// TEST PAYMENT
function testPayment(){
startPreCheckoutPolling();
fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/createInvoiceLink',{
method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({title:'–¢–µ—Å—Ç –æ–ø–ª–∞—Ç—ã',description:'1 –∑–≤–µ–∑–¥–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç',payload:'test_'+(tgUser?tgUser.id:'0'),provider_token:'',currency:'XTR',prices:[{label:'–¢–µ—Å—Ç',amount:1}]})
}).then(r=>r.json()).then(data=>{
if(data.ok&&tg){
tg.openInvoice(data.result,status=>{
stopPreCheckoutPolling();
if(status==='paid'){
// Refund
fetch('https://api.telegram.org/bot'+BOT_TOKEN+'/refundStarPayment',{
method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({user_id:tgUser.id,telegram_payment_charge_id:'latest'})
}).then(()=>toast('üéâ –û–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–≤–µ–∑–¥–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ ‚úÖ')).catch(()=>toast('‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ (–≤–æ–∑–≤—Ä–∞—Ç –≤—Ä—É—á–Ω—É—é)'));
}else{toast('‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å: '+status);}
});
}else{stopPreCheckoutPolling();toast('‚ùå '+(data.description||'–û—à–∏–±–∫–∞'));}
}).catch(()=>{stopPreCheckoutPolling();toast('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');});
}

// MISC
function shareBot(){
if(tg)tg.openTelegramLink('https://t.me/share/url?url=https://t.me/VriskasRobot&text=–ò–≥—Ä–∞–π –≤ Vriskas Clicker!');
}
function resetProgress(){
if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å?')){
localStorage.removeItem(SAVE_KEY);
if(db&&tgUser)db.ref('vriskas_clicker/'+tgUser.id).remove();
location.reload();
}
}
function toggleMaterial(){
S.settings.material=!S.settings.material;
document.body.classList.toggle('material',S.settings.material);
document.getElementById('toggle-material').classList.toggle('on',S.settings.material);
save();
}
function toggleLight(){
S.settings.light=!S.settings.light;
document.body.classList.toggle('light',S.settings.light);
document.getElementById('toggle-light').classList.toggle('on',S.settings.light);
save();
}
function toggleHaptic(){S.settings.haptic=!S.settings.haptic;document.getElementById('toggle-haptic').classList.toggle('on',S.settings.haptic);save();}
function toggleSound(){S.settings.sound=!S.settings.sound;document.getElementById('toggle-sound').classList.toggle('on',S.settings.sound);save();}

function toast(msg){
let t=document.getElementById('toast');
t.textContent=msg;t.classList.add('show');
setTimeout(()=>t.classList.remove('show'),3000);
}

// BACKGROUND PARTICLES
function initBG(){
let bg=document.getElementById('clicker-bg');
let colors=['var(--accent)','var(--gold)','var(--pink)','var(--cyan)','var(--green)'];
for(let i=0;i<8;i++){
let p=document.createElement('div');
p.className='particle';
p.style.cssText=`width:${20+Math.random()*40}px;height:${20+Math.random()*40}px;background:${colors[i%colors.length]};left:${Math.random()*90}%;top:${Math.random()*90}%;animation-delay:${Math.random()*5}s;animation-duration:${6+Math.random()*6}s`;
bg.appendChild(p);
}
}

// UPDATE UI
function updateUI(){
document.getElementById('score-display').textContent=fmt(S.coins);
document.getElementById('top-coins').textContent=fmt(S.coins);
document.getElementById('top-stars').textContent=S.stars;
document.getElementById('top-lvl').textContent='–£—Ä.'+S.level;
document.getElementById('per-tap-text').textContent='+'+fmt(calcPerTap())+' –∑–∞ —Ç–∞–ø ‚Ä¢ '+fmt(calcCPS())+'/—Å–µ–∫'+(WORLDS[S.world].mult>1?' ‚Ä¢ x'+WORLDS[S.world].mult:'');
let mE=calcMaxEnergy();
document.getElementById('energy-fill').style.width=(S.energy/mE*100)+'%';
document.getElementById('energy-text').textContent='‚ö° '+Math.floor(S.energy)+'/'+mE;
let nextLvl=LEVELS[S.level]||LEVELS[LEVELS.length-1];
let prevXp=LEVELS[S.level-1]?LEVELS[S.level-1].xp:0;
let prog=(S.xp-prevXp)/(nextLvl.xp-prevXp);
document.getElementById('lvl-fill').style.width=(prog*100)+'%';
document.getElementById('lvl-text').textContent='–£—Ä.'+S.level+' '+LEVELS[Math.min(S.level-1,LEVELS.length-1)].n+' ‚Ä¢ '+fmt(S.xp)+'/'+fmt(nextLvl.xp)+' XP';
if(tgUser){
document.getElementById('top-name').textContent=tgUser.first_name||'–ò–≥—Ä–æ–∫';
document.getElementById('profile-name').textContent=tgUser.first_name||'–ò–≥—Ä–æ–∫';
}
document.getElementById('bosses-killed').textContent=S.bossesKilled;
document.getElementById('duels-won').textContent=S.duelsWon;
}

// GAME LOOP
function gameLoop(){
// Energy regen
let mE=calcMaxEnergy();
if(S.energy<mE){
S.energy=Math.min(mE,S.energy+calcRegen()/10);
}
// CPS
let cps=calcCPS();
if(cps>0){
let earned=cps/10;
if(eventActive==='golden_hour')earned*=3;
if(x2Active)earned*=2;
S.coins+=earned;S.totalEarned+=earned;
}
// Star generator
if((S.upgrades.stargen||0)>0&&Date.now()%(120000)<100){
S.stars++;
}
// Combo decay
if(Date.now()-S.comboTimer>getComboDecay()&&S.comboMulti>1){
S.comboMulti=1;S.comboCount=0;
let cb=document.getElementById('combo-badge');
cb.style.display='none';
}
// Anti-cheat
antiCheat();
// Check achievements
checkAchievements();
// UI
updateUI();
}

// INIT
function init(){
load();
// Apply settings
if(S.settings.material)document.body.classList.add('material');
if(S.settings.light)document.body.classList.add('light');
document.getElementById('toggle-material').classList.toggle('on',S.settings.material);
document.getElementById('toggle-light').classList.toggle('on',S.settings.light);
document.getElementById('toggle-haptic').classList.toggle('on',S.settings.haptic);
document.getElementById('toggle-sound').classList.toggle('on',S.settings.sound);
// Apply skin
let skin=SKINS.find(s=>s.id===S.skinId);
if(skin)document.getElementById('coin-svg').innerHTML='<defs><radialGradient id="cg1" cx="40%" cy="35%"><stop offset="0%" stop-color="#FFE66D"/><stop offset="100%" stop-color="#F7A800"/></radialGradient></defs>'+skin.svg;
initBG();
generateQuests();
renderSkins();
renderShop();
renderAchievements();
renderQuests();
renderWorlds();
renderStreak();
drawRoulette(0);
updateUI();
// Sync
syncToCloud();
setInterval(()=>{save();syncToCloud();},30000);
// Ban check
setInterval(checkBan,5000);
// Game loop
setInterval(gameLoop,100);
// Auto save on hide
document.addEventListener('visibilitychange',()=>{if(document.hidden){save();syncToCloud();}});
// Telegram theme
if(tg){
let theme=tg.colorScheme;
if(theme==='light'&&!S.settings.light){
S.settings.light=true;
document.body.classList.add('light');
document.getElementById('toggle-light').classList.toggle('on',true);
}
}
}
init();
</script>
</body>
</html>
